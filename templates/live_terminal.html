{% extends "base.html" %}

{% block title %}Live Settlement Terminal | Protocol Pulse{% endblock %}

{% block head %}
<style>
:root {
    --pp-bitcoin: #f7931a;
    --pp-bitcoin-dark: #c16c00;
    --pp-bitcoin-glow: rgba(247, 147, 26, 0.5);
    --pp-dark: #0a0a0a;
    --pp-glass: rgba(10, 10, 10, 0.9);
    --zone-border: rgba(255, 255, 255, 0.06);
    --fee-green: #22c55e;
    --fee-yellow: #eab308;
    --fee-red: #dc2626;
    
    /* Apple-style spacing system */
    --space-xs: 8px;
    --space-sm: 16px;
    --space-md: 32px;
    --space-lg: 64px;
    --space-xl: 96px;
    
    /* Apple-style colors */
    --apple-bg: #000000;
    --apple-card: rgba(28, 28, 30, 0.8);
    --apple-card-border: rgba(255, 255, 255, 0.08);
    --apple-text-primary: rgba(255, 255, 255, 0.92);
    --apple-text-secondary: rgba(255, 255, 255, 0.55);
    --apple-text-tertiary: rgba(255, 255, 255, 0.35);
    
    /* Refined accent colors */
    --accent-bitcoin: #f7931a;
    --accent-green: #30d158;
    --accent-red: #ff453a;
    --accent-blue: #0a84ff;
    --accent-purple: #bf5af2;
}

/* ============================================
   OPERATION SOVEREIGN TIGHTENING
   Three-Zone Architecture
   ============================================ */

/* Google Fonts - Premium Serif for Analysis */
@import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;500;600;700&display=swap');

/* ZONE 1: TACTICAL HORIZON */
.zone-tactical-horizon {
    position: relative;
    width: 100%;
    height: auto;
    overflow: hidden;
    background: #000;
}

/* BITCOIN HEARTBEAT AUDIO INDICATOR - World-Class Subtle Touch */
.heartbeat-audio-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 14px;
    background: rgba(220, 38, 38, 0.08);
    border: 1px solid rgba(220, 38, 38, 0.15);
    border-radius: 20px;
    cursor: pointer;
    position: relative;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0.7;
}

.heartbeat-audio-indicator:hover {
    opacity: 1;
    background: rgba(220, 38, 38, 0.12);
    border-color: rgba(220, 38, 38, 0.25);
    transform: scale(1.02);
}

.heartbeat-audio-indicator.active {
    opacity: 1;
    background: rgba(220, 38, 38, 0.15);
    border-color: rgba(220, 38, 38, 0.4);
}

.heartbeat-pulse-ring {
    position: absolute;
    inset: -4px;
    border-radius: 24px;
    border: 1px solid rgba(220, 38, 38, 0);
    pointer-events: none;
    transition: all 0.3s ease;
}

.heartbeat-audio-indicator.active .heartbeat-pulse-ring {
    animation: heartbeatRingPulse 1.5s ease-in-out infinite;
}

@keyframes heartbeatRingPulse {
    0%, 100% { 
        transform: scale(1);
        border-color: rgba(220, 38, 38, 0);
    }
    50% { 
        transform: scale(1.08);
        border-color: rgba(220, 38, 38, 0.3);
    }
}

.heartbeat-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    color: rgba(220, 38, 38, 0.6);
    font-size: 0.7rem;
    transition: all 0.3s ease;
}

.heartbeat-audio-indicator:hover .heartbeat-icon,
.heartbeat-audio-indicator.active .heartbeat-icon {
    color: #dc2626;
}

.heartbeat-audio-indicator.active .heartbeat-icon i {
    animation: heartbeatPump 0.8s ease-in-out infinite;
}

@keyframes heartbeatPump {
    0%, 100% { transform: scale(1); }
    15% { transform: scale(1.25); }
    30% { transform: scale(1); }
    45% { transform: scale(1.15); }
    60% { transform: scale(1); }
}

.heartbeat-waveform {
    display: flex;
    align-items: center;
    gap: 2px;
    height: 16px;
}

.heartbeat-waveform .wave-bar {
    width: 2px;
    height: 4px;
    background: rgba(220, 38, 38, 0.3);
    border-radius: 1px;
    transition: all 0.3s ease;
}

.heartbeat-audio-indicator:hover .wave-bar {
    background: rgba(220, 38, 38, 0.5);
}

.heartbeat-audio-indicator.active .wave-bar {
    background: #dc2626;
    animation: waveBarPulse 1.2s ease-in-out infinite;
}

.heartbeat-audio-indicator.active .wave-bar:nth-child(1) { animation-delay: 0s; }
.heartbeat-audio-indicator.active .wave-bar:nth-child(2) { animation-delay: 0.1s; }
.heartbeat-audio-indicator.active .wave-bar:nth-child(3) { animation-delay: 0.2s; }
.heartbeat-audio-indicator.active .wave-bar:nth-child(4) { animation-delay: 0.3s; }
.heartbeat-audio-indicator.active .wave-bar:nth-child(5) { animation-delay: 0.4s; }

@keyframes waveBarPulse {
    0%, 100% { height: 4px; opacity: 0.5; }
    50% { height: 14px; opacity: 1; }
}

.zone-tactical-horizon::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 150px;
    background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.95) 100%);
    pointer-events: none;
    z-index: 5;
}

/* ZONE 2: LOGIC ENGINE - Dashboard Grid */
.zone-logic-engine {
    position: relative;
    z-index: 10;
    background: transparent;
    padding: 30px 0 var(--space-lg) 0;
    margin-top: 0;
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: var(--space-md);
    transition: opacity 0.3s ease;
}

@media (max-width: 991px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
}

/* Dashboard Instrument Panels - Apple Style */
.instrument-panel {
    background: var(--apple-card);
    border: 1px solid var(--apple-card-border);
    border-radius: 20px;
    padding: var(--space-md);
    position: relative;
    overflow: hidden;
    transition: transform 0.2s ease;
}

.instrument-panel::before {
    display: none;
}

/* Simplified fee states - subtle, not distracting */
.instrument-panel.fee-low,
.instrument-panel.fee-medium,
.instrument-panel.fee-high {
    border-color: var(--apple-card-border);
    box-shadow: none;
    animation: none;
}

@keyframes pulseHighFee {
    0%, 100% { box-shadow: none; }
}

/* Cleaner hover - no sibling dimming */
.dashboard-grid:hover .instrument-panel {
    opacity: 1;
    transition: opacity 0.4s ease;
}

.dashboard-grid:hover .instrument-panel:hover,
.instrument-panel:hover {
    opacity: 1;
    transform: translateY(-4px);
}

.instrument-panel .panel-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-sm);
    border-bottom: none;
}

.panel-icon {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.06);
    border: none;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent-blue);
    font-size: 1.1rem;
}

.panel-title {
    font-family: 'SF Pro Display', -apple-system, sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: -0.02em;
    color: var(--apple-text-primary);
    text-transform: none;
    margin: 0;
}

/* ZONE 3: SOVEREIGN ARCHIVE - Apple Style Folders */
.zone-sovereign-archive {
    position: relative;
    z-index: 10;
    background: transparent;
    padding: 20px 0 var(--space-lg) 0;
}

.archive-folder {
    background: var(--apple-card);
    border: 1px solid var(--apple-card-border);
    border-radius: 16px;
    margin-bottom: var(--space-sm);
    overflow: hidden;
    transition: all 0.3s ease;
}

.archive-folder.collapsed {
    background: var(--apple-card);
}

.archive-folder-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-sm) var(--space-md);
    cursor: pointer;
    background: transparent;
    border-bottom: none;
    transition: background 0.3s ease;
}

.archive-folder-header:hover {
    background: rgba(255, 255, 255, 0.03);
}

.archive-folder-title {
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: 'SF Pro Display', -apple-system, sans-serif;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--apple-text-primary);
    text-transform: none;
    letter-spacing: 0;
}

.archive-folder-title i {
    color: #f7931a;
    font-size: 0.9rem;
}

.archive-folder-toggle {
    color: rgba(255,255,255,0.4);
    font-size: 0.8rem;
    transition: transform 0.3s ease;
}

.archive-folder.collapsed .archive-folder-toggle {
    transform: rotate(-90deg);
}

.archive-folder-content {
    max-height: 2000px;
    overflow: hidden;
    transition: max-height 0.5s ease, opacity 0.3s ease, padding 0.3s ease;
    opacity: 1;
    padding: var(--space-md);
}

.archive-folder.collapsed .archive-folder-content {
    max-height: 0;
    opacity: 0;
    padding: 0 20px;
}

/* Typography Overhaul */
.data-mono {
    font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace !important;
}

.text-serif {
    font-family: 'Crimson Pro', 'Georgia', serif !important;
}

.analysis-text {
    font-family: 'Crimson Pro', 'Georgia', serif;
    font-size: 1.05rem;
    line-height: 1.7;
    color: rgba(255,255,255,0.85);
}

/* Status bar update for Zone 1 */
.sovereign-status-bar.zone-status {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
    padding: 15px 0;
}

/* CRITICAL: Override body background for video visibility */
body, html {
    margin: 0 !important;
    padding: 0 !important;
    overflow-x: hidden;
    background: transparent !important;
    background-color: transparent !important;
}

#live-terminal-wrapper {
    height: auto !important;
    max-height: none !important;
    margin-bottom: 0 !important;
    position: relative;
    aspect-ratio: 16/9;
}

/* SECTION SPACING - Consistent buffer between all modules */
section.container {
    margin-bottom: 30px !important;
}

/* COLLAPSIBLE SECTIONS */
.collapsible-section .module-content {
    max-height: 2000px;
    overflow: hidden;
    transition: max-height 0.4s ease-out, opacity 0.3s ease;
    opacity: 1;
}

.collapsible-section.collapsed .module-content {
    max-height: 0;
    opacity: 0;
    padding: 0 !important;
    margin: 0 !important;
}

.collapsible-toggle {
    background: rgba(247, 147, 26, 0.15);
    border: 1px solid rgba(247, 147, 26, 0.3);
    color: #f7931a;
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 6px;
}

.collapsible-toggle:hover {
    background: rgba(247, 147, 26, 0.25);
}

.collapsible-toggle i {
    transition: transform 0.3s;
}

.collapsible-section.collapsed .collapsible-toggle i {
    transform: rotate(-90deg);
}

/* Footer overlap for seamless flow */
footer {
    margin-top: -60px !important;
    position: relative;
    z-index: 10;
    background: rgba(0,0,0,0.85) !important;
    backdrop-filter: blur(10px);
}

/* SOVEREIGN STATUS BAR - Apple Style */
.sovereign-status-bar {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    display: flex;
    justify-content: center;
    gap: 2.5rem;
    padding: 12px 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    font-family: 'SF Mono', 'JetBrains Mono', monospace;
    font-size: 0.85rem;
}

.status-metric {
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-label {
    font-size: 0.7rem;
    font-weight: 500;
    color: var(--apple-text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.status-value {
    font-family: 'SF Mono', monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--apple-text-primary);
}

.status-value.highlight {
    color: var(--accent-bitcoin);
}

/* Subtle REC indicator */
.rec-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
}

.rec-dot {
    width: 6px;
    height: 6px;
    background: var(--accent-green);
    border-radius: 50%;
    animation: subtlePulse 2s ease-in-out infinite;
}

@keyframes subtlePulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

@keyframes recBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* ============================================
   INTELLIGENCE DESCENT - GLASSMORPHISM MODULES
   ============================================ */

/* Base Glassmorphism Card - Apple Style */
.glass-module {
    background: var(--apple-card);
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border: 1px solid var(--apple-card-border);
    border-radius: 20px;
    padding: var(--space-md);
    margin-bottom: var(--space-md);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.glass-module::before {
    content: '';
    position: absolute;
    top: 0;
    left: 20%;
    right: 20%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
}

.glass-module:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.module-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-sm);
    border-bottom: none;
}

.module-icon {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.06);
    border: none;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

.module-title {
    font-family: 'SF Pro Display', -apple-system, sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: -0.02em;
    color: var(--apple-text-primary);
    text-transform: none;
    margin: 0;
}

.module-subtitle {
    font-size: 0.8rem;
    color: var(--apple-text-tertiary);
    font-weight: 400;
    margin-top: 2px;
}

/* 1. SOVEREIGN HEALTH HUD */
.sovereign-health-hud {
    background: linear-gradient(135deg, rgba(10, 10, 10, 0.8) 0%, rgba(20, 5, 5, 0.6) 100%);
}

.pulse-heartbeat {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 12px;
    margin-bottom: 20px;
}

.heartbeat-visual {
    width: 80px;
    height: 80px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.heartbeat-ring {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 2px solid #dc2626;
    border-radius: 50%;
    animation: heartbeatPulse 1.5s ease-in-out infinite;
    opacity: 0.6;
}

.heartbeat-ring:nth-child(2) {
    animation-delay: 0.3s;
    width: 70%;
    height: 70%;
}

.heartbeat-core {
    width: 30px;
    height: 30px;
    background: radial-gradient(circle, #dc2626 0%, #991b1b 100%);
    border-radius: 50%;
    box-shadow: 0 0 20px rgba(220, 38, 38, 0.6);
    animation: corePulse 1.5s ease-in-out infinite;
}

@keyframes heartbeatPulse {
    0%, 100% { transform: scale(1); opacity: 0.6; }
    50% { transform: scale(1.3); opacity: 0.15; }
}

/* Synced heartbeat flash on data refresh */
@keyframes heartbeatSync {
    0% { transform: scale(1); box-shadow: 0 0 20px rgba(220, 38, 38, 0.6); }
    25% { transform: scale(1.4); box-shadow: 0 0 40px rgba(220, 38, 38, 0.9); }
    100% { transform: scale(1); box-shadow: 0 0 20px rgba(220, 38, 38, 0.6); }
}

.heartbeat-core.synced {
    animation: heartbeatSync 0.5s ease-out !important;
}

@keyframes corePulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(220, 38, 38, 0.6); }
    50% { transform: scale(1.1); box-shadow: 0 0 40px rgba(220, 38, 38, 0.9); }
}

.heartbeat-info {
    flex: 1;
}

.heartbeat-label {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.heartbeat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2rem;
    font-weight: 700;
    color: #fff;
    margin: 5px 0;
}

.heartbeat-status {
    font-size: 0.75rem;
    padding: 4px 12px;
    border-radius: 20px;
    display: inline-block;
}

.heartbeat-status.normal {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.3);
}

.heartbeat-status.delayed {
    background: rgba(234, 179, 8, 0.2);
    color: #eab308;
    border: 1px solid rgba(234, 179, 8, 0.3);
}

.heartbeat-status.overdue {
    background: rgba(220, 38, 38, 0.2);
    color: #dc2626;
    border: 1px solid rgba(220, 38, 38, 0.3);
}

/* Fee Friction Calculator */
.fee-friction-calc {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 20px;
}

.fee-friction-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.fee-friction-title {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.fee-friction-label {
    font-size: 0.6rem;
    color: #f7931a;
}

.fee-scale {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
}

/* Fee Tiers - Apple Style */
.fee-tier {
    flex: 1;
    text-align: center;
    padding: var(--space-sm);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.04);
    border: none;
    transition: background 0.2s ease;
}

.fee-tier:hover {
    background: rgba(255, 255, 255, 0.08);
}

.fee-tier-label {
    font-size: 0.65rem;
    color: var(--apple-text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    margin-bottom: 6px;
}

.fee-tier-value {
    font-family: 'SF Mono', 'JetBrains Mono', monospace;
    font-size: 1.2rem;
    font-weight: 600;
}

.fee-tier-value.low { color: var(--accent-green); }
.fee-tier-value.medium { color: #eab308; }
.fee-tier-value.high { color: #f97316; }
.fee-tier-value.urgent { color: var(--accent-red); }

.fee-tier-time {
    font-size: 0.65rem;
    color: var(--apple-text-secondary);
    margin-top: 4px;
}

.finality-cost {
    text-align: center;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.finality-label {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
    letter-spacing: 2px;
}

.finality-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.2rem;
    color: #f7931a;
    font-weight: 700;
    margin-top: 5px;
}

/* 2. ENERGY PROOF MODULE */
.energy-proof-module {
    background: linear-gradient(135deg, rgba(10, 20, 10, 0.7) 0%, rgba(10, 10, 10, 0.8) 100%);
}

.energy-proof-module .module-icon {
    background: rgba(34, 197, 94, 0.15);
    border-color: rgba(34, 197, 94, 0.3);
    color: #22c55e;
}

.energy-proof-module .module-title {
    color: #22c55e;
}

.energy-proof-module::before {
    background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.5), transparent);
}

.energy-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.energy-stat {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
}

.energy-stat-icon {
    font-size: 1.5rem;
    margin-bottom: 8px;
}

.energy-stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.4rem;
    font-weight: 700;
    color: #22c55e;
    margin-bottom: 4px;
}

.energy-stat-label {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.carbon-displacement {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.2);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
}

.carbon-counter {
    flex: 1;
}

.carbon-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2rem;
    font-weight: 700;
    color: #22c55e;
}

.carbon-unit {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.6);
}

.carbon-label {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 5px;
}

.macro-flash {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 10px;
    padding: 15px;
    margin-top: 20px;
    border-left: 3px solid #22c55e;
}

.macro-flash-header {
    font-size: 0.6rem;
    color: #22c55e;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.macro-flash-text {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.5;
}

/* 3. WHALE DISPLACEMENT RADAR */
.whale-radar-module {
    background: linear-gradient(135deg, rgba(10, 10, 25, 0.7) 0%, rgba(10, 10, 10, 0.8) 100%);
}

.whale-radar-module .module-icon {
    background: rgba(99, 102, 241, 0.15);
    border-color: rgba(99, 102, 241, 0.3);
    color: #6366f1;
}

.whale-radar-module .module-title {
    color: #6366f1;
}

.whale-radar-module::before {
    background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.5), transparent);
}

.exchange-drain {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
}

.drain-chart {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 20px;
}

.drain-title {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 15px;
}

.drain-bar-container {
    height: 120px;
    display: flex;
    align-items: flex-end;
    gap: 8px;
}

.drain-bar {
    flex: 1;
    background: linear-gradient(to top, #22c55e, rgba(34, 197, 94, 0.3));
    border-radius: 4px 4px 0 0;
    position: relative;
    min-height: 10px;
    transition: height 0.5s ease;
}

.drain-bar.outflow {
    background: linear-gradient(to top, #dc2626, rgba(220, 38, 38, 0.3));
}

.drain-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.8rem;
    font-weight: 700;
    color: #22c55e;
    margin-bottom: 5px;
}

.drain-value.negative {
    color: #dc2626;
}

.drain-label {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.4);
}

.whale-alerts {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 20px;
}

.whale-alert-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 10px;
    margin-bottom: 10px;
}

.whale-alert-item:last-child {
    margin-bottom: 0;
}

.whale-alert-icon {
    font-size: 1.5rem;
}

.whale-alert-info {
    flex: 1;
}

.whale-alert-amount {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 700;
    color: #fff;
}

.whale-alert-type {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.5);
}

.whale-alert-time {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.3);
}

.seismic-alert {
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.2) 0%, rgba(153, 27, 27, 0.1) 100%);
    border: 1px solid rgba(220, 38, 38, 0.4);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    animation: seismicPulse 2s ease-in-out infinite;
}

@keyframes seismicPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
    50% { box-shadow: 0 0 20px 5px rgba(220, 38, 38, 0.2); }
}

.seismic-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}

.seismic-badge {
    background: #dc2626;
    color: #fff;
    font-size: 0.6rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.seismic-amount {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.5rem;
    font-weight: 700;
    color: #dc2626;
}

.seismic-analysis {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

/* 4. PROTOCOL ROADMAP TERMINAL */
.protocol-roadmap-module {
    background: linear-gradient(135deg, rgba(25, 10, 25, 0.7) 0%, rgba(10, 10, 10, 0.8) 100%);
}

.protocol-roadmap-module .module-icon {
    background: rgba(168, 85, 247, 0.15);
    border-color: rgba(168, 85, 247, 0.3);
    color: #a855f7;
}

.protocol-roadmap-module .module-title {
    color: #a855f7;
}

.protocol-roadmap-module::before {
    background: linear-gradient(90deg, transparent, rgba(168, 85, 247, 0.5), transparent);
}

.countdown-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 25px;
}

.countdown-item {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(168, 85, 247, 0.1);
}

.countdown-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2rem;
    font-weight: 700;
    color: #a855f7;
    margin-bottom: 5px;
}

.countdown-unit {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
}

.countdown-label {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.6);
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.commit-feed {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 12px;
    padding: 20px;
    max-height: 300px;
    overflow-y: auto;
}

.commit-feed::-webkit-scrollbar {
    width: 4px;
}

.commit-feed::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

.commit-feed::-webkit-scrollbar-thumb {
    background: rgba(168, 85, 247, 0.3);
    border-radius: 2px;
}

.commit-feed-header {
    font-size: 0.65rem;
    color: #a855f7;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.commit-feed-header::before {
    content: '';
    width: 6px;
    height: 6px;
    background: #a855f7;
    border-radius: 50%;
    animation: pulse-dot 1.5s infinite;
}

.commit-item {
    padding: 12px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.commit-item:last-child {
    border-bottom: none;
}

.commit-hash {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: #a855f7;
    margin-bottom: 5px;
}

.commit-message {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.4;
    margin-bottom: 5px;
}

.commit-translation {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
    padding-left: 10px;
    border-left: 2px solid rgba(168, 85, 247, 0.3);
}

.commit-meta {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.3);
    margin-top: 8px;
}

/* 5. FINAL VERDICT CARD */
.final-verdict-module {
    background: linear-gradient(135deg, rgba(247, 147, 26, 0.1) 0%, rgba(10, 10, 10, 0.9) 100%);
    border: 1px solid rgba(247, 147, 26, 0.3);
}

.final-verdict-module .module-icon {
    background: rgba(247, 147, 26, 0.15);
    border-color: rgba(247, 147, 26, 0.3);
    color: #f7931a;
}

.final-verdict-module .module-title {
    color: #f7931a;
}

.final-verdict-module::before {
    background: linear-gradient(90deg, transparent, rgba(247, 147, 26, 0.5), transparent);
}

.verdict-content {
    text-align: center;
    padding: 30px 20px;
}

.verdict-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #f7931a, #c16c00);
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    box-shadow: 0 0 30px rgba(247, 147, 26, 0.4);
}

.verdict-summary {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto;
}

.verdict-timestamp {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.4);
    margin-top: 20px;
}

@media (max-width: 768px) {
    .glass-module {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    /* Stack heartbeat and fee calculator vertically */
    .sovereign-health-hud .row {
        flex-direction: column;
    }
    
    .sovereign-health-hud .col-md-5,
    .sovereign-health-hud .col-md-7 {
        width: 100%;
        max-width: 100%;
        flex: none;
        padding: 0;
    }
    
    .pulse-heartbeat {
        flex-direction: column;
        text-align: center;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .heartbeat-visual {
        width: 60px;
        height: 60px;
        margin-bottom: 10px;
    }
    
    .heartbeat-value {
        font-size: 1.8rem;
    }
    
    .fee-friction-calc {
        padding: 15px;
    }
    
    .fee-scale {
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .fee-tier {
        flex: 1 1 48%;
        padding: 10px 6px;
    }
    
    .fee-tier-value {
        font-size: 0.9rem;
    }
    
    .fee-tier-label,
    .fee-tier-time {
        font-size: 0.5rem;
    }
    
    .finality-value {
        font-size: 1rem;
    }
    
    /* Energy grid stacks */
    .energy-grid {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .energy-stat {
        padding: 12px 8px;
    }
    
    .energy-stat-value {
        font-size: 1.1rem;
    }
    
    .energy-stat-icon {
        font-size: 1.2rem;
    }
    
    .carbon-displacement {
        flex-direction: column;
        text-align: center;
        padding: 15px;
    }
    
    .carbon-value {
        font-size: 1.5rem;
    }
    
    .macro-flash {
        padding: 12px;
    }
    
    .macro-flash-text {
        font-size: 0.75rem;
    }
    
    /* Exchange drain stacks */
    .exchange-drain {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .drain-chart,
    .whale-alerts {
        padding: 15px;
    }
    
    .drain-value {
        font-size: 1.4rem;
    }
    
    .whale-alert-item {
        padding: 10px;
    }
    
    .whale-alert-amount {
        font-size: 0.9rem;
    }
    
    .seismic-alert {
        padding: 15px;
    }
    
    .seismic-amount {
        font-size: 1.2rem;
    }
    
    /* Countdown grid adjusts */
    .countdown-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    
    .countdown-item {
        padding: 12px 8px;
    }
    
    .countdown-value {
        font-size: 1.3rem;
    }
    
    .countdown-unit {
        font-size: 0.55rem;
    }
    
    .countdown-label {
        font-size: 0.5rem;
        margin-top: 6px;
        padding-top: 6px;
    }
    
    /* Commit feed */
    .commit-feed {
        padding: 15px;
        max-height: 200px;
    }
    
    .commit-message {
        font-size: 0.7rem;
    }
    
    .commit-translation {
        font-size: 0.65rem;
    }
    
    /* Final verdict */
    .verdict-avatar {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
    }
    
    .verdict-summary {
        font-size: 0.9rem;
    }
    
    /* Module headers compact */
    .module-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
    }
    
    .module-icon {
        width: 32px;
        height: 32px;
        font-size: 0.9rem;
    }
    
    .module-title {
        font-size: 0.65rem;
        letter-spacing: 2px;
    }
    
    .module-subtitle {
        font-size: 0.55rem;
    }
}

@media (max-width: 480px) {
    .energy-grid {
        grid-template-columns: 1fr;
    }
    
    .countdown-grid {
        grid-template-columns: 1fr;
    }
    
    .countdown-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 15px;
    }
    
    .countdown-value {
        font-size: 1.5rem;
        margin-bottom: 0;
    }
    
    .countdown-label {
        margin-top: 0;
        padding-top: 0;
        border-top: none;
        text-align: right;
    }
}

/* ============================================
   NEW INTELLIGENCE MODULES
   ============================================ */

/* MEMPOOL HEATMAP - Enhanced World-Class Design */
.mempool-heatmap-container {
    position: relative;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.1) 100%);
    border-radius: 16px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.heatmap-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.heatmap-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(255, 255, 255, 0.5);
}

.heatmap-stats {
    display: flex;
    gap: 16px;
}

.heatmap-stat {
    text-align: right;
}

.heatmap-stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
    font-weight: 600;
    color: #fff;
}

.heatmap-stat-label {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.heatmap-visual {
    height: 140px;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%);
    border-radius: 12px;
    position: relative;
    overflow: hidden;
    margin-bottom: 12px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.heatmap-glow {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60%;
    background: linear-gradient(180deg, transparent 0%, rgba(247, 147, 26, 0.1) 100%);
    pointer-events: none;
}

.heatmap-blocks {
    display: flex;
    height: 100%;
    gap: 3px;
    padding: 8px;
    position: relative;
    z-index: 1;
}

.heatmap-band {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    position: relative;
    border-radius: 6px 6px 0 0;
    overflow: hidden;
}

.heatmap-bar {
    border-radius: 4px 4px 0 0;
    transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    min-height: 4px;
}

.heatmap-band:nth-child(1) .heatmap-bar { background: linear-gradient(180deg, #0d9488 0%, #14b8a6 100%); box-shadow: 0 0 20px rgba(20, 184, 166, 0.4); }
.heatmap-band:nth-child(2) .heatmap-bar { background: linear-gradient(180deg, #10b981 0%, #22c55e 100%); box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
.heatmap-band:nth-child(3) .heatmap-bar { background: linear-gradient(180deg, #65a30d 0%, #84cc16 100%); box-shadow: 0 0 20px rgba(132, 204, 22, 0.4); }
.heatmap-band:nth-child(4) .heatmap-bar { background: linear-gradient(180deg, #ca8a04 0%, #eab308 100%); box-shadow: 0 0 20px rgba(234, 179, 8, 0.4); }
.heatmap-band:nth-child(5) .heatmap-bar { background: linear-gradient(180deg, #ea580c 0%, #f97316 100%); box-shadow: 0 0 20px rgba(249, 115, 22, 0.4); }
.heatmap-band:nth-child(6) .heatmap-bar { background: linear-gradient(180deg, #dc2626 0%, #ef4444 100%); box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); }
.heatmap-band:nth-child(7) .heatmap-bar { background: linear-gradient(180deg, #991b1b 0%, #dc2626 100%); box-shadow: 0 0 20px rgba(220, 38, 38, 0.5); }

.heatmap-bar-value {
    position: absolute;
    top: -22px;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.8);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.heatmap-band:hover .heatmap-bar-value {
    opacity: 1;
}

.heatmap-band:hover .heatmap-bar {
    filter: brightness(1.2);
}

.heatmap-labels {
    display: flex;
    justify-content: space-between;
    padding: 0 8px;
    margin-bottom: 8px;
}

.heatmap-fee-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.55rem;
    color: rgba(255, 255, 255, 0.4);
    text-align: center;
    flex: 1;
}

.heatmap-legend {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0 0;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
}

.heatmap-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.heatmap-legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.heatmap-legend-dot.calm { background: #14b8a6; box-shadow: 0 0 8px rgba(20, 184, 166, 0.5); }
.heatmap-legend-dot.urgent { background: #dc2626; box-shadow: 0 0 8px rgba(220, 38, 38, 0.5); }

.heatmap-legend span:first-child { color: #14b8a6; }
.heatmap-legend span:last-child { color: #dc2626; }

.mempool-explainer {
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 15px 20px;
    margin-top: 20px;
}

.explainer-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    font-size: 0.8rem;
}

.explainer-content {
    display: none;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255,255,255,0.1);
    font-size: 0.8rem;
    line-height: 1.6;
    color: rgba(255,255,255,0.7);
}

.explainer-content.open {
    display: block;
}

/* EPOCH PROGRESS BAR */
.epoch-progress-container {
    background: rgba(0,0,0,0.4);
    border-radius: 12px;
    padding: 25px;
}

.epoch-bar-wrapper {
    position: relative;
    height: 40px;
    background: rgba(255,255,255,0.05);
    border-radius: 20px;
    overflow: hidden;
    margin-bottom: 15px;
}

.epoch-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #f7931a 0%, #dc2626 100%);
    border-radius: 20px;
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 15px;
}

.epoch-bar-text {
    color: white;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

.epoch-stats {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
}

.epoch-stat {
    text-align: center;
}

.epoch-stat-label {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.epoch-stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    color: #f7931a;
    font-weight: 600;
}

.epoch-stat-value.positive { color: #22c55e; }
.epoch-stat-value.negative { color: #ef4444; }

/* MINING POOL DISTRIBUTION */
.pool-chart-container {
    display: flex;
    align-items: center;
    gap: 30px;
    flex-wrap: wrap;
}

.pool-donut {
    width: 200px;
    height: 200px;
    position: relative;
}

.pool-donut-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.pool-donut-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.2rem;
    font-weight: 600;
    color: white;
}

.pool-donut-label {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
}

.pool-legend {
    flex: 1;
    min-width: 200px;
}

.pool-legend-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.pool-legend-name {
    display: flex;
    align-items: center;
    gap: 10px;
}

.pool-legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}

.pool-legend-pct {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    color: #f7931a;
}

.pool-warning {
    background: rgba(234, 179, 8, 0.1);
    border: 1px solid rgba(234, 179, 8, 0.3);
    border-radius: 8px;
    padding: 10px 15px;
    margin-top: 15px;
    font-size: 0.75rem;
    color: #eab308;
    display: none;
}

/* NODE GLOBE */
.globe-container {
    width: 100%;
    height: 400px;
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: radial-gradient(circle at center, rgba(10, 10, 30, 0.8) 0%, rgba(0, 0, 0, 0.95) 100%);
}

.globe-stats-overlay {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 15px 20px;
}

.globe-stat-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.globe-stat-row:last-child {
    margin-bottom: 0;
}

.globe-stat-icon {
    color: #f7931a;
    width: 20px;
}

.globe-stat-label {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
}

.globe-stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
    color: white;
}

.globe-controls {
    position: absolute;
    top: 15px;
    right: 15px;
    display: flex;
    gap: 8px;
}

.globe-control-btn {
    width: 36px;
    height: 36px;
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.globe-control-btn:hover {
    background: rgba(247, 147, 26, 0.3);
    border-color: #f7931a;
}

/* SOVEREIGNTY CALCULATOR */
.calc-container {
    background: rgba(0,0,0,0.4);
    border-radius: 12px;
    padding: 25px;
}

.calc-inputs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.calc-input-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.calc-input-label {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.calc-input {
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    padding: 12px 15px;
    color: white;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
}

.calc-input:focus {
    outline: none;
    border-color: #f7931a;
}

.calc-presets {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 25px;
}

.calc-preset-btn {
    padding: 8px 16px;
    background: rgba(247, 147, 26, 0.1);
    border: 1px solid rgba(247, 147, 26, 0.3);
    border-radius: 20px;
    color: #f7931a;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s;
}

.calc-preset-btn:hover, .calc-preset-btn.active {
    background: rgba(247, 147, 26, 0.3);
}

.calc-results {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    padding: 20px;
    background: rgba(247, 147, 26, 0.05);
    border: 1px solid rgba(247, 147, 26, 0.2);
    border-radius: 12px;
    margin-bottom: 20px;
}

.calc-result-item {
    text-align: center;
}

.calc-result-label {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 5px;
}

.calc-result-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.2rem;
    color: #f7931a;
    font-weight: 600;
}

.calc-result-value.positive { color: #22c55e; }

.calc-chart {
    height: 150px;
    background: rgba(0,0,0,0.3);
    border-radius: 8px;
    position: relative;
    overflow: hidden;
}

/* LIGHTNING PULSE */
.lightning-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.lightning-stat {
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.2);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
}

.lightning-stat-icon {
    font-size: 1.5rem;
    color: #8b5cf6;
    margin-bottom: 10px;
}

.lightning-stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.5rem;
    color: white;
    font-weight: 600;
}

.lightning-stat-label {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 5px;
}

.lightning-visual {
    height: 200px;
    background: rgba(0,0,0,0.4);
    border-radius: 12px;
    position: relative;
    overflow: hidden;
}

/* VARIANCE ALERT */
.variance-alert {
    margin-top: 12px;
    padding: 12px 14px;
    background: linear-gradient(135deg, rgba(250, 204, 21, 0.15) 0%, rgba(250, 204, 21, 0.05) 100%);
    border: 1px solid rgba(250, 204, 21, 0.4);
    border-radius: 10px;
    animation: variancePulse 2s ease-in-out infinite;
}

.variance-alert-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    font-weight: 700;
    color: #facc15;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 6px;
}

.variance-alert-text {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.5;
}

@keyframes variancePulse {
    0%, 100% { border-color: rgba(250, 204, 21, 0.4); }
    50% { border-color: rgba(250, 204, 21, 0.7); }
}

/* TIMECHAIN CLOCK - Holographic Horizon Design */
.timechain-module {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(5, 3, 0, 0.98) 100%);
    border: 2px solid rgba(247, 147, 26, 0.3);
    border-radius: 24px;
    overflow: hidden;
    position: relative;
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
}

.timechain-module::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(247, 147, 26, 0.6), transparent);
}

.timechain-header {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 25px 30px;
    border-bottom: 1px solid rgba(247, 147, 26, 0.12);
    background: linear-gradient(180deg, rgba(247, 147, 26, 0.05) 0%, transparent 100%);
}

.timechain-icon-wrap {
    position: relative;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(247, 147, 26, 0.15) 0%, rgba(247, 147, 26, 0.03) 100%);
    border: 1px solid rgba(247, 147, 26, 0.3);
    border-radius: 14px;
    color: #f7931a;
    font-size: 1.4rem;
}

.timechain-icon-glow {
    position: absolute;
    inset: -8px;
    background: radial-gradient(circle, rgba(247, 147, 26, 0.25) 0%, transparent 70%);
    border-radius: 22px;
    animation: glowPulse 3s ease-in-out infinite;
}

@keyframes glowPulse {
    0%, 100% { opacity: 0.4; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.15); }
}

.timechain-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.3rem;
    font-weight: 700;
    color: #f7931a;
    margin: 0;
    letter-spacing: 0.1em;
    text-shadow: 0 0 20px rgba(247, 147, 26, 0.4);
}

.timechain-subtitle {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.4);
    margin: 4px 0 0;
    letter-spacing: 0.05em;
}

.timechain-content {
    display: grid;
    grid-template-columns: 1fr 1.3fr;
    gap: 50px;
    padding: 50px 40px;
    align-items: center;
}

@media (max-width: 900px) {
    .timechain-content {
        grid-template-columns: 1fr;
        gap: 40px;
        padding: 30px 20px;
    }
}

.timechain-clock-visual {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 25px;
}

.clock-outer-ring {
    position: relative;
    width: 300px;
    height: 300px;
}

.clock-epoch-markers {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.epoch-marker {
    position: absolute;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: rgba(247, 147, 26, 0.5);
    font-weight: 600;
    letter-spacing: 0.1em;
}

.epoch-marker:nth-child(1) { top: -25px; left: 50%; transform: translateX(-50%); }
.epoch-marker:nth-child(2) { right: -30px; top: 50%; transform: translateY(-50%); }
.epoch-marker:nth-child(3) { bottom: -25px; left: 50%; transform: translateX(-50%); }
.epoch-marker:nth-child(4) { left: -30px; top: 50%; transform: translateY(-50%); }

/* The Stunning Holographic Face */
.clock-face-enhanced {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: radial-gradient(circle at center, #111 0%, #000 100%);
    border: 2px solid rgba(247, 147, 26, 0.4);
    position: relative;
    box-shadow: 
        0 0 80px rgba(247, 147, 26, 0.2),
        0 0 150px rgba(247, 147, 26, 0.08),
        inset 0 0 60px rgba(0, 0, 0, 0.8),
        inset 0 0 120px rgba(0, 0, 0, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.05);
}

/* Block Pulse Orbital Ring - changes color based on time */
.clock-face-enhanced::before {
    content: '';
    position: absolute;
    inset: 8px;
    border-radius: 50%;
    border: 2px solid rgba(34, 197, 94, 0.4);
    box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
    transition: all 0.5s ease;
}

.clock-face-enhanced.variance-warning::before {
    border-color: rgba(250, 204, 21, 0.5);
    box-shadow: 0 0 20px rgba(250, 204, 21, 0.4);
}

.clock-face-enhanced.variance-critical::before {
    border-color: rgba(220, 38, 38, 0.6);
    box-shadow: 0 0 30px rgba(220, 38, 38, 0.5);
    animation: criticalThrob 1.5s ease-in-out infinite;
}

@keyframes criticalThrob {
    0%, 100% { box-shadow: 0 0 30px rgba(220, 38, 38, 0.5); }
    50% { box-shadow: 0 0 50px rgba(220, 38, 38, 0.8), 0 0 80px rgba(220, 38, 38, 0.3); }
}

.clock-glow-inner {
    position: absolute;
    inset: 15%;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(247, 147, 26, 0.06) 0%, transparent 70%);
}

/* Precision Tick Marks - 60 dashes */
.clock-tick-marks {
    position: absolute;
    inset: 0;
    border-radius: 50%;
}

/* Laser Hands */
.clock-hand {
    position: absolute;
    bottom: 50%;
    left: 50%;
    transform-origin: bottom center;
}

.clock-hand.epoch-hand {
    width: 4px;
    height: 45px;
    margin-left: -2px;
    background: linear-gradient(180deg, #dc2626 0%, #991b1b 100%);
    z-index: 5;
    border-radius: 2px;
    box-shadow: 
        0 0 15px rgba(220, 38, 38, 0.6),
        0 0 30px rgba(220, 38, 38, 0.3);
}

.clock-hand.block-hand {
    width: 3px;
    height: 95px;
    margin-left: -1.5px;
    background: linear-gradient(180deg, #f7931a 0%, #dc2626 100%);
    z-index: 6;
    border-radius: 2px;
    box-shadow: 
        0 0 20px rgba(247, 147, 26, 0.5),
        0 0 40px rgba(247, 147, 26, 0.2),
        0 8px 16px rgba(247, 147, 26, 0.3);
}

.clock-hand.minute-hand {
    width: 1px;
    height: 115px;
    margin-left: -0.5px;
    background: #fff;
    z-index: 7;
    box-shadow: 0 0 15px #fff, 0 0 30px rgba(255, 255, 255, 0.5);
}

/* Pulsing Power Core */
.clock-center-bitcoin {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 36px;
    height: 36px;
    background: radial-gradient(circle at 30% 30%, #dc2626 0%, #991b1b 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 20;
    box-shadow: 
        0 0 20px rgba(220, 38, 38, 0.8),
        0 0 40px rgba(220, 38, 38, 0.4);
    font-size: 1rem;
    color: #fff;
    animation: powerCorePulse 10s ease-in-out infinite;
    overflow: hidden;
}

.clock-center-bitcoin i,
.clock-center-bitcoin .fab,
.clock-center-bitcoin .fa-bitcoin {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    width: auto !important;
    height: auto !important;
    border-radius: 0 !important;
}

/* Hide hand bases behind center */
.clock-hand {
    background-clip: padding-box;
}

@keyframes powerCorePulse {
    0%, 100% { box-shadow: 0 0 20px rgba(220, 38, 38, 0.8), 0 0 40px rgba(220, 38, 38, 0.4); }
    50% { box-shadow: 0 0 30px rgba(220, 38, 38, 1), 0 0 60px rgba(220, 38, 38, 0.6), 0 0 90px rgba(220, 38, 38, 0.3); }
}

.clock-legend {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.65rem;
    font-family: 'JetBrains Mono', monospace;
    color: rgba(255, 255, 255, 0.4);
    letter-spacing: 0.05em;
}

.legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.legend-dot.epoch { background: #dc2626; box-shadow: 0 0 8px rgba(220, 38, 38, 0.6); }
.legend-dot.block { background: #f7931a; box-shadow: 0 0 8px rgba(247, 147, 26, 0.6); }
.legend-dot.minute { background: #fff; box-shadow: 0 0 8px rgba(255, 255, 255, 0.6); }

.timechain-data-panel {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* Status Pill Block Display */
.timechain-block-display {
    text-align: center;
    padding: 30px;
    background: linear-gradient(135deg, rgba(247, 147, 26, 0.08) 0%, rgba(247, 147, 26, 0.02) 100%);
    border: 1px solid rgba(247, 147, 26, 0.15);
    border-radius: 20px;
    backdrop-filter: blur(10px);
    position: relative;
}

.timechain-block-display::before {
    content: '';
    position: absolute;
    top: 0;
    left: 20%;
    right: 20%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(247, 147, 26, 0.4), transparent);
}

.block-height-wrap {
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 2px;
}

.block-hash-prefix {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.8rem;
    color: rgba(247, 147, 26, 0.5);
    font-weight: 300;
}

.block-height-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 3rem;
    font-weight: 900;
    color: #f7931a;
    text-shadow: 0 0 40px rgba(247, 147, 26, 0.4);
    letter-spacing: -2px;
}

.block-height-label {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-top: 8px;
}

.block-progress-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-top: 15px;
    overflow: hidden;
}

.block-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #f7931a 0%, #facc15 100%);
    border-radius: 3px;
    width: 0%;
    transition: width 0.5s ease;
}

.block-progress-label {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.4);
    margin-top: 8px;
}

.timechain-stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.timechain-stat {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.timechain-stat:hover {
    background: rgba(247, 147, 26, 0.05);
    border-color: rgba(247, 147, 26, 0.2);
}

.timechain-stat .stat-icon {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(247, 147, 26, 0.1);
    border-radius: 10px;
    color: #f7931a;
    font-size: 0.9rem;
}

.timechain-stat .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 700;
    color: #fff;
}

.timechain-stat .stat-label {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.timechain-insight {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: linear-gradient(135deg, rgba(247, 147, 26, 0.08) 0%, rgba(247, 147, 26, 0.02) 100%);
    border: 1px solid rgba(247, 147, 26, 0.15);
    border-radius: 12px;
}

.timechain-insight .insight-icon {
    color: #facc15;
    font-size: 1rem;
    margin-top: 2px;
}

.timechain-insight .insight-text {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.6;
}

.timechain-insight strong {
    color: #f7931a;
}

.timechain-footer {
    padding: 20px 30px 25px;
    border-top: 1px solid rgba(247, 147, 26, 0.1);
}

.epoch-timeline {
    max-width: 600px;
    margin: 0 auto;
}

.epoch-bar {
    display: flex;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.05);
}

.epoch-segment {
    position: relative;
    transition: all 0.3s ease;
}

.epoch-segment.complete {
    background: linear-gradient(90deg, rgba(247, 147, 26, 0.4) 0%, rgba(247, 147, 26, 0.6) 100%);
}

.epoch-segment.active {
    background: linear-gradient(90deg, rgba(247, 147, 26, 0.6) 0%, rgba(247, 147, 26, 0.3) 100%);
}

.epoch-current-marker {
    position: absolute;
    top: -3px;
    width: 14px;
    height: 14px;
    background: #f7931a;
    border: 2px solid #fff;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(247, 147, 26, 0.8);
    left: 0%;
    transition: left 0.5s ease;
}

.epoch-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.4);
}

@media (max-width: 600px) {
    .timechain-stats-grid {
        grid-template-columns: 1fr;
    }
    .block-height-value {
        font-size: 2.2rem;
    }
}

.clock-block-height {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2.5rem;
    color: #f7931a;
    font-weight: 700;
    letter-spacing: 2px;
}

.clock-block-label {
    font-size: 0.65rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-top: 5px;
}

.clock-since-block {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.2rem;
    color: white;
    margin-top: 20px;
}

.clock-halving-countdown {
    margin-top: 20px;
    padding: 15px 25px;
    background: rgba(247, 147, 26, 0.1);
    border: 1px solid rgba(247, 147, 26, 0.2);
    border-radius: 10px;
}

.clock-halving-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.1rem;
    color: #f7931a;
}

.clock-halving-label {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
}

/* BITCOIN HEARTBEAT AUDIO */
.heartbeat-audio-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    padding: 20px;
    background: rgba(0,0,0,0.4);
    border-radius: 12px;
}

.audio-toggle-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(220, 38, 38, 0.2);
    border: 2px solid #dc2626;
    color: #dc2626;
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.audio-toggle-btn:hover {
    background: rgba(220, 38, 38, 0.4);
    transform: scale(1.05);
}

.audio-toggle-btn.active {
    background: #dc2626;
    color: white;
    animation: audioPulse 1.5s ease-in-out infinite;
}

@keyframes audioPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
    50% { box-shadow: 0 0 20px 10px rgba(220, 38, 38, 0); }
}

.audio-status {
    text-align: center;
}

.audio-status-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    color: rgba(255,255,255,0.7);
}

.audio-status-sub {
    font-size: 0.65rem;
    color: rgba(255,255,255,0.4);
    margin-top: 4px;
}

.audio-visualizer {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 40px;
}

.audio-bar {
    width: 4px;
    background: #dc2626;
    border-radius: 2px;
    transition: height 0.1s;
}

/* GENESIS BLOCK SHRINE - Apple Style (Simplified) */
.genesis-shrine {
    background: var(--apple-card) !important;
    border: 1px solid var(--apple-card-border) !important;
    border-radius: 20px;
    padding: var(--space-md);
    position: relative;
    overflow: hidden;
    box-shadow: none !important;
}

.genesis-shrine::before {
    content: '';
    position: absolute;
    top: 0;
    left: 20%;
    right: 20%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(247, 147, 26, 0.3), transparent);
}

.genesis-flame {
    display: none;
}

@keyframes flameFlicker {
    0% { transform: scale(1); opacity: 0.9; }
    100% { transform: scale(1); opacity: 1; }
}

.genesis-content {
    display: flex;
    align-items: flex-start;
    gap: 25px;
    flex-wrap: wrap;
}

.genesis-block-visual {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #f7931a 0%, #c16c00 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    box-shadow: 0 0 30px rgba(247, 147, 26, 0.3);
}

.genesis-info {
    flex: 1;
    min-width: 200px;
}

.genesis-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
    color: #f7931a;
    margin-bottom: 5px;
}

.genesis-date {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.5);
    margin-bottom: 15px;
}

.genesis-headline {
    font-style: italic;
    font-size: 0.85rem;
    color: rgba(255,255,255,0.8);
    padding: 12px 15px;
    background: rgba(0,0,0,0.4);
    border-left: 3px solid #f7931a;
    border-radius: 0 8px 8px 0;
}

.genesis-expand-btn {
    margin-top: 15px;
    padding: 8px 16px;
    background: transparent;
    border: 1px solid rgba(247, 147, 26, 0.3);
    border-radius: 6px;
    color: #f7931a;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.2s;
}

.genesis-expand-btn:hover {
    background: rgba(247, 147, 26, 0.1);
}

/* CALL TO ACTION */
.cta-section {
    background: linear-gradient(180deg, rgba(10, 10, 10, 0.9) 0%, rgba(5, 5, 5, 0.95) 100%);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 16px;
    padding: 40px;
}

.cta-title {
    text-align: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 3px;
    color: rgba(255,255,255,0.6);
    margin-bottom: 30px;
}

.cta-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.cta-option {
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 20px 15px;
    text-align: center;
    transition: all 0.3s;
    cursor: pointer;
    text-decoration: none;
    overflow: hidden;
    box-sizing: border-box;
}

.cta-option:hover {
    border-color: #f7931a;
    background: rgba(247, 147, 26, 0.05);
    transform: translateY(-3px);
}

.cta-option-icon {
    font-size: 2rem;
    margin-bottom: 15px;
}

.cta-option-icon.email { color: #dc2626; }
.cta-option-icon.nostr { color: #8b5cf6; }
.cta-option-icon.twitter { color: #1da1f2; }
.cta-option-icon.lightning { color: #f7931a; }

.cta-option-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    color: white;
    margin-bottom: 8px;
}

.cta-option-desc {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
}

.cta-email-form {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
    width: 100%;
    max-width: 100%;
}

.cta-email-input {
    flex: 1;
    min-width: 120px;
    padding: 10px 12px;
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    color: white;
    font-size: 0.8rem;
    box-sizing: border-box;
}

.cta-email-btn {
    padding: 10px 15px;
    background: #dc2626;
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 0.8rem;
    cursor: pointer;
    transition: background 0.2s;
    white-space: nowrap;
    flex-shrink: 0;
}

.cta-email-btn:hover {
    background: #b91c1c;
}

/* SOVEREIGN INTELLIGENCE DASHBOARD */
.sovereign-dashboard {
    background: #000000;
    padding: 40px 0 60px;
    border-top: 1px solid rgba(255,255,255,0.05);
    margin-top: 0;
}

@media (max-width: 768px) {
    .sovereign-dashboard {
        padding: 30px 15px 40px;
    }
}

.dashboard-divider {
    height: 2px;
    background: linear-gradient(90deg, #dc2626 0%, transparent 100%);
    margin-bottom: 1rem;
}

/* Stat Cards - Apple Style */
.stat-card {
    background: var(--apple-card);
    border: 1px solid var(--apple-card-border);
    border-radius: 16px;
    padding: var(--space-md);
    transition: transform 0.2s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
    border-color: var(--apple-card-border);
}

.stat-label {
    display: block;
    font-size: 0.7rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    color: var(--apple-text-tertiary);
    text-transform: uppercase;
    margin-bottom: var(--space-xs);
}

.stat-value {
    font-family: 'SF Pro Display', -apple-system, sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: -0.03em;
    color: var(--apple-text-primary);
    word-break: break-word;
    overflow-wrap: break-word;
}

@media (max-width: 768px) {
    .stat-value {
        font-size: 1.4rem;
    }
    .stat-card {
        padding: var(--space-sm) !important;
    }
    .stat-label {
        font-size: 0.6rem;
    }
    .stat-note {
        font-size: 0.55rem;
    }
}

.stat-note {
    font-size: 0.75rem;
    color: var(--apple-text-secondary);
    margin-top: 4px;
}

/* FORCE BLACK BACKGROUNDS - NO WHITE GAPS */
html, body {
    background: #000 !important;
}

/* GRADIENT FADE OVERLAYS - MUST NOT BLOCK CLICKS */
.video-fade-top {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 120px;
    background: linear-gradient(to bottom, #000000 0%, rgba(0,0,0,0.5) 50%, transparent 100%);
    z-index: 2;
    pointer-events: none !important;
}

.video-fade-bottom {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 200px;
    background: linear-gradient(to top, #000000 0%, rgba(0,0,0,0.7) 40%, transparent 100%);
    z-index: 2;
    pointer-events: none !important;
}

/* VISUALIZER MUST RECEIVE ALL MOUSE EVENTS */
#visualizer-container {
    z-index: 10 !important;
    pointer-events: auto !important;
}

#visualizer-canvas {
    pointer-events: auto !important;
}

/* VIDEO MUST NOT BLOCK CLICKS */
#pulse-bg-video {
    pointer-events: none !important;
}

.terminal-container {
    position: relative;
    width: 100%;
    min-height: auto;
    background: transparent;
    overflow: hidden;
}

/* LIVE TERMINAL PAGE SPECIFIC - Video Background */
.pulse-video-background {
    position: fixed;
    inset: 0;
    z-index: -2;
    overflow: hidden;
    pointer-events: none;
}

#pulse-bg-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

/* Transparent containers for video visibility - ONLY on this page */
.terminal-container,
.visualizer-container,
#visualizer-container,
#visualizer-canvas {
    background: transparent !important;
    background-color: transparent !important;
}

/* Kill any pseudo-element overlays */
.terminal-container::before,
.terminal-container::after,
.visualizer-container::before,
.visualizer-container::after {
    display: none !important;
}

/* Visualizer canvas must sit above the video */
.visualizer-container,
#visualizer-canvas {
    position: relative;
    z-index: 1;
}

.back-nav {
    position: fixed;
    top: 80px;
    left: 20px;
    z-index: 1000;
}

.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: var(--pp-glass);
    border: 1px solid rgba(247, 147, 26, 0.3);
    border-radius: 12px;
    padding: 12px 20px;
    color: #fff;
    text-decoration: none;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    backdrop-filter: blur(20px);
    transition: all 0.3s ease;
}

.back-btn:hover {
    background: rgba(247, 147, 26, 0.2);
    border-color: var(--pp-bitcoin);
    color: #fff;
    transform: translateX(-3px);
    box-shadow: 0 0 20px var(--pp-bitcoin-glow);
}

.back-btn i {
    color: var(--pp-bitcoin);
}

.bitfeed-frame {
    width: 100%;
    height: 50vh;
    border: none;
    filter: hue-rotate(330deg) saturate(1.2);
}

#blockchain-visualizer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
}

.visualizer-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: transparent;
    z-index: 1;
}

#visualizer-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100% !important;
    height: 100% !important;
    display: block;
    background: transparent !important;
}

.viz-hud {
    position: absolute;
    top: 80px;
    left: 25px;
    background: transparent;
    backdrop-filter: none;
    border: none;
    border-radius: 0;
    padding: 0;
    z-index: 1001;
    font-family: 'JetBrains Mono', monospace;
    pointer-events: none;
    transform: perspective(800px) rotateY(2deg);
}

.sovereign-active .viz-hud {
    border: none;
    background: transparent;
    box-shadow: none;
}

.viz-hud-title {
    font-size: 0.65rem;
    color: #dc2626;
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    text-shadow: 0 0 10px rgba(220, 38, 38, 0.6), 0 2px 4px rgba(0, 0, 0, 0.8);
}

.sovereign-active .viz-hud-title {
    color: #a855f7;
    text-shadow: 0 0 10px rgba(168, 85, 247, 0.6), 0 2px 4px rgba(0, 0, 0, 0.8);
}

.viz-hud-title::before {
    content: '';
    width: 6px;
    height: 6px;
    background: currentColor;
    border-radius: 50%;
    animation: pulse-dot 1.5s infinite;
    box-shadow: 0 0 8px currentColor;
}

.viz-metric {
    display: flex;
    justify-content: flex-start;
    gap: 12px;
    padding: 6px 0;
    border-bottom: none;
}

.viz-metric:last-child {
    border-bottom: none;
}

.viz-metric-label {
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.65rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

.viz-metric-value {
    color: #fff;
    font-size: 0.85rem;
    font-weight: 600;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.3), 0 2px 4px rgba(0, 0, 0, 0.8);
}

.viz-legend {
    margin-top: 20px;
    padding-top: 0;
    border-top: none;
}

.viz-legend-title {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.35);
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

.viz-legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.5);
    margin-bottom: 5px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

.viz-legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    box-shadow: 0 0 6px currentColor;
}

.viz-legend-dot.low { background: #22c55e; box-shadow: 0 0 6px #22c55e; }
.viz-legend-dot.medium { background: #eab308; box-shadow: 0 0 6px #eab308; }
.viz-legend-dot.high { background: #dc2626; box-shadow: 0 0 6px #dc2626; }

.sovereign-active .viz-legend-dot.low { background: #a855f7; box-shadow: 0 0 6px #a855f7; }
.sovereign-active .viz-legend-dot.medium { background: #8b5cf6; box-shadow: 0 0 6px #8b5cf6; }
.sovereign-active .viz-legend-dot.high { background: #6b21a8; box-shadow: 0 0 6px #6b21a8; }

.viz-toggle-container {
    position: fixed;
    bottom: 70px;
    right: 20px;
    z-index: 1001;
    display: flex;
    gap: 10px;
}

.viz-toggle-btn {
    background: rgba(10, 10, 10, 0.85);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(220, 38, 38, 0.3);
    border-radius: 8px;
    padding: 10px 15px;
    color: #fff;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.viz-toggle-btn:hover {
    border-color: #dc2626;
    background: rgba(220, 38, 38, 0.2);
}

.viz-toggle-btn.active {
    background: rgba(220, 38, 38, 0.3);
    border-color: #dc2626;
}

.sovereign-active .viz-toggle-btn {
    border-color: rgba(168, 85, 247, 0.4);
}

.sovereign-active .viz-toggle-btn:hover,
.sovereign-active .viz-toggle-btn.active {
    border-color: #a855f7;
    background: rgba(168, 85, 247, 0.2);
}

.terminal-hud {
    position: absolute !important;
    top: 80px;
    right: 20px;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(220, 38, 38, 0.2);
    border-radius: 8px;
    padding: 15px;
    min-width: 180px;
    z-index: 50;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    pointer-events: auto;
}

.hud-title {
    font-family: 'JetBrains Mono', monospace;
    color: #dc2626;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    text-shadow: 0 0 10px rgba(220, 38, 38, 0.6), 0 2px 4px rgba(0, 0, 0, 0.8);
}

.hud-title::before {
    content: '';
    width: 6px;
    height: 6px;
    background: #dc2626;
    border-radius: 50%;
    animation: pulse-dot 1.5s infinite;
    box-shadow: 0 0 8px #dc2626;
}

@keyframes pulse-dot {
    0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
    50% { opacity: 0.6; box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
}

.hud-metric {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    gap: 10px;
    padding: 6px 0;
    border-bottom: none;
}

.hud-metric:last-child {
    border-bottom: none;
}

.metric-label {
    font-family: 'JetBrains Mono', monospace;
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

.metric-value {
    font-family: 'JetBrains Mono', monospace;
    color: #fff;
    font-size: 0.9rem;
    font-weight: 600;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.3), 0 2px 4px rgba(0, 0, 0, 0.8);
}

.metric-value.fee-low { color: #22c55e; text-shadow: 0 0 8px rgba(34, 197, 94, 0.5), 0 2px 4px rgba(0, 0, 0, 0.8); }
.metric-value.fee-medium { color: #eab308; text-shadow: 0 0 8px rgba(234, 179, 8, 0.5), 0 2px 4px rgba(0, 0, 0, 0.8); }
.metric-value.fee-high { color: #dc2626; text-shadow: 0 0 8px rgba(220, 38, 38, 0.5), 0 2px 4px rgba(0, 0, 0, 0.8); }

.latest-block {
    background: transparent;
    border-radius: 0;
    padding: 10px 0;
    margin-top: 15px;
}

.block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.block-height {
    font-family: 'JetBrains Mono', monospace;
    color: var(--pp-red);
    font-size: 1.2rem;
    font-weight: 700;
}

.block-time {
    font-family: 'JetBrains Mono', monospace;
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.75rem;
}

.block-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.block-stat {
    text-align: center;
}

.block-stat-label {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
}

.block-stat-value {
    font-family: 'JetBrains Mono', monospace;
    color: #fff;
    font-size: 0.9rem;
}

.terminal-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--pp-glass);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(220, 38, 38, 0.2);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
}

.terminal-status {
    display: flex;
    align-items: center;
    gap: 20px;
}

.status-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.7);
}

.status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #22c55e;
}

.terminal-source {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.4);
}

.terminal-source a {
    color: var(--pp-red);
    text-decoration: none;
}

.mempool-viz {
    position: relative;
    height: 60px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    overflow: hidden;
    margin-top: 15px;
}

.mempool-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, var(--pp-red), rgba(220, 38, 38, 0.3));
    transition: height 0.5s ease;
}

.mempool-label {
    position: absolute;
    bottom: 5px;
    left: 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.8);
    z-index: 1;
}

/* Mobile TX Popup Card */
.tx-popup-card {
    display: none;
    position: fixed;
    bottom: 50%;
    left: 50%;
    transform: translate(-50%, 50%);
    background: rgba(10, 10, 10, 0.95);
    border: 2px solid rgba(247, 147, 26, 0.6);
    border-radius: 16px;
    padding: 25px;
    z-index: 2000;
    font-family: 'JetBrains Mono', monospace;
    backdrop-filter: blur(20px);
    min-width: 280px;
    max-width: 90vw;
    box-shadow: 0 0 40px rgba(247, 147, 26, 0.3);
    animation: popupSlide 0.3s ease-out;
}

@keyframes popupSlide {
    from { transform: translate(-50%, 50%) scale(0.8); opacity: 0; }
    to { transform: translate(-50%, 50%) scale(1); opacity: 1; }
}

.tx-popup-card.show {
    display: block;
}

.tx-popup-close {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.5);
    font-size: 1.5rem;
    cursor: pointer;
    line-height: 1;
}

.tx-popup-close:hover {
    color: #fff;
}

.tx-popup-header {
    color: #f7931a;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.tx-popup-header::before {
    content: '';
    font-size: 1.2rem;
}

.tx-popup-amount {
    font-size: 1.8rem;
    font-weight: bold;
    color: #22c55e;
    margin-bottom: 8px;
}

.tx-popup-fiat {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.5);
    margin-bottom: 15px;
}

.tx-popup-txid {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 15px;
}

.tx-popup-txid-label {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 6px;
}

.tx-popup-txid-value {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.8);
    word-break: break-all;
    line-height: 1.4;
}

.tx-popup-meta {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    padding: 10px 0;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.tx-popup-meta-item {
    text-align: center;
}

.tx-popup-meta-label {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.4);
    text-transform: uppercase;
    margin-bottom: 4px;
}

.tx-popup-meta-value {
    font-size: 0.85rem;
    color: #fff;
}

.tx-popup-verify {
    display: block;
    width: 100%;
    background: linear-gradient(135deg, #f7931a 0%, #c16c00 100%);
    border: none;
    border-radius: 10px;
    padding: 14px;
    color: #000 !important;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-decoration: none;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto !important;
    position: relative;
    z-index: 2001;
    -webkit-tap-highlight-color: rgba(247, 147, 26, 0.3);
}

.tx-popup-verify:hover,
.tx-popup-verify:active {
    transform: scale(1.02);
    box-shadow: 0 0 20px rgba(247, 147, 26, 0.5);
    color: #000 !important;
    text-decoration: none;
}

.tx-popup-verify i {
    margin-right: 8px;
}

.tx-popup-card {
    pointer-events: auto !important;
}

.tx-popup-card * {
    pointer-events: auto;
}

.tx-popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: 1999;
}

.tx-popup-overlay.show {
    display: block;
}

@media (max-width: 768px) {
    .back-nav {
        top: 70px;
        left: 10px;
    }
    
    .back-btn {
        padding: 8px 12px;
        font-size: 0.75rem;
    }
    
    .back-btn span {
        display: none;
    }
    
    .viz-hud {
        position: absolute !important;
        top: 60px !important;
        bottom: auto !important;
        left: 10px !important;
        right: auto !important;
        max-width: 140px;
        padding: 8px 10px;
        background: rgba(0, 0, 0, 0.85) !important;
        backdrop-filter: blur(10px);
        border-radius: 8px;
        transform: none !important;
        z-index: 1002 !important;
    }
    
    .viz-hud-title {
        font-size: 0.55rem;
        margin-bottom: 8px;
    }
    
    .viz-metric-label {
        font-size: 0.55rem;
    }
    
    .viz-metric-value {
        font-size: 0.7rem;
    }
    
    .viz-hud-title {
        font-size: 0.65rem;
    }
    
    .viz-metric {
        padding: 6px 0;
    }
    
    .viz-metric-label {
        font-size: 0.6rem;
    }
    
    .viz-metric-value {
        font-size: 0.8rem;
    }
    
    .viz-legend {
        display: none;
    }
    
    .terminal-hud {
        display: none;
    }
    
    .viz-toggle-container {
        bottom: 80px;
        right: 10px;
        left: 10px;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
    }
    
    .viz-toggle-btn {
        padding: 8px 12px;
        font-size: 0.7rem;
        flex: 1;
        min-width: 80px;
        text-align: center;
    }
    
    .terminal-footer {
        padding: 8px 10px;
        flex-direction: column;
        gap: 5px;
    }
    
    .terminal-status {
        gap: 10px;
    }
    
    .status-item {
        font-size: 0.65rem;
    }
    
    .terminal-source {
        font-size: 0.6rem;
    }
    
    .visualizer-container {
        height: 100%;
    }
    
    .terminal-container {
        min-height: auto;
    }
}

@media (max-width: 480px) {
    .viz-hud {
        bottom: 130px;
        padding: 10px 12px;
    }
    
    .viz-toggle-container {
        bottom: 70px;
    }
    
    .viz-toggle-btn {
        padding: 6px 10px;
        font-size: 0.65rem;
    }
    
    .viz-toggle-btn i {
        display: none;
    }
    
    /* Mobile TXID visualizer - zoom in for larger blocks */
    #live-terminal-wrapper {
        aspect-ratio: 4/3 !important;
    }
    
    .visualizer-container,
    #visualizer-container {
        transform: scale(1.4) !important;
        transform-origin: center 55% !important;
        top: 100px !important;
        height: calc(100% - 140px) !important;
    }
    
    /* Lighten gradients on mobile so video is more visible */
    .video-fade-top {
        height: 60px !important;
        background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, transparent 100%) !important;
    }
    
    .video-fade-bottom {
        height: 100px !important;
        background: linear-gradient(to top, rgba(0,0,0,0.5) 0%, transparent 100%) !important;
    }
    
    /* Brighten video on mobile */
    #pulse-bg-video {
        filter: brightness(0.8) !important;
        top: 0 !important;
    }
    
    /* Buffer before Sovereign Health section */
    .zone-logic-engine {
        margin-top: 30px !important;
    }
}

/* ============================================
   PHASE 7: VISUAL CLUTTER REDUCTION
   ============================================ */

/* Remove excessive animations that create visual noise */
@keyframes seismicPulse { 0%, 100% { box-shadow: none; } }

/* Simplify globe and command center showcases */
.node-globe-showcase {
    background: var(--apple-card) !important;
    border: 1px solid var(--apple-card-border) !important;
}

/* RUN YOUR OWN NODE GUIDE */
.run-node-guide {
    background: linear-gradient(180deg, rgba(59, 130, 246, 0.08) 0%, rgba(59, 130, 246, 0.02) 100%);
    border-top: 1px solid rgba(59, 130, 246, 0.2);
    padding: 40px 30px;
}

.guide-header {
    text-align: center;
    max-width: 700px;
    margin: 0 auto 35px;
}

.guide-badge {
    display: inline-block;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.1) 100%);
    border: 1px solid rgba(59, 130, 246, 0.5);
    border-radius: 20px;
    padding: 6px 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: #3b82f6;
    letter-spacing: 0.15em;
    margin-bottom: 15px;
}

.guide-header h3 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.4rem;
    color: #fff;
    margin-bottom: 15px;
}

.guide-header h3 i {
    color: #3b82f6;
    margin-right: 10px;
}

.guide-intro {
    font-size: 0.95rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.7;
}

.guide-intro strong {
    color: #3b82f6;
}

.guide-why-section {
    max-width: 900px;
    margin: 0 auto 40px;
}

.guide-why-section h4,
.guide-paths h4,
.guide-tips h4 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.guide-why-section h4 i,
.guide-paths h4 i,
.guide-tips h4 i {
    color: #3b82f6;
}

.why-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.why-card {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
}

.why-card:hover {
    border-color: rgba(59, 130, 246, 0.3);
    background: rgba(59, 130, 246, 0.05);
}

.why-icon {
    font-size: 1.8rem;
    flex-shrink: 0;
}

.why-text strong {
    display: block;
    color: #fff;
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.why-text span {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
    line-height: 1.5;
}

.guide-paths {
    max-width: 900px;
    margin: 0 auto 40px;
}

.path-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: 20px;
}

.path-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.path-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
}

.path-card.easy {
    border-color: rgba(34, 197, 94, 0.3);
}

.path-card.easy:hover {
    border-color: rgba(34, 197, 94, 0.5);
}

.path-card.diy {
    border-color: rgba(168, 85, 247, 0.3);
}

.path-card.diy:hover {
    border-color: rgba(168, 85, 247, 0.5);
}

.path-header {
    padding: 20px;
    background: rgba(255, 255, 255, 0.02);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.path-badge {
    display: inline-block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    padding: 4px 10px;
    border-radius: 4px;
    margin-bottom: 10px;
}

.path-badge.easy {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.4);
}

.path-badge.diy {
    background: rgba(168, 85, 247, 0.2);
    color: #a855f7;
    border: 1px solid rgba(168, 85, 247, 0.4);
}

.path-header h5 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.1rem;
    color: #fff;
    margin: 0 0 8px 0;
}

.path-header p {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    margin: 0;
}

.path-steps {
    padding: 20px;
}

.path-steps .step {
    display: flex;
    gap: 15px;
    margin-bottom: 18px;
}

.path-steps .step:last-child {
    margin-bottom: 0;
}

.step-num {
    width: 28px;
    height: 28px;
    background: rgba(59, 130, 246, 0.2);
    border: 1px solid rgba(59, 130, 246, 0.4);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: #3b82f6;
    flex-shrink: 0;
}

.step-content strong {
    display: block;
    color: #fff;
    font-size: 0.85rem;
    margin-bottom: 4px;
}

.step-content span {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    line-height: 1.5;
}

.step-content a {
    color: #3b82f6;
    text-decoration: none;
}

.step-content a:hover {
    text-decoration: underline;
}

.path-footer {
    display: flex;
    justify-content: space-between;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.5);
}

.path-footer i {
    margin-right: 5px;
    opacity: 0.7;
}

.guide-tips {
    max-width: 900px;
    margin: 0 auto 40px;
}

.tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 12px;
}

.tip {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 10px;
    padding: 15px;
}

.tip i {
    color: #facc15;
    font-size: 1rem;
    margin-top: 2px;
    flex-shrink: 0;
}

.tip span {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    line-height: 1.5;
}

.tip strong {
    color: rgba(255, 255, 255, 0.9);
}

.guide-cta {
    max-width: 700px;
    margin: 0 auto;
    text-align: center;
}

.cta-message {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.05) 100%);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 12px;
    padding: 20px 25px;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.cta-message i {
    font-size: 1.5rem;
    color: #3b82f6;
}

.cta-message span {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
}

.cta-message strong {
    color: #3b82f6;
}

.cta-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.guide-cta .cta-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 14px 28px;
    border-radius: 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    text-decoration: none;
    transition: all 0.3s ease;
}

.guide-cta .cta-btn.primary {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: #fff;
    border: none;
}

.guide-cta .cta-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}

.guide-cta .cta-btn.secondary {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.8);
}

.guide-cta .cta-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
}

@media (max-width: 700px) {
    .run-node-guide {
        padding: 30px 20px;
    }
    .path-options {
        grid-template-columns: 1fr;
    }
    .cta-buttons {
        flex-direction: column;
    }
    .guide-cta .cta-btn {
        width: 100%;
        justify-content: center;
    }
}

/* Globe Zoom Controls - Mobile-first, visible on all devices */
.globe-zoom-controls {
    position: absolute;
    bottom: 15px;
    left: 15px;
    z-index: 10;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.globe-zoom-btn {
    width: 44px;
    height: 44px;
    background: rgba(59, 130, 246, 0.2);
    border: 1px solid rgba(59, 130, 246, 0.4);
    border-radius: 10px;
    color: #3b82f6;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

.globe-zoom-btn:hover {
    background: rgba(59, 130, 246, 0.35);
    border-color: rgba(59, 130, 246, 0.7);
    transform: scale(1.05);
}

.globe-zoom-btn:active {
    transform: scale(0.95);
    background: rgba(59, 130, 246, 0.5);
}

/* Show zoom controls on touch devices with larger buttons */
@media (hover: none) and (pointer: coarse) {
    .globe-zoom-controls {
        display: flex;
    }
    .globe-zoom-btn {
        width: 52px;
        height: 52px;
        font-size: 1.2rem;
    }
}

.pulse-command-center {
    background: var(--apple-card) !important;
    border: 1px solid var(--apple-card-border) !important;
}

/* Simplify purchasing power showcase */
.purchasing-power-showcase {
    background: var(--apple-card) !important;
    border: 1px solid var(--apple-card-border) !important;
}

/* Purchasing Power header mobile fix */
@media (max-width: 768px) {
    .purchasing-power-showcase .module-header {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 15px !important;
    }
    .purchasing-power-showcase .module-header > div:last-child {
        align-self: flex-start !important;
        width: auto !important;
    }
}

/* ============================================
   PHASE 8: MOBILE REFINEMENTS
   ============================================ */

@media (max-width: 768px) {
    :root {
        --space-md: 20px;
        --space-lg: 40px;
    }
    
    .glass-module,
    .instrument-panel,
    .archive-folder {
        border-radius: 16px;
        padding: var(--space-sm);
    }
    
    .module-title {
        font-size: 0.95rem;
    }
    
    .dashboard-grid {
        grid-template-columns: 1fr;
        gap: var(--space-sm);
    }
    
    .knots-core-comparison {
        grid-template-columns: 1fr !important;
    }
}

/* Apple-style body font smoothing */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    letter-spacing: -0.01em;
    line-height: 1.5;
}

/* Bitcoin Heartbeat Audio Toggle - Clean Glassmorphism */
.heartbeat-toggle-wrapper {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 20px;
}

.audio-toggle-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    padding: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 
        0 4px 20px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.audio-toggle-btn:hover {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%);
    border-color: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
}

.audio-toggle-btn i {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.6);
    transition: all 0.3s ease;
}

.heartbeat-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.heartbeat-text .heartbeat-label {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
}

.heartbeat-text .heartbeat-status {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.4);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
}

.audio-toggle-btn.active {
    background: linear-gradient(135deg, rgba(247, 147, 26, 0.2) 0%, rgba(247, 147, 26, 0.08) 100%);
    border-color: rgba(247, 147, 26, 0.4);
    box-shadow: 
        0 4px 24px rgba(247, 147, 26, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.audio-toggle-btn.active i {
    color: #f7931a;
    animation: heartbeatPulse 1s ease-in-out infinite;
}

.audio-toggle-btn.active + .heartbeat-text .heartbeat-label {
    color: rgba(247, 147, 26, 0.9);
}

.audio-toggle-btn.active + .heartbeat-text .heartbeat-status {
    color: rgba(247, 147, 26, 0.6);
}

@keyframes heartbeatPulse {
    0%, 100% { transform: scale(1); }
    15% { transform: scale(1.15); }
    30% { transform: scale(1); }
    45% { transform: scale(1.1); }
}

/* Lightning Pulse Module */
.lightning-pulse-showcase {
    background: linear-gradient(180deg, rgba(250, 204, 21, 0.08) 0%, rgba(234, 179, 8, 0.03) 100%);
    border: 1px solid rgba(250, 204, 21, 0.3);
    border-radius: 20px;
    overflow: hidden;
}

/* Lightning Pulse responsive grid - target the grid container (2nd child div) */
@media (max-width: 768px) {
    #panel-lightning-pulse .lightning-pulse-showcase > div:nth-of-type(2) {
        grid-template-columns: 1fr !important;
    }
    #panel-lightning-pulse .lightning-pulse-showcase > div:nth-of-type(2) > div:first-child {
        border-right: none !important;
        border-bottom: 1px solid rgba(250, 204, 21, 0.2);
    }
}

.lightning-zap {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    margin-bottom: 8px;
    animation: zapSlideIn 0.3s ease-out;
}

@keyframes zapSlideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
}

.zap-icon {
    font-size: 1.2rem;
    color: #facc15;
    animation: zapFlash 0.5s ease-out;
}

@keyframes zapFlash {
    0% { opacity: 0; transform: scale(1.5); }
    50% { opacity: 1; }
    100% { transform: scale(1); }
}
</style>
{% endblock %}

{% block content %}
<!-- Whale Alert Banner -->
<div id="whale-alert-banner"></div>

<nav class="back-nav">
    <a href="/" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Home</span>
    </a>
</nav>

<!-- Mobile TX Popup Card (outside terminal-container for proper z-index) -->
<div class="tx-popup-overlay" id="tx-popup-overlay" onclick="closeTxPopup()"></div>
<div class="tx-popup-card" id="tx-popup-card">
    <button class="tx-popup-close" onclick="closeTxPopup()">&times;</button>
    <div class="tx-popup-header">Transaction Details</div>
    <div class="tx-popup-amount" id="tx-popup-amount">0.0000 BTC</div>
    <div class="tx-popup-fiat" id="tx-popup-fiat">~$0.00 USD</div>
    <div class="tx-popup-txid">
        <div class="tx-popup-txid-label">Transaction ID</div>
        <div class="tx-popup-txid-value" id="tx-popup-txid">...</div>
    </div>
    <div class="tx-popup-meta">
        <div class="tx-popup-meta-item">
            <div class="tx-popup-meta-label">Fee Rate</div>
            <div class="tx-popup-meta-value" id="tx-popup-fee">-- sat/vB</div>
        </div>
        <div class="tx-popup-meta-item">
            <div class="tx-popup-meta-label">Status</div>
            <div class="tx-popup-meta-value" style="color: #eab308;">Unconfirmed</div>
        </div>
    </div>
    <button type="button" class="tx-popup-verify" id="tx-popup-verify">
        <i class="fas fa-external-link-alt"></i>Verify on Mempool.space
    </button>
</div>


<!-- ============================================
     ZONE 1: TACTICAL HORIZON
     The Cinematic Hook - Pure Visualizer Experience
     ============================================ -->
<div class="zone-tactical-horizon">
    <!-- Sovereign Status Bar - Inside Zone 1 -->
    <div class="sovereign-status-bar zone-status">
        <div class="container d-flex justify-content-around align-items-center">
            <!-- Bitcoin Heartbeat Audio Indicator - Subtle World-Class Touch -->
            <div class="heartbeat-audio-indicator" id="heartbeat-indicator" onclick="toggleHeartbeatAudio()" title="Toggle Bitcoin Heartbeat">
                <div class="heartbeat-pulse-ring"></div>
                <div class="heartbeat-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="heartbeat-waveform">
                    <span class="wave-bar"></span>
                    <span class="wave-bar"></span>
                    <span class="wave-bar"></span>
                    <span class="wave-bar"></span>
                    <span class="wave-bar"></span>
                </div>
            </div>
            
            <div class="status-metric">
                <span class="status-label">Sats/vB</span>
                <span class="status-value highlight data-mono" id="status-fee-rate">--</span>
            </div>
            <div class="status-metric rec-indicator">
                <span class="rec-dot"></span>
                <span class="status-label">Hashrate</span>
                <span class="status-value data-mono" id="status-hashrate">-- EH/s</span>
            </div>
            <div class="status-metric">
                <span class="status-label">Blocks to Retarget</span>
                <span class="status-value data-mono" id="status-retarget">--</span>
            </div>
        </div>
    </div>
    
    <div id="live-terminal-wrapper" style="position: relative; width: 100%; aspect-ratio: 16/9; overflow: hidden; background-color: black;">
    <!-- Video Background - ABSOLUTE positioned behind visualizer, pushed down so TXIDs float above platform -->
    <video autoplay muted loop playsinline id="pulse-bg-video" 
           style="position: absolute; top: 15%; left: 50%; transform: translateX(-50%); width: 100%; height: 100%; object-fit: cover; z-index: 0; filter: brightness(0.6);">
        <source src="/static/video/pulse-bg.mp4" type="video/mp4">
    </video>
    
    <!-- Gradient Fade: Header into Video (top) -->
    <div class="video-fade-top"></div>
    
    <!-- Gradient Fade: Video into Footer/Dashboard (bottom) -->
    <div class="video-fade-bottom"></div>
    
    <!-- Custom Blockchain Visualizer - ABSOLUTE positioned above video -->
    <div class="visualizer-container" id="visualizer-container" 
         style="position: absolute; top: 80px; left: 0; width: 100%; height: calc(100% - 80px); z-index: 1; background: transparent !important;">
        <canvas id="visualizer-canvas" style="background: transparent !important;"></canvas>
    </div>
    
    <!-- Live Network Status HUD - INSIDE wrapper so it doesn't scroll with page -->
    <div class="terminal-hud">
        <div class="hud-title">Live Network Status</div>
        
        <div class="hud-metric">
            <span class="metric-label">Mempool Size</span>
            <span class="metric-value" id="mempool-size">Loading...</span>
        </div>
        
        <div class="hud-metric">
            <span class="metric-label">Pending TXs</span>
            <span class="metric-value" id="pending-txs">--</span>
        </div>
        
        <div class="hud-metric">
            <span class="metric-label">Next Block Fee</span>
            <span class="metric-value" id="next-block-fee">-- sat/vB</span>
        </div>
        
        <div class="hud-metric">
            <span class="metric-label">Low Priority</span>
            <span class="metric-value fee-low" id="low-fee">-- sat/vB</span>
        </div>
        
        <div class="mempool-viz">
            <div class="mempool-bar" id="mempool-bar" style="height: 20%"></div>
            <span class="mempool-label" id="mempool-mb">-- MB</span>
        </div>
        
        <div class="latest-block">
            <div class="block-header">
                <span class="block-height" id="block-height">#---,---</span>
                <span class="block-time" id="block-time">--:--</span>
            </div>
            <div class="block-stats">
                <div class="block-stat">
                    <div class="block-stat-label">TXs</div>
                    <div class="block-stat-value" id="block-txs">--</div>
                </div>
                <div class="block-stat">
                    <div class="block-stat-label">Size</div>
                    <div class="block-stat-value" id="block-size">-- MB</div>
                </div>
            </div>
        </div>
        
        <!-- Bitcoin Heartbeat Audio Toggle -->
        <div class="heartbeat-toggle-wrapper">
            <button id="audio-toggle" class="audio-toggle-btn" title="Toggle Bitcoin Heartbeat">
                <i class="fas fa-heartbeat" id="audio-icon"></i>
            </button>
            <div class="heartbeat-text">
                <span class="heartbeat-label">Bitcoin Heartbeat</span>
                <span class="heartbeat-status" id="audio-label">Tap to listen</span>
            </div>
        </div>
    </div>
    
    <!-- Visualizer HUD Overlay - INSIDE wrapper so it doesn't scroll -->
    <div class="viz-hud">
        <div class="viz-hud-title">Mempool Physics</div>
        <div class="viz-metric">
            <span class="viz-metric-label">Mempool Size</span>
            <span class="viz-metric-value" id="viz-mempool-size">-- MB</span>
        </div>
        <div class="viz-metric">
            <span class="viz-metric-label">Unconfirmed</span>
            <span class="viz-metric-value" id="viz-unconfirmed">--</span>
        </div>
        <div class="viz-legend">
            <div class="viz-legend-title">Fee Rate (sat/vB)</div>
            <div class="viz-legend-item">
                <span class="viz-legend-dot low"></span>
                <span>&lt; 10 (Low Priority)</span>
            </div>
            <div class="viz-legend-item">
                <span class="viz-legend-dot medium"></span>
                <span>10-50 (Medium)</span>
            </div>
            <div class="viz-legend-item">
                <span class="viz-legend-dot high"></span>
                <span>&gt; 50 (High Priority)</span>
            </div>
        </div>
    </div>
</div>

<div class="terminal-container" style="background: transparent !important;">
    
    
    <!-- Hidden iframe for external bitfeed (shown on toggle) -->
    <iframe 
        src="https://bits.monospace.live/" 
        class="bitfeed-frame" 
        id="bitfeed-iframe"
        allow="fullscreen"
        loading="lazy"
        style="display: none;"
    ></iframe>
    
    <div class="terminal-footer">
        <div class="terminal-status">
            <div class="status-item">
                <span class="status-dot"></span>
                <span>LIVE</span>
            </div>
            <div class="status-item">
                <span id="connection-status">Connected to Bitcoin Network</span>
            </div>
        </div>
        <div class="terminal-source">
            Powered by <a href="https://mempool.space" target="_blank">Mempool.space</a> | 
            Visualization by <a href="https://bits.monospace.live" target="_blank">Bitfeed</a>
        </div>
    </div>
</div>
</div><!-- END ZONE 1: TACTICAL HORIZON -->

<!-- ============================================
     ZONE 2: THE LOGIC ENGINE
     Dashboard Grid - High-Density Data Instruments
     ============================================ -->
<section class="zone-logic-engine">
    <div class="container">
        <div class="dashboard-grid" id="dashboard-grid">
        
<!-- SOVEREIGN HEALTH HUD - First Grid Item -->
<div class="instrument-panel" id="panel-sovereign-health" style="grid-column: span 2;">
        <div class="module-header" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);">
            <div class="module-icon" style="background: rgba(220, 38, 38, 0.15); border: 1px solid rgba(220, 38, 38, 0.3); color: #dc2626;"><i class="fas fa-heartbeat"></i></div>
            <div>
                <h3 class="module-title">Sovereign Health</h3>
                <p class="module-subtitle">Real-time Network Vitals</p>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-5">
                <div class="pulse-heartbeat">
                    <div class="heartbeat-visual">
                        <div class="heartbeat-ring"></div>
                        <div class="heartbeat-ring"></div>
                        <div class="heartbeat-core"></div>
                    </div>
                    <div class="heartbeat-info">
                        <div class="heartbeat-label">Network Heartbeat</div>
                        <div class="heartbeat-value" id="health-block-time">9:42</div>
                        <span class="heartbeat-status normal" id="health-status">On Schedule</span>
                        <div class="variance-alert" id="variance-alert" style="display: none;">
                            <div class="variance-alert-badge"><i class="fas fa-broadcast-tower"></i> SIGNAL</div>
                            <div class="variance-alert-text">High Variance Detected. The Poisson tail is lengthening. Block crystallization remains secure but delayed.</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-7">
                <div class="fee-friction-calc">
                    <div class="fee-friction-header">
                        <span class="fee-friction-title">Cost of Absolute Finality</span>
                        <span class="fee-friction-label">Fee-Friction Calculator</span>
                    </div>
                    <div class="fee-scale">
                        <div class="fee-tier">
                            <div class="fee-tier-label">Economy</div>
                            <div class="fee-tier-value low" id="fee-economy">1</div>
                            <div class="fee-tier-time">~60 min</div>
                        </div>
                        <div class="fee-tier">
                            <div class="fee-tier-label">Standard</div>
                            <div class="fee-tier-value medium" id="fee-standard">3</div>
                            <div class="fee-tier-time">~30 min</div>
                        </div>
                        <div class="fee-tier">
                            <div class="fee-tier-label">Priority</div>
                            <div class="fee-tier-value high" id="fee-priority">5</div>
                            <div class="fee-tier-time">~10 min</div>
                        </div>
                        <div class="fee-tier">
                            <div class="fee-tier-label">Urgent</div>
                            <div class="fee-tier-value urgent" id="fee-urgent">8</div>
                            <div class="fee-tier-time">Next Block</div>
                        </div>
                    </div>
                    <div class="finality-cost">
                        <div class="finality-label">Avg. Finality Cost (140 vB TX)</div>
                        <div class="finality-value" id="finality-cost">~$0.45</div>
                    </div>
                </div>
            </div>
        </div>
</div><!-- END panel-sovereign-health -->

<!-- NODE GLOBE - Dashboard Grid Item -->
<div class="instrument-panel" id="panel-node-globe" style="grid-column: span 2;">
    <div class="node-globe-showcase" style="background: linear-gradient(180deg, rgba(0, 20, 60, 0.95) 0%, rgba(0, 10, 30, 0.98) 100%); border: 2px solid rgba(59, 130, 246, 0.4); border-radius: 20px; padding: 0; overflow: hidden; position: relative;">
        <!-- Animated star field background -->
        <div class="globe-starfield" style="position: absolute; inset: 0; overflow: hidden; pointer-events: none;">
            <div class="star" style="top: 10%; left: 20%; animation-delay: 0s;"></div>
            <div class="star" style="top: 30%; left: 80%; animation-delay: 1s;"></div>
            <div class="star" style="top: 60%; left: 15%; animation-delay: 2s;"></div>
            <div class="star" style="top: 80%; left: 70%; animation-delay: 0.5s;"></div>
            <div class="star" style="top: 45%; left: 50%; animation-delay: 1.5s;"></div>
        </div>
        
        <div class="module-header" style="padding: 25px 30px 15px; border-bottom: 1px solid rgba(59, 130, 246, 0.2);">
            <div class="module-icon" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.1) 100%); border: 2px solid rgba(59, 130, 246, 0.5); color: #3b82f6; width: 50px; height: 50px; font-size: 1.3rem;">
                <i class="fas fa-globe-americas"></i>
            </div>
            <div>
                <h3 class="module-title" style="color: #3b82f6; font-size: 1.5rem; letter-spacing: 2px;">NODE GLOBE</h3>
                <p class="module-subtitle" style="color: rgba(255,255,255,0.6);">Bitcoin's Decentralized Nervous System</p>
            </div>
        </div>
        
        <div class="globe-main-container" style="display: flex; flex-wrap: wrap; min-height: 550px;">
            <!-- Globe visualization -->
            <div class="globe-visual-area" style="flex: 2; min-width: 300px; position: relative; display: flex; flex-direction: column;">
                <div class="globe-container" id="node-globe" style="height: 480px; flex-shrink: 0;">
                    <div class="globe-controls" style="position: absolute; top: 15px; right: 15px; z-index: 10;">
                        <button class="globe-control-btn" onclick="resetGlobeRotation()" title="Reset View" style="background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); color: #3b82f6;">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="globe-control-btn" onclick="toggleGlobeAutoRotate()" title="Auto-Rotate" style="background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); color: #3b82f6;">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    <!-- Mobile Zoom Controls -->
                    <div class="globe-zoom-controls" id="globe-zoom-controls">
                        <button class="globe-zoom-btn" onclick="event.preventDefault(); event.stopPropagation(); globeZoomIn(); return false;" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="globe-zoom-btn" onclick="event.preventDefault(); event.stopPropagation(); globeZoomOut(); return false;" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                    </div>
                    <!-- Node tooltip -->
                    <div id="node-tooltip" class="node-tooltip" style="display: none; position: absolute; background: rgba(0,0,0,0.95); border: 1px solid rgba(59, 130, 246, 0.6); border-radius: 8px; padding: 12px; pointer-events: none; z-index: 100; min-width: 200px; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);">
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; color: #3b82f6; margin-bottom: 6px;">NODE INTEL</div>
                        <div id="node-tooltip-content"></div>
                    </div>
                </div>
                
                <!-- ROTATING AD BANNER - Under the globe in blue area -->
                <div style="border-top: 1px solid rgba(59, 130, 246, 0.3); padding: 15px; text-align: center; min-height: 100px; display: flex; align-items: center; justify-content: center;">
                    <div id="globe-ad-container">
                        <!-- Ad Slot 1: Mining Partner -->
                        <div id="globe-ad-slot-1" class="globe-ad-slot" style="opacity: 0.95; transition: 0.3s;">
                            <a href="https://bitaxe.org" target="_blank" style="display: inline-block;">
                                <img src="/static/ads/CUrated_ad_92b6d00265774c62ae666607abf5ebcb.jpeg" alt="Mining Partner" style="max-width: 280px; max-height: 120px; border-radius: 10px; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);">
                            </a>
                            <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin: 12px 0 0;">Curated Mining Partner</p>
                        </div>
                        <!-- Ad Slot 2: Donate Sats -->
                        <div id="globe-ad-slot-2" class="globe-ad-slot" style="display: none;">
                            <div style="padding: 15px;">
                                <i class="fas fa-bolt" style="font-size: 2.5rem; color: #f7931a; margin-bottom: 12px;"></i>
                                <h4 style="color: #fff; margin: 10px 0; font-size: 1.1rem;">Support Protocol Pulse</h4>
                                <p class="text-muted mb-3" style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">Help us stay sovereign and ad-free</p>
                                <a href="/donate" class="btn" style="background: linear-gradient(135deg, #f7931a, #dc2626); color: #fff; padding: 12px 30px; border-radius: 10px; text-decoration: none; font-weight: bold; display: inline-block; box-shadow: 0 4px 20px rgba(247, 147, 26, 0.4);">
                                    <i class="fas fa-heart me-2"></i>Donate Sats
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Live stats panel -->
            <div class="globe-stats-panel" style="flex: 1; min-width: 280px; padding: 25px; background: rgba(0,0,0,0.3); border-left: 1px solid rgba(59, 130, 246, 0.2);">
                <div class="globe-stat-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.05) 100%); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                        <i class="fas fa-network-wired" style="color: #3b82f6; font-size: 1.2rem;"></i>
                        <span style="color: rgba(255,255,255,0.6); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;">Reachable Nodes</span>
                    </div>
                    <div id="globe-node-count" style="font-size: 2.2rem; font-weight: 700; color: #3b82f6; font-family: 'JetBrains Mono', monospace;">18,472</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); margin-top: 5px;">Real-time via Bitnodes API</div>
                </div>
                
                <div class="globe-stat-card" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.05) 100%); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                        <i class="fas fa-globe-americas" style="color: #22c55e; font-size: 1.2rem;"></i>
                        <span style="color: rgba(255,255,255,0.6); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;">Countries</span>
                    </div>
                    <div id="globe-country-count" style="font-size: 2.2rem; font-weight: 700; color: #22c55e; font-family: 'JetBrains Mono', monospace;">97</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); margin-top: 5px;">Global distribution</div>
                </div>
                
                <div class="globe-stat-card" style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.15) 0%, rgba(247, 147, 26, 0.05) 100%); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                        <i class="fas fa-shield-alt" style="color: #f7931a; font-size: 1.2rem;"></i>
                        <span style="color: rgba(255,255,255,0.6); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;">Network Health</span>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e; font-family: 'JetBrains Mono', monospace;">SOVEREIGN</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); margin-top: 5px;">No single point of failure</div>
                </div>
                
                <!-- Top regions live feed -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(59, 130, 246, 0.2);">
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Top Node Regions</div>
                    <div id="top-node-regions" style="font-size: 0.8rem;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <span style="color: rgba(255,255,255,0.7);"> Germany</span>
                            <span style="color: #3b82f6; font-family: 'JetBrains Mono', monospace;">2,847</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <span style="color: rgba(255,255,255,0.7);"> United States</span>
                            <span style="color: #3b82f6; font-family: 'JetBrains Mono', monospace;">2,412</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <span style="color: rgba(255,255,255,0.7);"> France</span>
                            <span style="color: #3b82f6; font-family: 'JetBrains Mono', monospace;">982</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span style="color: rgba(255,255,255,0.7);"> Netherlands</span>
                            <span style="color: #3b82f6; font-family: 'JetBrains Mono', monospace;">847</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom insights bar -->
        <div style="background: rgba(59, 130, 246, 0.1); border-top: 1px solid rgba(59, 130, 246, 0.3); padding: 15px 25px; display: flex; justify-content: center; align-items: center; gap: 30px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite;"></div>
                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Each dot represents a <span style="color: #f7931a;">full node</span> validating the entire blockchain</span>
            </div>
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">
                <i class="fas fa-mouse-pointer me-1"></i> Hover over nodes for details
            </div>
        </div>
        
        <!-- RUN YOUR OWN NODE - Grandmother-Friendly Guide -->
        <div class="run-node-guide">
            <div class="guide-header">
                <div class="guide-badge">BECOME A DOT ON THE GLOBE</div>
                <h3><i class="fas fa-server"></i> Run Your Own Bitcoin Node</h3>
                <p class="guide-intro">
                    You can add your own dot to this globe. Running a node means you personally verify every Bitcoin transactionno trust required. 
                    <strong>If your grandmother can plug in a router, she can run a node.</strong>
                </p>
            </div>
            
            <div class="guide-why-section">
                <h4><i class="fas fa-question-circle"></i> Why Run a Node?</h4>
                <div class="why-cards">
                    <div class="why-card">
                        <div class="why-icon"></div>
                        <div class="why-text">
                            <strong>Your Keys, Your Rules</strong>
                            <span>Verify your own balance. Never trust anyone else's computer.</span>
                        </div>
                    </div>
                    <div class="why-card">
                        <div class="why-icon"></div>
                        <div class="why-text">
                            <strong>Protect the Network</strong>
                            <span>Every node makes Bitcoin stronger. You become the resistance.</span>
                        </div>
                    </div>
                    <div class="why-card">
                        <div class="why-icon"></div>
                        <div class="why-text">
                            <strong>Learn by Doing</strong>
                            <span>Watch transactions flow in real-time. Understand Bitcoin deeply.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="guide-paths">
                <h4><i class="fas fa-road"></i> Choose Your Path</h4>
                
                <div class="path-options">
                    <!-- EASY PATH -->
                    <div class="path-card easy">
                        <div class="path-header">
                            <span class="path-badge easy">EASIEST</span>
                            <h5>Plug-and-Play Node</h5>
                            <p>Buy a pre-built device. Plug it in. Done.</p>
                        </div>
                        <div class="path-steps">
                            <div class="step">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <strong>Order a node device</strong>
                                    <span>Popular options: <a href="https://start9.com" target="_blank" rel="noopener">Start9</a>, <a href="https://umbrel.com" target="_blank" rel="noopener">Umbrel Home</a>, or <a href="https://mynodebtc.com" target="_blank" rel="noopener">myNode</a></span>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <strong>Plug it into your router</strong>
                                    <span>Just like connecting a printer. One ethernet cable.</span>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <strong>Open the app on your phone</strong>
                                    <span>The device comes with a simple app. Follow the setup wizard.</span>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <strong>Wait for sync (just once)</strong>
                                    <span>Your node downloads all Bitcoin history. Takes 1-3 days. Then you're done forever.</span>
                                </div>
                            </div>
                        </div>
                        <div class="path-footer">
                            <span class="cost"><i class="fas fa-tag"></i> ~$300-500</span>
                            <span class="time"><i class="fas fa-clock"></i> 15 min setup + sync time</span>
                        </div>
                    </div>
                    
                    <!-- DIY PATH -->
                    <div class="path-card diy">
                        <div class="path-header">
                            <span class="path-badge diy">DIY</span>
                            <h5>Raspberry Pi Node</h5>
                            <p>Build it yourself for less. Perfect weekend project.</p>
                        </div>
                        <div class="path-steps">
                            <div class="step">
                                <div class="step-num">1</div>
                                <div class="step-content">
                                    <strong>Get the hardware</strong>
                                    <span>Raspberry Pi 4 (4GB+), 1TB SSD, power supply, case. ~$150 total.</span>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-num">2</div>
                                <div class="step-content">
                                    <strong>Flash the software</strong>
                                    <span>Download <a href="https://umbrel.com" target="_blank" rel="noopener">Umbrel</a> or <a href="https://raspibolt.org" target="_blank" rel="noopener">RaspiBolt</a>. Use free "Balena Etcher" to put it on an SD card.</span>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-num">3</div>
                                <div class="step-content">
                                    <strong>Connect and power on</strong>
                                    <span>Plug the SSD into Pi, Pi into router, power on. Open browser to umbrel.local</span>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-num">4</div>
                                <div class="step-content">
                                    <strong>Let it sync</strong>
                                    <span>The blockchain downloads automatically. Check back in 2-4 days.</span>
                                </div>
                            </div>
                        </div>
                        <div class="path-footer">
                            <span class="cost"><i class="fas fa-tag"></i> ~$150-200</span>
                            <span class="time"><i class="fas fa-clock"></i> 1-2 hours + sync time</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="guide-tips">
                <h4><i class="fas fa-lightbulb"></i> Grandmother-Approved Tips</h4>
                <div class="tips-grid">
                    <div class="tip">
                        <i class="fas fa-wifi"></i>
                        <span><strong>Use ethernet, not WiFi.</strong> Plug your node directly into your router for best results.</span>
                    </div>
                    <div class="tip">
                        <i class="fas fa-plug"></i>
                        <span><strong>Leave it running 24/7.</strong> Your node works quietly in the background. Uses less power than a lightbulb.</span>
                    </div>
                    <div class="tip">
                        <i class="fas fa-sync"></i>
                        <span><strong>First sync takes days.</strong> This is normal! Your node is downloading 15+ years of Bitcoin history. After that, it stays current.</span>
                    </div>
                    <div class="tip">
                        <i class="fas fa-hdd"></i>
                        <span><strong>Get a 1TB+ drive.</strong> The blockchain is ~600GB and growing. Give yourself room.</span>
                    </div>
                </div>
            </div>
            
            <div class="guide-cta">
                <div class="cta-message">
                    <i class="fas fa-globe-americas"></i>
                    <span>When your node syncs, <strong>you become a dot on this globe.</strong> You're part of the network that no government, no corporation, no army can shut down.</span>
                </div>
                <div class="cta-buttons">
                    <a href="https://umbrel.com" target="_blank" rel="noopener" class="cta-btn primary">
                        <i class="fas fa-download"></i> Start with Umbrel (Free)
                    </a>
                    <a href="https://start9.com" target="_blank" rel="noopener" class="cta-btn secondary">
                        <i class="fas fa-box"></i> Buy Pre-Built Node
                    </a>
                </div>
            </div>
        </div>
        
    </div>
</div><!-- END panel-node-globe -->

<!-- LIGHTNING PULSE - Real-time Lightning Network Activity -->
<div class="instrument-panel" id="panel-lightning-pulse" style="grid-column: span 2;">
    <div class="lightning-pulse-showcase" style="background: linear-gradient(180deg, rgba(250, 204, 21, 0.1) 0%, rgba(234, 179, 8, 0.03) 100%); border: 2px solid rgba(250, 204, 21, 0.4); border-radius: 20px; padding: 0; overflow: hidden; position: relative; min-height: 350px;">
        
        <div class="module-header" style="padding: 20px 25px 15px; border-bottom: 1px solid rgba(250, 204, 21, 0.2);">
            <div class="module-icon" style="background: linear-gradient(135deg, rgba(250, 204, 21, 0.3) 0%, rgba(250, 204, 21, 0.1) 100%); border: 2px solid rgba(250, 204, 21, 0.5); color: #facc15; width: 45px; height: 45px; font-size: 1.2rem;">
                <i class="fas fa-bolt"></i>
            </div>
            <div>
                <h3 class="module-title" style="color: #facc15; font-size: 1.3rem; letter-spacing: 2px;">LIGHTNING PULSE</h3>
                <p class="module-subtitle" style="color: rgba(255,255,255,0.6); font-size: 0.8rem;">Real-time Zaps & Payments</p>
            </div>
        </div>
        
        <!-- Two-column layout for wider display -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
            
            <!-- Left: Network Stats -->
            <div style="border-right: 1px solid rgba(250, 204, 21, 0.2); padding: 20px 25px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px;">
                    <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 1.5s infinite;"></div>
                    <span style="font-size: 0.7rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 1px;">Network Stats</span>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #facc15; font-family: 'JetBrains Mono', monospace;">5,400+</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-top: 5px;">BTC Capacity</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e; font-family: 'JetBrains Mono', monospace;">75K+</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-top: 5px;">Channels</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6; font-family: 'JetBrains Mono', monospace;">16K+</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-top: 5px;">Nodes</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #a855f7; font-family: 'JetBrains Mono', monospace;">&lt;1s</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-top: 5px;">Avg Settlement</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(250, 204, 21, 0.08); border-radius: 12px; border: 1px solid rgba(250, 204, 21, 0.2);">
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7); line-height: 1.5;">
                        <i class="fas fa-bolt me-2" style="color: #facc15;"></i>
                        The Lightning Network enables instant Bitcoin payments with fees typically under 1 satoshi. Perfect for micropayments, tipping, and everyday transactions.
                    </div>
                </div>
            </div>
            
            <!-- Right: Live Zap Feed -->
            <div style="padding: 20px 25px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                    <div style="width: 8px; height: 8px; background: #facc15; border-radius: 50%; animation: pulse 1.5s infinite;"></div>
                    <span style="font-size: 0.7rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 1px;">Live Zap Feed</span>
                </div>
                
                <div id="lightning-zap-feed" style="max-height: 200px; overflow-y: auto;">
                    <!-- Zaps will be added here dynamically -->
                </div>
            </div>
        </div>
        
        <!-- Bottom bar -->
        <div style="background: rgba(250, 204, 21, 0.1); border-top: 1px solid rgba(250, 204, 21, 0.2); padding: 12px 20px; text-align: center;">
            <span style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">
                <i class="fas fa-info-circle me-1" style="color: #facc15;"></i>
                Instant, near-zero fee global payments powered by Layer 2
            </span>
        </div>
    </div>
</div><!-- END panel-lightning-pulse -->

<style>
.star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    animation: twinkle 3s ease-in-out infinite;
}
@keyframes twinkle {
    0%, 100% { opacity: 0.2; }
    50% { opacity: 1; }
}
</style>

        </div><!-- END dashboard-grid -->
    </div><!-- END container -->
</section><!-- END ZONE 2 -->

<!-- ============================================
     ZONE 3: THE SOVEREIGN ARCHIVE
     Collapsible Deep-Dive Modules
     ============================================ -->
<section class="zone-sovereign-archive">
    <div class="container">

<!-- SOVEREIGNTY CALCULATOR - HIDDEN (moved to Pulse Intel Grid) -->
<div class="archive-folder collapsed" id="folder-calculator" style="display: none;">
    <div class="archive-folder-header" onclick="toggleArchiveFolder(this.parentElement)">
        <div class="archive-folder-title">
            <i class="fas fa-calculator"></i>
            <span>Sovereignty Calculator</span>
            <span style="color: rgba(255,255,255,0.3); font-size: 0.65rem; margin-left: 10px;">DCA Strategy Tool</span>
        </div>
        <i class="fas fa-chevron-down archive-folder-toggle"></i>
    </div>
    <div class="archive-folder-content">
    <div class="sovereignty-calc-showcase" style="background: linear-gradient(180deg, rgba(0, 30, 20, 0.95) 0%, rgba(0, 15, 10, 0.98) 100%); border: 2px solid rgba(34, 197, 94, 0.4); border-radius: 20px; overflow: hidden;">
        <div class="module-header" style="padding: 25px 30px; border-bottom: 1px solid rgba(34, 197, 94, 0.2);">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 55px; height: 55px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(34, 197, 94, 0.1) 100%); border: 2px solid rgba(34, 197, 94, 0.5); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-calculator" style="font-size: 1.4rem; color: #22c55e;"></i>
                </div>
                <div>
                    <h3 style="font-size: 1.4rem; font-weight: 800; color: #22c55e; text-transform: uppercase; letter-spacing: 2px; margin: 0;">Sovereignty Calculator</h3>
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.85rem; margin: 5px 0 0;">What If You'd Stacked?</p>
                </div>
            </div>
        </div>
        
        <div style="padding: 25px 30px;">
            <!-- Input Controls -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 25px;">
                <div>
                    <label style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 8px;">Amount ($)</label>
                    <input type="number" id="calc-amount" value="50" min="1" style="width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 12px 15px; color: #22c55e; font-size: 1.2rem; font-family: 'JetBrains Mono', monospace;">
                </div>
                <div>
                    <label style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 8px;">Frequency</label>
                    <select id="calc-frequency" onchange="calculateDCA()" style="width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 12px 15px; color: #22c55e; font-size: 1rem;">
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 8px;">Start Date</label>
                    <input type="date" id="calc-start-date" value="2021-01-01" style="width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 12px 15px; color: #22c55e; font-size: 1rem;">
                </div>
            </div>
            
            <!-- Preset Buttons -->
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 30px;">
                <button onclick="setCalcPreset('inception', event)" style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.4) 0%, rgba(247, 147, 26, 0.15) 100%); border: 1px solid rgba(247, 147, 26, 0.6); color: #f7931a; padding: 10px 18px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: all 0.3s; font-weight: 600;">
                    <i class="fas fa-star me-1"></i> Since Inception
                </button>
                <button onclick="setCalcPreset('halving', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 10px 18px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: all 0.3s;">Since Last Halving</button>
                <button onclick="setCalcPreset('2020', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 10px 18px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: all 0.3s;">Since 2020</button>
                <button onclick="setCalcPreset('ath', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 10px 18px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: all 0.3s;">Since $69K Top</button>
                <button onclick="setCalcPreset('year', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 10px 18px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: all 0.3s;">Past Year</button>
            </div>
            
            <!-- Results Grid -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 0.65rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Total Invested</div>
                    <div id="calc-invested" style="font-size: 1.6rem; font-weight: 700; color: #f7931a; font-family: 'JetBrains Mono', monospace;">$10,400</div>
                </div>
                <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 0.65rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">BTC Accumulated</div>
                    <div id="calc-btc" style="font-size: 1.6rem; font-weight: 700; color: #f7931a; font-family: 'JetBrains Mono', monospace;">0.2847 BTC</div>
                </div>
                <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 0.65rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Current Value</div>
                    <div id="calc-value" style="font-size: 1.6rem; font-weight: 700; color: #22c55e; font-family: 'JetBrains Mono', monospace;">$28,470</div>
                </div>
                <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 0.65rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Total Gain</div>
                    <div id="calc-gain" style="font-size: 1.6rem; font-weight: 700; color: #22c55e; font-family: 'JetBrains Mono', monospace;">+173.8%</div>
                </div>
            </div>
            
            <!-- Chart Area -->
            <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(34, 197, 94, 0.15); border-radius: 12px; padding: 20px; height: 200px; position: relative;">
                <div style="position: absolute; top: 10px; left: 15px; font-size: 0.65rem; color: rgba(255,255,255,0.3); text-transform: uppercase; letter-spacing: 1px;">Portfolio Growth Over Time</div>
                <canvas id="stack-chart" style="width: 100%; height: 100%;"></canvas>
            </div>
            
            <!-- Insight -->
            <div style="margin-top: 20px; padding: 15px 20px; background: rgba(247, 147, 26, 0.08); border-left: 3px solid #f7931a; border-radius: 0 8px 8px 0;">
                <p style="margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.7); line-height: 1.6;">
                    <i class="fas fa-lightbulb me-2" style="color: #f7931a;"></i>
                    <strong style="color: #f7931a;">DCA Strategy:</strong> Dollar-cost averaging reduces timing risk by spreading purchases over time. This calculator uses historical Bitcoin prices to show what consistent stacking would have achieved.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- 3. USD VS BITCOIN PURCHASING POWER -->
<section class="container">
    <div class="purchasing-power-showcase" style="background: linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(10, 20, 40, 0.98) 100%); border: 2px solid rgba(59, 130, 246, 0.4); border-radius: 20px; overflow: hidden; position: relative;">
        <!-- Dollar bill pattern background -->
        <div style="position: absolute; inset: 0; opacity: 0.03; background-image: url('data:image/svg+xml,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 100 100&quot;><text x=&quot;10&quot; y=&quot;50&quot; font-size=&quot;40&quot; fill=&quot;white&quot;>$</text></svg>'); background-size: 80px 80px; pointer-events: none;"></div>
        
        <div class="module-header" style="padding: 25px 30px; border-bottom: 1px solid rgba(59, 130, 246, 0.2); position: relative; z-index: 1;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, rgba(220, 38, 38, 0.3) 0%, rgba(220, 38, 38, 0.1) 100%); border: 2px solid rgba(220, 38, 38, 0.5); border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-dollar-sign" style="font-size: 1.5rem; color: #dc2626;"></i>
                </div>
                <div>
                    <h3 style="font-size: 1.5rem; font-weight: 800; color: #fff; text-transform: uppercase; letter-spacing: 2px; margin: 0;">Purchasing Power Decay</h3>
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.85rem; margin: 5px 0 0;">USD vs Bitcoin vs Hard Assets</p>
                </div>
            </div>
            <div style="background: rgba(220, 38, 38, 0.15); border: 1px solid rgba(220, 38, 38, 0.3); padding: 8px 15px; border-radius: 8px;">
                <span style="font-size: 0.8rem; color: #dc2626;"><i class="fas fa-arrow-down me-1"></i>Since 1913: -97% USD</span>
            </div>
        </div>
        
        <!-- Main Chart Area -->
        <div style="padding: 30px; position: relative; z-index: 1;">
            <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px;">USD Relative Purchasing Power (1913 = $1.00)</div>
                    <div style="display: flex; gap: 15px; font-size: 0.7rem;">
                        <span style="display: flex; align-items: center; gap: 5px;"><div style="width: 12px; height: 3px; background: #dc2626; border-radius: 2px;"></div> USD</span>
                        <span style="display: flex; align-items: center; gap: 5px;"><div style="width: 12px; height: 3px; background: #f7931a; border-radius: 2px;"></div> Bitcoin (since 2009)</span>
                    </div>
                </div>
                <canvas id="purchasing-power-chart" style="width: 100%; height: 200px;"></canvas>
            </div>
            
            <!-- Asset Comparison Cards -->
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;">What $100 in 1971 Buys Today</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div style="background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(220, 38, 38, 0.05) 100%); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 12px; padding: 18px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #dc2626; font-family: 'JetBrains Mono', monospace;">$14</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 5px;">US Dollar</div>
                    <div style="font-size: 0.6rem; color: #dc2626; margin-top: 3px;">-86%</div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.15) 0%, rgba(247, 147, 26, 0.05) 100%); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 12px; padding: 18px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #f7931a; font-family: 'JetBrains Mono', monospace;" id="pp-btc-value">$12.8M</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 5px;">Bitcoin (if bought 2009)</div>
                    <div style="font-size: 0.6rem; color: #22c55e; margin-top: 3px;">+12,800,000%</div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.05) 100%); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 12px; padding: 18px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #ffd700; font-family: 'JetBrains Mono', monospace;">$6,200</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 5px;">Gold</div>
                    <div style="font-size: 0.6rem; color: #22c55e; margin-top: 3px;">+6,100%</div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(192, 192, 192, 0.15) 0%, rgba(192, 192, 192, 0.05) 100%); border: 1px solid rgba(192, 192, 192, 0.3); border-radius: 12px; padding: 18px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #c0c0c0; font-family: 'JetBrains Mono', monospace;">$1,850</div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 5px;">Silver</div>
                    <div style="font-size: 0.6rem; color: #22c55e; margin-top: 3px;">+1,750%</div>
                </div>
            </div>
            
            <!-- Real Estate Comparison -->
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;">Median US Home Price in USD vs Bitcoin</div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
                <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 0.8rem; color: #3b82f6; font-weight: 600; margin-bottom: 12px;">2016</div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 6px;">
                            <div style="font-size: 1.2rem; color: #22c55e; font-weight: 700;">$288,400</div>
                        </div>
                        <div style="background: rgba(247, 147, 26, 0.1); padding: 8px; border-radius: 6px;">
                            <div style="font-size: 1.2rem; color: #f7931a; font-weight: 700;">664 BTC</div>
                        </div>
                    </div>
                </div>
                <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 0.8rem; color: #3b82f6; font-weight: 600; margin-bottom: 12px;">2020</div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 6px;">
                            <div style="font-size: 1.2rem; color: #22c55e; font-weight: 700;">$328,900</div>
                        </div>
                        <div style="background: rgba(247, 147, 26, 0.1); padding: 8px; border-radius: 6px;">
                            <div style="font-size: 1.2rem; color: #f7931a; font-weight: 700;">45 BTC</div>
                        </div>
                    </div>
                </div>
                <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 20px; text-align: center;">
                    <div style="font-size: 0.8rem; color: #3b82f6; font-weight: 600; margin-bottom: 12px;">2026</div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 6px;">
                            <div style="font-size: 1.2rem; color: #22c55e; font-weight: 700;" id="pp-home-usd">$434,700</div>
                        </div>
                        <div style="background: rgba(247, 147, 26, 0.1); padding: 8px; border-radius: 6px;">
                            <div style="font-size: 1.2rem; color: #f7931a; font-weight: 700;" id="pp-home-btc">4.2 BTC</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Asset Class Race -->
            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;">10-Year Asset Performance Race</div>
            <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(59, 130, 246, 0.15); border-radius: 12px; padding: 20px;">
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 0.8rem; color: #f7931a;"> Bitcoin</span>
                        <span style="font-size: 0.8rem; color: #22c55e; font-family: 'JetBrains Mono', monospace;">+28,500%</span>
                    </div>
                    <div style="height: 10px; background: rgba(247, 147, 26, 0.15); border-radius: 5px; overflow: hidden;">
                        <div style="height: 100%; width: 100%; background: linear-gradient(90deg, #f7931a, #ff6600); border-radius: 5px; animation: raceBar 2s ease-out;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 0.8rem; color: #8b5cf6;"> S&P 500</span>
                        <span style="font-size: 0.8rem; color: #22c55e; font-family: 'JetBrains Mono', monospace;">+187%</span>
                    </div>
                    <div style="height: 10px; background: rgba(139, 92, 246, 0.15); border-radius: 5px; overflow: hidden;">
                        <div style="height: 100%; width: 3%; background: #8b5cf6; border-radius: 5px;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 0.8rem; color: #ffd700;"> Gold</span>
                        <span style="font-size: 0.8rem; color: #22c55e; font-family: 'JetBrains Mono', monospace;">+85%</span>
                    </div>
                    <div style="height: 10px; background: rgba(255, 215, 0, 0.15); border-radius: 5px; overflow: hidden;">
                        <div style="height: 100%; width: 1.5%; background: #ffd700; border-radius: 5px;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 0.8rem; color: #c0c0c0;"> Silver</span>
                        <span style="font-size: 0.8rem; color: #22c55e; font-family: 'JetBrains Mono', monospace;">+120%</span>
                    </div>
                    <div style="height: 10px; background: rgba(192, 192, 192, 0.15); border-radius: 5px; overflow: hidden;">
                        <div style="height: 100%; width: 2%; background: #c0c0c0; border-radius: 5px;"></div>
                    </div>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 0.8rem; color: #3b82f6;"> Real Estate</span>
                        <span style="font-size: 0.8rem; color: #22c55e; font-family: 'JetBrains Mono', monospace;">+65%</span>
                    </div>
                    <div style="height: 10px; background: rgba(59, 130, 246, 0.15); border-radius: 5px; overflow: hidden;">
                        <div style="height: 100%; width: 1.2%; background: #3b82f6; border-radius: 5px;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom insight -->
        <div style="padding: 20px 30px; background: rgba(220, 38, 38, 0.08); border-top: 1px solid rgba(220, 38, 38, 0.2);">
            <p style="margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.7); line-height: 1.6; text-align: center;">
                <i class="fas fa-quote-left me-2" style="color: rgba(220, 38, 38, 0.5);"></i>
                "The root problem with conventional currency is all the trust that's required to make it work."  <span style="color: #f7931a;">Satoshi Nakamoto</span>
                <i class="fas fa-quote-right ms-2" style="color: rgba(220, 38, 38, 0.5);"></i>
            </p>
        </div>
    </div>
</section>

<style>
@keyframes raceBar {
    from { width: 0; }
}
</style>

<!-- KNOTS vs CORE - The Consensus Debate -->
<section class="container" style="margin-bottom: 40px;">
<div class="instrument-panel" id="panel-knots-core" style="width: 100%;">
    <div class="node-globe-showcase" style="background: linear-gradient(180deg, rgba(30, 10, 40, 0.95) 0%, rgba(15, 5, 25, 0.98) 100%); border: 2px solid rgba(168, 85, 247, 0.4); border-radius: 20px; padding: 0; overflow: hidden; position: relative;">
        
        <div class="module-header" style="padding: 25px 30px 15px; border-bottom: 1px solid rgba(168, 85, 247, 0.2);">
            <div class="module-icon" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.3) 0%, rgba(168, 85, 247, 0.1) 100%); border: 2px solid rgba(168, 85, 247, 0.5); color: #a855f7; width: 50px; height: 50px; font-size: 1.3rem;">
                <i class="fas fa-code-branch"></i>
            </div>
            <div>
                <h3 class="module-title" style="color: #a855f7; font-size: 1.5rem; letter-spacing: 2px;">KNOTS vs CORE</h3>
                <p class="module-subtitle" style="color: rgba(255,255,255,0.6);">The Battle for Bitcoin's Soul</p>
            </div>
        </div>
        
        <div style="padding: 25px 30px;">
            <!-- Main Debate Summary -->
            <div style="background: rgba(168, 85, 247, 0.08); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <p style="color: rgba(255,255,255,0.9); font-size: 0.95rem; line-height: 1.7; margin: 0;">
                    A philosophical battle is raging in Bitcoin: Should the network be an <strong style="color: #a855f7;">uncensorable medium of information exchange</strong>, or should it remain purely <strong style="color: #f7931a;">Bitcoin as money</strong>? This debate centers on spam filtering, OP_RETURN limits, and the future direction of Bitcoin development.
                </p>
            </div>
            
            <!-- Two Camps Comparison -->
            <div class="knots-core-comparison" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <!-- Bitcoin Core Side -->
                <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.05) 100%); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <i class="fab fa-bitcoin" style="color: #3b82f6; font-size: 1.2rem; background: transparent !important; border: none !important; box-shadow: none !important;"></i>
                        </div>
                        <h4 style="color: #3b82f6; margin: 0; font-size: 1.1rem; letter-spacing: 1px;">BITCOIN CORE</h4>
                    </div>
                    <ul style="color: rgba(255,255,255,0.8); font-size: 0.85rem; line-height: 1.8; padding-left: 18px; margin: 0;">
                        <li>Default reference implementation</li>
                        <li>Policy changes under active debate</li>
                        <li>No transaction filtering by default</li>
                        <li>"If you paid the fee, it's valid"</li>
                        <li>Allows ordinals & inscriptions</li>
                    </ul>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(59, 130, 246, 0.2);">
                        <span style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px;">Philosophy</span>
                        <p style="color: #3b82f6; font-size: 0.9rem; margin: 5px 0 0; font-style: italic;">"Uncensorable data layer"</p>
                    </div>
                </div>
                
                <!-- Bitcoin Knots Side -->
                <div style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.15) 0%, rgba(247, 147, 26, 0.05) 100%); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <div style="width: 40px; height: 40px; background: rgba(247, 147, 26, 0.2); border: 1px solid rgba(247, 147, 26, 0.4); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-fist-raised" style="color: #f7931a; font-size: 1.2rem;"></i>
                        </div>
                        <h4 style="color: #f7931a; margin: 0; font-size: 1.1rem; letter-spacing: 1px;">BITCOIN KNOTS</h4>
                    </div>
                    <ul style="color: rgba(255,255,255,0.8); font-size: 0.85rem; line-height: 1.8; padding-left: 18px; margin: 0;">
                        <li>Fork maintained by Luke Dashjr</li>
                        <li>Filters non-financial transactions</li>
                        <li>Rejects inscriptions & ordinals</li>
                        <li>Backed by Ocean Mining</li>
                        <li>Policy-level spam filtering</li>
                    </ul>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(247, 147, 26, 0.2);">
                        <span style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px;">Philosophy</span>
                        <p style="color: #f7931a; font-size: 0.9rem; margin: 5px 0 0; font-style: italic;">"Bitcoin is money. Period."</p>
                    </div>
                </div>
            </div>
            
            <!-- Key Issues -->
            <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: rgba(255,255,255,0.9); font-size: 0.9rem; margin: 0 0 15px; text-transform: uppercase; letter-spacing: 2px;">
                    <i class="fas fa-exclamation-triangle me-2" style="color: #eab308;"></i>Key Policy Debates
                </h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="padding: 15px; background: rgba(234, 179, 8, 0.1); border-radius: 8px; border-left: 3px solid #eab308;">
                        <div style="font-size: 0.75rem; color: #eab308; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">OP_RETURN Policy</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">Proposed changes to relay/storage limits under discussion</div>
                    </div>
                    <div style="padding: 15px; background: rgba(234, 179, 8, 0.1); border-radius: 8px; border-left: 3px solid #eab308;">
                        <div style="font-size: 0.75rem; color: #eab308; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Relay Policy</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">Knots filters inscriptions at relay layer</div>
                    </div>
                    <div style="padding: 15px; background: rgba(234, 179, 8, 0.1); border-radius: 8px; border-left: 3px solid #eab308;">
                        <div style="font-size: 0.75rem; color: #eab308; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Ordinals/Inscriptions</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">Stored in witness data (SegWit)</div>
                    </div>
                </div>
            </div>
            
            <!-- Key Players and What It Means -->
            <div class="knots-core-bottom-grid" style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 250px; background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #a855f7; font-size: 0.85rem; margin: 0 0 15px; text-transform: uppercase; letter-spacing: 1px;">
                        <i class="fas fa-users me-2"></i>Key Players
                    </h4>
                    <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8); line-height: 1.8;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <span><span style="color: #f7931a;"></span> Luke Dashjr</span>
                            <span style="color: #f7931a;">Knots maintainer</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <span><span style="color: #f7931a;"></span> Ocean Mining</span>
                            <span style="color: #f7931a;">Knots-based filtering</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <span><span style="color: #3b82f6;"></span> Bitcoin Core</span>
                            <span style="color: #3b82f6;">Reference client</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span><span style="color: #a855f7;"></span> Node Operators</span>
                            <span style="color: #a855f7;">Choose their policy</span>
                        </div>
                    </div>
                </div>
                
                <div style="flex: 1; min-width: 250px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #22c55e; font-size: 0.85rem; margin: 0 0 15px; text-transform: uppercase; letter-spacing: 1px;">
                        <i class="fas fa-balance-scale me-2"></i>What This Means For You
                    </h4>
                    <ul style="color: rgba(255,255,255,0.8); font-size: 0.85rem; line-height: 1.8; padding-left: 18px; margin: 0;">
                        <li>Sats may have ordinals inscribed on them</li>
                        <li>Knots filters inscriptions at relay layer</li>
                        <li>Both clients validate the same blockchain</li>
                        <li>No chain split  this is a policy debate</li>
                        <li>Your node, your rules</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Bottom insight bar -->
        <div style="background: rgba(168, 85, 247, 0.1); border-top: 1px solid rgba(168, 85, 247, 0.3); padding: 15px 25px; display: flex; justify-content: center; align-items: center; gap: 30px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-info-circle" style="color: #a855f7;"></i>
                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">This is a <span style="color: #a855f7;">policy debate</span>, not a consensus change  no chain split unless hard fork occurs</span>
            </div>
        </div>
    </div>
</div>
</section><!-- END panel-knots-core -->

<!-- INTEL MODULES - 4-Way Expandable Grid -->
<section class="container" style="margin-bottom: 40px;">
    <div class="intel-grid-container" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
        
        <!-- Energy Proof -->
        <div class="intel-card glass-module energy-proof-module" id="intel-energy" onclick="toggleIntelCard(this, event)">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.1)); border-color: rgba(34, 197, 94, 0.5); color: #22c55e;">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title">Energy Proof</h4>
                    <p class="intel-card-subtitle">The Green Ledger</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="energy-renewable-mini">54.5%</span> Sustainable</div>
                <div class="intel-stat"><span id="energy-megawatts-mini">~18.2 GW</span> Power</div>
            </div>
            <div class="intel-card-content">
                <div class="energy-grid">
                    <div class="energy-stat">
                        <div class="energy-stat-icon"></div>
                        <div class="energy-stat-value" id="energy-renewable">54.5%</div>
                        <div class="energy-stat-label">Sustainable Mix</div>
                    </div>
                    <div class="energy-stat">
                        <div class="energy-stat-icon"></div>
                        <div class="energy-stat-value" id="energy-megawatts">~18.2 GW</div>
                        <div class="energy-stat-label">Est. Power Draw</div>
                    </div>
                    <div class="energy-stat">
                        <div class="energy-stat-icon"></div>
                        <div class="energy-stat-value" id="energy-hydro">23%</div>
                        <div class="energy-stat-label">Hydro Power</div>
                    </div>
                </div>
                <div class="carbon-displacement">
                    <div class="carbon-counter">
                        <div class="carbon-value" id="carbon-avoided">847,293</div>
                        <div class="carbon-unit">Metric Tons CO2e</div>
                        <div class="carbon-label">Carbon Displaced (Est. YTD)</div>
                    </div>
                    <div style="flex: 1;"><canvas id="carbon-mini-chart" height="60"></canvas></div>
                </div>
                <div class="macro-flash">
                    <div class="macro-flash-header"><i class="fas fa-broadcast-tower me-2"></i>Macro Flash</div>
                    <div class="macro-flash-text" id="energy-macro-flash">Bitcoin mining monetizes stranded energy globally, converting wasted methane and excess renewables into the world's most secure monetary network.</div>
                </div>
            </div>
        </div>
        
        <!-- Whale Radar -->
        <div class="intel-card glass-module whale-radar-module" id="intel-whale" onclick="toggleIntelCard(this, event)">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(59, 130, 246, 0.1)); border-color: rgba(59, 130, 246, 0.5); color: #3b82f6;">
                    <i class="fas fa-water"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title">Whale Radar</h4>
                    <p class="intel-card-subtitle">Liquidity Analysis</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="exchange-flow-mini">+2,847 BTC</span> Net Flow</div>
                <div class="intel-stat" style="color: #22c55e;">Bullish Signal</div>
            </div>
            <div class="intel-card-content">
                <div class="exchange-drain">
                    <div class="drain-chart">
                        <div class="drain-title">24h Exchange Flow</div>
                        <div class="drain-value" id="exchange-net-flow">+2,847 BTC</div>
                        <div class="drain-label">Net Outflow (Bullish Signal)</div>
                        <div class="drain-bar-container" id="exchange-bars">
                            <div class="drain-bar" style="height: 80%;" title="Binance"></div>
                            <div class="drain-bar" style="height: 60%;" title="Coinbase"></div>
                            <div class="drain-bar outflow" style="height: 30%;" title="Kraken"></div>
                            <div class="drain-bar" style="height: 45%;" title="OKX"></div>
                            <div class="drain-bar" style="height: 70%;" title="Bitfinex"></div>
                        </div>
                    </div>
                    <div class="whale-alerts">
                        <div class="drain-title">Recent Large Movements</div>
                        <div class="whale-alert-item">
                            <div class="whale-alert-icon"></div>
                            <div class="whale-alert-info">
                                <div class="whale-alert-amount">500 BTC</div>
                                <div class="whale-alert-type">Exchange  Cold Storage</div>
                            </div>
                            <div class="whale-alert-time">12m ago</div>
                        </div>
                        <div class="whale-alert-item">
                            <div class="whale-alert-icon"></div>
                            <div class="whale-alert-info">
                                <div class="whale-alert-amount">250 BTC</div>
                                <div class="whale-alert-type">Unknown  Coinbase</div>
                            </div>
                            <div class="whale-alert-time">34m ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Protocol Roadmap -->
        <div class="intel-card glass-module protocol-roadmap-module" id="intel-protocol" onclick="toggleIntelCard(this, event)">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.3), rgba(168, 85, 247, 0.1)); border-color: rgba(168, 85, 247, 0.5); color: #a855f7;">
                    <i class="fas fa-code-branch"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title">Protocol Roadmap</h4>
                    <p class="intel-card-subtitle">The Sovereign Signal</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="diff-blocks-mini">1,247</span> Blocks to Adjust</div>
                <div class="intel-stat"><span id="halving-days-mini">845</span> Days to Halving</div>
            </div>
            <div class="intel-card-content">
                <div class="countdown-grid">
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdown-diff-blocks">1,247</div>
                        <div class="countdown-unit">Blocks</div>
                        <div class="countdown-label">Next Difficulty Adjustment</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdown-halving-days">845</div>
                        <div class="countdown-unit">Days</div>
                        <div class="countdown-label">Next Halving Event</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdown-epoch">5</div>
                        <div class="countdown-unit">Epoch</div>
                        <div class="countdown-label">Current Subsidy Era</div>
                    </div>
                </div>
                <div class="commit-feed">
                    <div class="commit-feed-header">Bitcoin Core Development Feed</div>
                    <div class="commit-item">
                        <div class="commit-hash">bitcoin/bitcoin@a7f3c2d</div>
                        <div class="commit-message">refactor: Simplify UTXO set hash calculation</div>
                        <div class="commit-translation">"Making the ledger verification faster and cleaner."</div>
                        <div class="commit-meta">2 hours ago by sipa</div>
                    </div>
                    <div class="commit-item">
                        <div class="commit-hash">bitcoin/bitcoin@e8b1f4a</div>
                        <div class="commit-message">test: Add fuzzing for BIP324 v2 transport</div>
                        <div class="commit-translation">"Stress-testing encrypted peer communication."</div>
                        <div class="commit-meta">5 hours ago by dhruv</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mining Intel -->
        <div class="intel-card glass-module mining-intel-module" id="intel-mining" onclick="toggleIntelCard(this, event)">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.3), rgba(247, 147, 26, 0.1)); border-color: rgba(247, 147, 26, 0.5); color: #f7931a;">
                    <i class="fas fa-hammer"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title">Mining Intel</h4>
                    <p class="intel-card-subtitle">Network Security & Economics</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="hashrate-mini">--</span> EH/s</div>
                <div class="intel-stat"><span id="diff-mini">--</span> Difficulty</div>
            </div>
            <div class="intel-card-content">
                <!-- Primary Metrics Row -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
                    <div style="background: rgba(247, 147, 26, 0.12); border: 1px solid rgba(247, 147, 26, 0.35); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Network Hashrate</div>
                        <div id="mining-hashrate" style="font-size: 1.4rem; font-weight: 700; color: #f7931a; font-family: 'JetBrains Mono', monospace;">-- EH/s</div>
                        <div id="mining-hashrate-change" style="font-size: 0.7rem; color: #22c55e; margin-top: 4px;">-- 24h</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.12); border: 1px solid rgba(59, 130, 246, 0.35); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Difficulty</div>
                        <div id="mining-difficulty" style="font-size: 1.4rem; font-weight: 700; color: #3b82f6; font-family: 'JetBrains Mono', monospace;">-- T</div>
                        <div id="mining-diff-change" style="font-size: 0.7rem; color: #22c55e; margin-top: 4px;">-- last adj</div>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.12); border: 1px solid rgba(34, 197, 94, 0.35); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Block Reward</div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #22c55e; font-family: 'JetBrains Mono', monospace;">3.125 BTC</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); margin-top: 4px;">+ fees</div>
                    </div>
                    <div style="background: rgba(168, 85, 247, 0.12); border: 1px solid rgba(168, 85, 247, 0.35); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Blocks Today</div>
                        <div id="mining-blocks-today" style="font-size: 1.4rem; font-weight: 700; color: #a855f7; font-family: 'JetBrains Mono', monospace;">--</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); margin-top: 4px;">~144 target</div>
                    </div>
                </div>
                
                <!-- Economics Section -->
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-chart-line" style="color: #f7931a;"></i> Mining Economics
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 14px;">
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); text-transform: uppercase; margin-bottom: 6px;">Hash Price</div>
                            <div id="mining-hash-price" style="font-size: 1.1rem; font-weight: 600; color: #facc15; font-family: 'JetBrains Mono', monospace;">$--/PH/day</div>
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.3); margin-top: 4px;">Revenue per PH/s</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 14px;">
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); text-transform: uppercase; margin-bottom: 6px;">Cost to Mine 1 BTC</div>
                            <div id="mining-cost-btc" style="font-size: 1.1rem; font-weight: 600; color: #dc2626; font-family: 'JetBrains Mono', monospace;">$--</div>
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.3); margin-top: 4px;">@ $0.05/kWh avg</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 14px;">
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); text-transform: uppercase; margin-bottom: 6px;">Breakeven Power</div>
                            <div id="mining-breakeven" style="font-size: 1.1rem; font-weight: 600; color: #22c55e; font-family: 'JetBrains Mono', monospace;">$--/kWh</div>
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.3); margin-top: 4px;">Max profitable rate</div>
                        </div>
                    </div>
                </div>
                
                <!-- Energy & Security Section -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <!-- Energy Metrics -->
                    <div style="background: rgba(234, 179, 8, 0.08); border: 1px solid rgba(234, 179, 8, 0.25); border-radius: 12px; padding: 16px;">
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-bolt" style="color: #eab308;"></i> Energy Profile
                        </div>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Est. Power Draw</span>
                                <span id="mining-power-draw" style="font-size: 0.85rem; font-weight: 600; color: #eab308; font-family: 'JetBrains Mono', monospace;">-- GW</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Avg Efficiency</span>
                                <span style="font-size: 0.85rem; font-weight: 600; color: #22c55e; font-family: 'JetBrains Mono', monospace;">~25 J/TH</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Annual Energy</span>
                                <span id="mining-annual-energy" style="font-size: 0.85rem; font-weight: 600; color: #f7931a; font-family: 'JetBrains Mono', monospace;">-- TWh</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0;">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Renewable Est.</span>
                                <span style="font-size: 0.85rem; font-weight: 600; color: #22c55e; font-family: 'JetBrains Mono', monospace;">~56%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Metrics -->
                    <div style="background: rgba(139, 92, 246, 0.08); border: 1px solid rgba(139, 92, 246, 0.25); border-radius: 12px; padding: 16px;">
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-shield-alt" style="color: #8b5cf6;"></i> Network Security
                        </div>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Security Budget</span>
                                <span id="mining-security-budget" style="font-size: 0.85rem; font-weight: 600; color: #8b5cf6; font-family: 'JetBrains Mono', monospace;">$--M/day</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">51% Attack Cost</span>
                                <span id="mining-attack-cost" style="font-size: 0.85rem; font-weight: 600; color: #dc2626; font-family: 'JetBrains Mono', monospace;">$--B</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Avg Block Time</span>
                                <span id="mining-block-time" style="font-size: 0.85rem; font-weight: 600; color: #3b82f6; font-family: 'JetBrains Mono', monospace;">-- min</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0;">
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Confirmations/hr</span>
                                <span id="mining-confirms-hr" style="font-size: 0.85rem; font-weight: 600; color: #22c55e; font-family: 'JetBrains Mono', monospace;">~6</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mining Pool Distribution - Donut Chart -->
                <div style="margin-bottom: 20px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; padding: 20px;">
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-chart-pie" style="color: #3b82f6;"></i> Mining Pool Distribution (24h Blocks)
                    </div>
                    <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap;">
                        <!-- Donut Chart -->
                        <div style="position: relative; width: 160px; height: 160px; flex-shrink: 0;">
                            <svg id="mining-pool-donut" viewBox="0 0 100 100" style="width: 100%; height: 100%; transform: rotate(-90deg);">
                                <!-- Donut segments will be populated by JS -->
                                <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="18"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                <div id="mining-pool-total-blocks" style="font-size: 1.3rem; font-weight: 700; color: #fff; font-family: 'JetBrains Mono', monospace;">--</div>
                                <div style="font-size: 0.6rem; color: rgba(255,255,255,0.5); text-transform: uppercase;">Blocks</div>
                            </div>
                        </div>
                        <!-- Legend -->
                        <div id="mining-pool-legend" style="flex: 1; display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px 20px; min-width: 200px;">
                            <!-- Legend items will be populated by JS -->
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 12px; height: 12px; border-radius: 3px; background: rgba(255,255,255,0.1);"></div>
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.4);">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <!-- Decentralization Health Indicator -->
                    <div id="mining-decentralization" style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.25); border-radius: 8px;">
                        <div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
                            <i class="fas fa-info-circle" style="color: #3b82f6; margin-top: 2px;"></i>
                            <span style="font-size: 0.75rem; color: rgba(255,255,255,0.7); line-height: 1.5;">
                                <strong style="color: #3b82f6;">Room for Improvement:</strong> Distribution could be healthier. While no pool currently threatens the 40% threshold (when concern begins), the network benefits from more miners joining the fight.
                            </span>
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px;">
                            <a href="/solo-slayers" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(247, 147, 26, 0.15); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 6px; font-size: 0.7rem; color: #f7931a; text-decoration: none; transition: all 0.2s;">
                                <i class="fas fa-hammer"></i> Solo Slayer Route
                            </a>
                            <a href="/mining-risk" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 6px; font-size: 0.7rem; color: #22c55e; text-decoration: none; transition: all 0.2s;">
                                <i class="fas fa-globe-americas"></i> Mining Risk by Geography
                            </a>
                            <a href="https://curatedmining.io" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(168, 85, 247, 0.15); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 6px; font-size: 0.7rem; color: #a855f7; text-decoration: none; transition: all 0.2s;">
                                <i class="fas fa-microchip"></i> Curated Mining Gear
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Halving Countdown -->
                <div style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.15) 0%, rgba(247, 147, 26, 0.05) 100%); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Next Halving</div>
                            <div id="mining-halving-blocks" style="font-size: 1.2rem; font-weight: 700; color: #f7931a; font-family: 'JetBrains Mono', monospace;">-- blocks</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Est. Date</div>
                            <div id="mining-halving-date" style="font-size: 1rem; font-weight: 600; color: #facc15;">~2028</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">New Reward</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #22c55e;">1.5625 BTC</div>
                        </div>
                    </div>
                </div>
                
                <!-- Info Footer -->
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); padding: 12px 15px; background: rgba(0,0,0,0.3); border-radius: 10px; line-height: 1.5;">
                    <i class="fas fa-info-circle me-2" style="color: #f7931a;"></i>
                    Mining secures the Bitcoin network through proof-of-work. Difficulty adjusts every 2,016 blocks (~2 weeks) to maintain 10-minute block times. Data from mempool.space.
                </div>
            </div>
        </div>
        
    </div>
</section>

<style>
/* Intel Card Grid Styles */
.intel-grid-container {
    max-width: 100%;
}

.intel-card {
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.intel-card:hover {
    border-color: rgba(255,255,255,0.2);
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
}

.intel-card.expanded {
    grid-column: span 2;
    cursor: default;
}

.intel-card-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.intel-card-icon {
    width: 45px;
    height: 45px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    border: 1px solid;
    flex-shrink: 0;
}

.intel-card-info {
    flex: 1;
}

.intel-card-title {
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    margin: 0;
    letter-spacing: 0.5px;
}

.intel-card-subtitle {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
    margin: 3px 0 0;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.intel-card-expand {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255,255,255,0.4);
    transition: all 0.3s ease;
}

.intel-card:hover .intel-card-expand {
    background: rgba(255,255,255,0.1);
    color: rgba(255,255,255,0.7);
}

.intel-card.expanded .intel-card-expand i {
    transform: rotate(45deg);
}

.intel-card-preview {
    display: flex;
    gap: 20px;
    padding: 12px 15px;
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
    margin-bottom: 0;
}

.intel-card.expanded .intel-card-preview {
    display: none;
}

.intel-stat {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.6);
    font-family: 'JetBrains Mono', monospace;
}

.intel-stat span {
    color: #f7931a;
    font-weight: 600;
}

.intel-card-content {
    display: none;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
    animation: fadeIn 0.3s ease;
}

.intel-card.expanded .intel-card-content {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
    .intel-grid-container {
        grid-template-columns: 1fr !important;
    }
    .intel-card.expanded {
        grid-column: span 1;
    }
    /* Mining Intel mobile responsive grids */
    #intel-mining .intel-card-content > div:first-child {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    #intel-mining .intel-card-content > div:nth-child(2) > div:last-child {
        grid-template-columns: 1fr !important;
    }
    #intel-mining .intel-card-content > div:nth-child(3) {
        grid-template-columns: 1fr !important;
    }
}
</style>

<script>
function toggleIntelCard(card, event) {
    // Prevent toggling if clicking inside content area
    if (event && event.target.closest('.intel-card-content')) {
        return;
    }
    
    const wasExpanded = card.classList.contains('expanded');
    
    // Toggle this card individually (allow multiple expanded)
    card.classList.toggle('expanded');
    
    // Scroll into view if expanding
    if (!wasExpanded && card.classList.contains('expanded')) {
        setTimeout(() => {
            card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
    }
}
</script>

<!-- PULSE INTEL GRID - 4-Way Expandable -->
<section class="container" style="margin-bottom: 40px;">
    <div class="intel-grid-container" id="pulse-intel-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
        
        <!-- 1. State of the Pulse -->
        <div class="intel-card glass-module" id="intel-pulse-state" onclick="toggleIntelCard(this, event)" style="border-color: rgba(139, 92, 246, 0.3);">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(139, 92, 246, 0.1)); border-color: rgba(139, 92, 246, 0.5); color: #8b5cf6;">
                    <i class="fas fa-satellite-dish"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title" style="color: #8b5cf6;">State of the Pulse</h4>
                    <p class="intel-card-subtitle">Network Intelligence Brief</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="pulse-health-mini" style="color: #22c55e;">98.7%</span> Health</div>
                <div class="intel-stat"><span id="pulse-tps-mini" style="color: #3b82f6;">6.2</span> TPS</div>
            </div>
            <div class="intel-card-content">
                <!-- Full State of Pulse content -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: #22c55e;" id="pulse-health">98.7%</div>
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">HEALTH SCORE</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: #3b82f6;" id="pulse-tps">6.2</div>
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">TXS/SEC</div>
                    </div>
                    <div style="background: rgba(247, 147, 26, 0.1); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: #f7931a;" id="pulse-price">$--</div>
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">BTC PRICE</div>
                    </div>
                    <div style="background: rgba(20, 184, 166, 0.1); border: 1px solid rgba(20, 184, 166, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: #14b8a6;" id="pulse-fee">8</div>
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">SAT/VB FEE</div>
                    </div>
                </div>
                <div style="background: rgba(139, 92, 246, 0.08); border-left: 3px solid #8b5cf6; padding: 15px; border-radius: 0 8px 8px 0;">
                    <p id="verdict-summary" style="color: rgba(255,255,255,0.85); font-size: 0.85rem; line-height: 1.6; margin: 0;">
                        Network operating at <span style="color: #22c55e; font-weight: 600;">peak efficiency</span> with low fees and rising hashrate.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- 2. Mempool Heatmap -->
        <div class="intel-card glass-module" id="intel-mempool" onclick="toggleIntelCard(this, event)" style="border-color: rgba(20, 184, 166, 0.3);">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(20, 184, 166, 0.3), rgba(20, 184, 166, 0.1)); border-color: rgba(20, 184, 166, 0.5); color: #14b8a6;">
                    <i class="fas fa-fire-alt"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title" style="color: #14b8a6;">Mempool Heatmap</h4>
                    <p class="intel-card-subtitle">Fee Urgency Visualization</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="heatmap-total-mini">--</span> Pending</div>
                <div class="intel-stat"><span id="heatmap-median-mini">--</span> Median</div>
            </div>
            <div class="intel-card-content">
                <div class="mempool-heatmap-container" style="padding: 0;">
                    <div class="heatmap-header" style="margin-bottom: 15px;">
                        <div class="heatmap-stats" style="display: flex; gap: 20px;">
                            <div class="heatmap-stat">
                                <div class="heatmap-stat-value" id="heatmap-total-txs">--</div>
                                <div class="heatmap-stat-label">Pending TXs</div>
                            </div>
                            <div class="heatmap-stat">
                                <div class="heatmap-stat-value" id="heatmap-median-fee">--</div>
                                <div class="heatmap-stat-label">Median Fee</div>
                            </div>
                        </div>
                    </div>
                    <div class="heatmap-visual" id="mempool-heatmap-grid" style="height: 120px;">
                        <div class="heatmap-blocks" style="display: flex; align-items: flex-end; justify-content: space-between; height: 100%; gap: 8px;">
                            <div class="heatmap-band" data-fee="1-5" style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <span class="heatmap-bar-value" id="grid-fee-1-5" style="font-size: 0.65rem; color: rgba(255,255,255,0.6);">--</span>
                                <div style="width: 100%; height: 80%; background: linear-gradient(to top, #14b8a6, rgba(20, 184, 166, 0.3)); border-radius: 4px;"></div>
                                <span style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-top: 4px;">1-5</span>
                            </div>
                            <div class="heatmap-band" data-fee="5-10" style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <span class="heatmap-bar-value" id="grid-fee-5-10" style="font-size: 0.65rem; color: rgba(255,255,255,0.6);">--</span>
                                <div style="width: 100%; height: 60%; background: linear-gradient(to top, #22c55e, rgba(34, 197, 94, 0.3)); border-radius: 4px;"></div>
                                <span style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-top: 4px;">5-10</span>
                            </div>
                            <div class="heatmap-band" data-fee="10-20" style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <span class="heatmap-bar-value" id="grid-fee-10-20" style="font-size: 0.65rem; color: rgba(255,255,255,0.6);">--</span>
                                <div style="width: 100%; height: 40%; background: linear-gradient(to top, #facc15, rgba(250, 204, 21, 0.3)); border-radius: 4px;"></div>
                                <span style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-top: 4px;">10-20</span>
                            </div>
                            <div class="heatmap-band" data-fee="20-50" style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <span class="heatmap-bar-value" id="grid-fee-20-50" style="font-size: 0.65rem; color: rgba(255,255,255,0.6);">--</span>
                                <div style="width: 100%; height: 25%; background: linear-gradient(to top, #f97316, rgba(249, 115, 22, 0.3)); border-radius: 4px;"></div>
                                <span style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-top: 4px;">20-50</span>
                            </div>
                            <div class="heatmap-band" data-fee="50+" style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <span class="heatmap-bar-value" id="grid-fee-50" style="font-size: 0.65rem; color: rgba(255,255,255,0.6);">--</span>
                                <div style="width: 100%; height: 15%; background: linear-gradient(to top, #dc2626, rgba(220, 38, 38, 0.3)); border-radius: 4px;"></div>
                                <span style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-top: 4px;">50+</span>
                            </div>
                        </div>
                    </div>
                    <p style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 15px; line-height: 1.5;">
                        <i class="fas fa-info-circle me-1" style="color: #14b8a6;"></i>
                        Transactions wait in the mempool until miners include them in a block. Higher fees = faster confirmation.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- 3. Epoch Progress -->
        <div class="intel-card glass-module" id="intel-epoch" onclick="toggleIntelCard(this, event)" style="border-color: rgba(247, 147, 26, 0.3);">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.3), rgba(247, 147, 26, 0.1)); border-color: rgba(247, 147, 26, 0.5); color: #f7931a;">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title" style="color: #f7931a;">Epoch Progress</h4>
                    <p class="intel-card-subtitle">Difficulty Adjustment</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="epoch-pct-mini">62%</span> Complete</div>
                <div class="intel-stat"><span id="epoch-adj-mini">+3.2%</span> Est. Adj</div>
            </div>
            <div class="intel-card-content">
                <div class="epoch-progress-container" style="padding: 0;">
                    <div class="epoch-bar-wrapper" style="height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; margin-bottom: 20px;">
                        <div class="epoch-bar-fill" id="epoch-bar-fill-grid" style="width: 62%; height: 100%; background: linear-gradient(90deg, #f7931a, #facc15); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px;">
                            <span id="epoch-bar-text-grid" style="font-size: 0.7rem; font-weight: 700; color: #000;">62%</span>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); text-transform: uppercase; margin-bottom: 5px;">Block</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #f7931a;" id="epoch-block-grid">1,247</div>
                            <div style="font-size: 0.65rem; color: rgba(255,255,255,0.4);">of 2,016</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); text-transform: uppercase; margin-bottom: 5px;">Remaining</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #fff;" id="epoch-remaining-grid">769</div>
                            <div style="font-size: 0.65rem; color: rgba(255,255,255,0.4);">blocks</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.6rem; color: rgba(255,255,255,0.4); text-transform: uppercase; margin-bottom: 5px;">Est. Adjust</div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #22c55e;" id="epoch-adjustment-grid">+3.2%</div>
                            <div style="font-size: 0.65rem; color: rgba(255,255,255,0.4);" id="epoch-time-grid">~5 days</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 4. Sovereignty Calculator - FULL FEATURED -->
        <div class="intel-card glass-module" id="intel-calculator" onclick="toggleIntelCard(this, event)" style="border-color: rgba(34, 197, 94, 0.3);">
            <div class="intel-card-header">
                <div class="intel-card-icon" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.1)); border-color: rgba(34, 197, 94, 0.5); color: #22c55e;">
                    <i class="fas fa-calculator"></i>
                </div>
                <div class="intel-card-info">
                    <h4 class="intel-card-title" style="color: #22c55e;">Sovereignty Calculator</h4>
                    <p class="intel-card-subtitle">DCA Strategy Tool</p>
                </div>
                <div class="intel-card-expand"><i class="fas fa-expand-alt"></i></div>
            </div>
            <div class="intel-card-preview">
                <div class="intel-stat"><span id="calc-gain-mini" style="color: #22c55e;">+173%</span> Gain</div>
                <div class="intel-stat">What If You'd Stacked?</div>
            </div>
            <div class="intel-card-content">
                <!-- Input Controls - 3 Column Grid -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 15px;">
                    <div>
                        <label style="font-size: 0.6rem; color: rgba(255,255,255,0.5); text-transform: uppercase; display: block; margin-bottom: 6px;">Amount ($)</label>
                        <input type="number" id="calc-amount-grid" value="50" min="1" onchange="calculateDCAGrid()" style="width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 10px; color: #22c55e; font-size: 1rem; font-family: 'JetBrains Mono', monospace;">
                    </div>
                    <div>
                        <label style="font-size: 0.6rem; color: rgba(255,255,255,0.5); text-transform: uppercase; display: block; margin-bottom: 6px;">Frequency</label>
                        <select id="calc-frequency-grid" onchange="calculateDCAGrid()" style="width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 10px; color: #22c55e; font-size: 0.9rem;">
                            <option value="daily">Daily</option>
                            <option value="weekly" selected>Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 0.6rem; color: rgba(255,255,255,0.5); text-transform: uppercase; display: block; margin-bottom: 6px;">Start Date</label>
                        <input type="date" id="calc-start-date-grid" value="2021-01-01" onchange="calculateDCAGrid()" style="width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 10px; color: #22c55e; font-size: 0.85rem;">
                    </div>
                </div>
                <!-- Preset Buttons - ALL OPTIONS -->
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 18px;">
                    <button onclick="setCalcPresetGrid('inception', event)" style="background: rgba(247, 147, 26, 0.2); border: 1px solid rgba(247, 147, 26, 0.4); color: #f7931a; padding: 8px 12px; border-radius: 6px; font-size: 0.7rem; cursor: pointer; font-weight: 600;"><i class="fas fa-star me-1"></i>Since Inception</button>
                    <button onclick="setCalcPresetGrid('halving', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 8px 12px; border-radius: 6px; font-size: 0.7rem; cursor: pointer;">Last Halving</button>
                    <button onclick="setCalcPresetGrid('2020', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 8px 12px; border-radius: 6px; font-size: 0.7rem; cursor: pointer;">Since 2020</button>
                    <button onclick="setCalcPresetGrid('ath', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 8px 12px; border-radius: 6px; font-size: 0.7rem; cursor: pointer;">Since $69K Top</button>
                    <button onclick="setCalcPresetGrid('year', event)" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 8px 12px; border-radius: 6px; font-size: 0.7rem; cursor: pointer;">Past Year</button>
                </div>
                <!-- Results Grid -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                    <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 10px; padding: 12px; text-align: center;">
                        <div style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px;">INVESTED</div>
                        <div id="calc-invested-grid" style="font-size: 1.4rem; font-weight: 700; color: #f7931a;">$10,400</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 10px; padding: 12px; text-align: center;">
                        <div style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px;">BTC STACKED</div>
                        <div id="calc-btc-grid" style="font-size: 1.4rem; font-weight: 700; color: #f7931a;">0.284 BTC</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 10px; padding: 12px; text-align: center;">
                        <div style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px;">CURRENT VALUE</div>
                        <div id="calc-value-grid" style="font-size: 1.4rem; font-weight: 700; color: #22c55e;">$28,470</div>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.4); border-radius: 10px; padding: 12px; text-align: center;">
                        <div style="font-size: 0.55rem; color: rgba(255,255,255,0.4); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px;">TOTAL GAIN</div>
                        <div id="calc-gain-grid" style="font-size: 1.4rem; font-weight: 700; color: #22c55e;">+173.8%</div>
                    </div>
                </div>
                <!-- Chart Area -->
                <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(34, 197, 94, 0.15); border-radius: 10px; padding: 10px; height: 140px; position: relative;">
                    <div style="position: absolute; top: 8px; left: 12px; font-size: 0.55rem; color: rgba(255,255,255,0.3); text-transform: uppercase; letter-spacing: 1px;">Portfolio Growth</div>
                    <canvas id="stack-chart-grid" style="width: 100%; height: 100%;"></canvas>
                </div>
                <!-- DCA Insight -->
                <div style="margin-top: 12px; padding: 10px 12px; background: rgba(247, 147, 26, 0.08); border-left: 3px solid #f7931a; border-radius: 0 6px 6px 0;">
                    <p style="margin: 0; font-size: 0.75rem; color: rgba(255,255,255,0.7); line-height: 1.5;">
                        <i class="fas fa-lightbulb me-1" style="color: #f7931a;"></i>
                        <strong style="color: #f7931a;">DCA Strategy:</strong> Consistent stacking reduces timing risk. Results based on historical Bitcoin prices.
                    </p>
                </div>
            </div>
        </div>
        
    </div>
</section>

<!-- OLD State of Pulse - HIDDEN (content moved to intel grid above) -->
<section class="container" style="margin-bottom: 40px; display: none;">
    <div class="pulse-command-center" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.08) 0%, rgba(0, 0, 0, 0.95) 50%, rgba(220, 38, 38, 0.05) 100%); border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 20px; overflow: hidden; position: relative;">
        <!-- Animated grid background -->
        <div style="position: absolute; inset: 0; background: linear-gradient(rgba(139, 92, 246, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(139, 92, 246, 0.03) 1px, transparent 1px); background-size: 50px 50px; pointer-events: none;"></div>
        
        <div class="module-header" style="padding: 25px 30px; border-bottom: 1px solid rgba(139, 92, 246, 0.2); position: relative; z-index: 1;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(139, 92, 246, 0.1) 100%); border: 2px solid rgba(139, 92, 246, 0.5); border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-satellite-dish" style="font-size: 1.5rem; color: #8b5cf6;"></i>
                </div>
                <div>
                    <h3 style="font-size: 1.6rem; font-weight: 800; color: #8b5cf6; text-transform: uppercase; letter-spacing: 3px; margin: 0;">State of the Pulse</h3>
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.85rem; margin: 5px 0 0;">Real-Time Network Intelligence Brief</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 10px; height: 10px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite;"></div>
                <span style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #22c55e;">LIVE FEED</span>
            </div>
        </div>
        
        <!-- Main content grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 0; position: relative; z-index: 1;">
            <!-- Network Vitals -->
            <div style="padding: 25px; border-right: 1px solid rgba(139, 92, 246, 0.1); border-bottom: 1px solid rgba(139, 92, 246, 0.1);">
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
                    <i class="fas fa-heartbeat me-2" style="color: #22c55e;"></i>Network Vitals
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: #22c55e;" id="pulse-health">98.7%</div>
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">HEALTH SCORE</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: 700; color: #3b82f6;" id="pulse-tps">6.2</div>
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">TXS/SEC</div>
                    </div>
                </div>
            </div>
            
            <!-- Market Pulse -->
            <div style="padding: 25px; border-right: 1px solid rgba(139, 92, 246, 0.1); border-bottom: 1px solid rgba(139, 92, 246, 0.1);">
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
                    <i class="fas fa-chart-line me-2" style="color: #f7931a;"></i>Market Pulse
                </div>
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="font-size: 2.2rem; font-weight: 800; color: #f7931a; font-family: 'JetBrains Mono', monospace;" id="pulse-price">Loading...</div>
                    <div style="background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.4); padding: 5px 12px; border-radius: 20px;">
                        <span style="color: #22c55e; font-size: 0.85rem; font-weight: 600;" id="pulse-change">+2.4%</span>
                    </div>
                </div>
                <div style="height: 40px; background: rgba(247, 147, 26, 0.1); border-radius: 8px; overflow: hidden; position: relative;">
                    <svg id="pulse-mini-chart" width="100%" height="40" preserveAspectRatio="none"></svg>
                </div>
            </div>
            
            <!-- Fee Conditions -->
            <div style="padding: 25px; border-bottom: 1px solid rgba(139, 92, 246, 0.1);">
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
                    <i class="fas fa-gas-pump me-2" style="color: #14b8a6;"></i>Fee Conditions
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                    <div>
                        <div style="font-size: 2rem; font-weight: 700; color: #14b8a6; font-family: 'JetBrains Mono', monospace;" id="pulse-fee">8</div>
                        <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">SAT/VB PRIORITY</div>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3); padding: 8px 15px; border-radius: 8px;">
                        <span style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">LOW TRAFFIC</span>
                    </div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <div style="flex: 1; background: rgba(34, 197, 94, 0.3); height: 6px; border-radius: 3px;"></div>
                    <div style="flex: 1; background: rgba(34, 197, 94, 0.15); height: 6px; border-radius: 3px;"></div>
                    <div style="flex: 1; background: rgba(255,255,255,0.05); height: 6px; border-radius: 3px;"></div>
                </div>
            </div>
        </div>
        
        <!-- Intelligence Summary -->
        <div style="padding: 25px 30px; border-top: 1px solid rgba(139, 92, 246, 0.2); background: rgba(0,0,0,0.3); position: relative; z-index: 1;">
            <div style="display: flex; align-items: flex-start; gap: 20px;">
                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, rgba(247, 147, 26, 0.3) 0%, rgba(247, 147, 26, 0.1) 100%); border: 2px solid rgba(247, 147, 26, 0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-brain" style="color: #f7931a; font-size: 1.2rem;"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px;">AI INTELLIGENCE BRIEF</div>
                    <p id="verdict-summary" style="color: rgba(255,255,255,0.85); font-size: 0.95rem; line-height: 1.7; margin: 0;">
                        The network is operating at <span style="color: #22c55e; font-weight: 600;">peak efficiency</span> with historically low fees and rising hashrate. 
                        Exchange outflows continue to signal <span style="color: #f7931a; font-weight: 600;">accumulation behavior</span>, while energy metrics demonstrate 
                        Bitcoin's growing role in monetizing stranded renewable capacity. The protocol remains 
                        <span style="color: #8b5cf6; font-weight: 600;">antifragile</span>every attack vector explored has only made it stronger.
                    </p>
                    <div id="verdict-timestamp" style="font-size: 0.7rem; color: rgba(255,255,255,0.3); margin-top: 12px; font-family: 'JetBrains Mono', monospace;">
                        Updated: <span id="pulse-update-time">January 29, 2026 at 10:45 AM UTC</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Signal indicators -->
        <div style="display: flex; justify-content: center; gap: 30px; padding: 20px; border-top: 1px solid rgba(139, 92, 246, 0.15); background: rgba(139, 92, 246, 0.05);">
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
                <span style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Hashrate: <span style="color: #22c55e;">Optimal</span></span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
                <span style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Mempool: <span style="color: #22c55e;">Clear</span></span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 8px; height: 8px; background: #f7931a; border-radius: 50%;"></div>
                <span style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Sentiment: <span style="color: #f7931a;">Bullish</span></span>
            </div>
        </div>
    </div>
</section>

<!-- 6. MEMPOOL HEATMAP - HIDDEN (moved to Pulse Intel Grid) -->
<section class="container" style="display: none;">
    <div class="glass-module" style="border-color: rgba(20, 184, 166, 0.3);">
        <div class="module-header">
            <div class="module-icon" style="background: rgba(20, 184, 166, 0.15); border-color: rgba(20, 184, 166, 0.3); color: #14b8a6;">
                <i class="fas fa-fire-alt"></i>
            </div>
            <div>
                <h3 class="module-title" style="color: #14b8a6;">Mempool Heatmap</h3>
                <p class="module-subtitle">Transaction Fee Urgency</p>
            </div>
        </div>
        
        <div class="mempool-heatmap-container">
            <div class="heatmap-header">
                <span class="heatmap-title"><i class="fas fa-fire-alt me-2"></i>Fee Distribution</span>
                <div class="heatmap-stats">
                    <div class="heatmap-stat">
                        <div class="heatmap-stat-value" id="heatmap-total-txs">--</div>
                        <div class="heatmap-stat-label">Pending TXs</div>
                    </div>
                    <div class="heatmap-stat">
                        <div class="heatmap-stat-value" id="heatmap-median-fee">--</div>
                        <div class="heatmap-stat-label">Median Fee</div>
                    </div>
                </div>
            </div>
            <div class="heatmap-visual" id="mempool-heatmap">
                <div class="heatmap-glow"></div>
                <div class="heatmap-blocks">
                    <div class="heatmap-band" data-fee="1-5">
                        <span class="heatmap-bar-value" id="fee-1-5-count">--</span>
                        <div class="heatmap-bar" style="height: 80%;"></div>
                    </div>
                    <div class="heatmap-band" data-fee="5-10">
                        <span class="heatmap-bar-value" id="fee-5-10-count">--</span>
                        <div class="heatmap-bar" style="height: 65%;"></div>
                    </div>
                    <div class="heatmap-band" data-fee="10-20">
                        <span class="heatmap-bar-value" id="fee-10-20-count">--</span>
                        <div class="heatmap-bar" style="height: 45%;"></div>
                    </div>
                    <div class="heatmap-band" data-fee="20-30">
                        <span class="heatmap-bar-value" id="fee-20-30-count">--</span>
                        <div class="heatmap-bar" style="height: 30%;"></div>
                    </div>
                    <div class="heatmap-band" data-fee="30-50">
                        <span class="heatmap-bar-value" id="fee-30-50-count">--</span>
                        <div class="heatmap-bar" style="height: 20%;"></div>
                    </div>
                    <div class="heatmap-band" data-fee="50-100">
                        <span class="heatmap-bar-value" id="fee-50-100-count">--</span>
                        <div class="heatmap-bar" style="height: 15%;"></div>
                    </div>
                    <div class="heatmap-band" data-fee="100+">
                        <span class="heatmap-bar-value" id="fee-100-count">--</span>
                        <div class="heatmap-bar" style="height: 10%;"></div>
                    </div>
                </div>
            </div>
            <div class="heatmap-labels">
                <span class="heatmap-fee-label">1-5</span>
                <span class="heatmap-fee-label">5-10</span>
                <span class="heatmap-fee-label">10-20</span>
                <span class="heatmap-fee-label">20-30</span>
                <span class="heatmap-fee-label">30-50</span>
                <span class="heatmap-fee-label">50-100</span>
                <span class="heatmap-fee-label">100+</span>
            </div>
            <div class="heatmap-legend">
                <div class="heatmap-legend-item">
                    <span class="heatmap-legend-dot calm"></span>
                    <span style="color: #14b8a6;">Patient (Low Fee)</span>
                </div>
                <div class="heatmap-legend-item">
                    <span class="heatmap-legend-dot urgent"></span>
                    <span style="color: #dc2626;">Urgent (High Fee)</span>
                </div>
            </div>
            
            <div class="mempool-explainer">
                <div class="explainer-toggle" onclick="toggleExplainer()">
                    <span><i class="fas fa-question-circle me-2"></i>What is the mempool?</span>
                    <i class="fas fa-chevron-down" id="explainer-arrow"></i>
                </div>
                <div class="explainer-content" id="explainer-content">
                    <p><strong>Think of it like a waiting room.</strong> When you send Bitcoin, your transaction doesn't get confirmed instantly. It first goes to the "mempool" (memory pool)  a holding area where all pending transactions wait to be picked up by miners.</p>
                    <p style="margin-top: 12px;"><strong>Higher fee = faster service.</strong> Miners prioritize transactions that pay higher fees. The heatmap above shows how many transactions are waiting at each fee level. When the left side (low fees) is tall, the network is calm. When the right side (high fees) lights up, there's high demand.</p>
                    <p style="margin-top: 12px;"><strong>When a block is mined</strong>, the highest-fee transactions get "sliced" off and confirmed forever on the blockchain. The rest keep waiting.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 7. EPOCH PROGRESS BAR - HIDDEN (moved to Pulse Intel Grid) -->
<section class="container" style="display: none;">
    <div class="glass-module" style="border-color: rgba(247, 147, 26, 0.3);">
        <div class="module-header">
            <div class="module-icon" style="background: rgba(247, 147, 26, 0.15); border-color: rgba(247, 147, 26, 0.3); color: #f7931a;">
                <i class="fas fa-chart-line"></i>
            </div>
            <div>
                <h3 class="module-title" style="color: #f7931a;">Epoch Progress</h3>
                <p class="module-subtitle">Difficulty Adjustment Cycle</p>
            </div>
        </div>
        
        <div class="epoch-progress-container">
            <div class="epoch-bar-wrapper">
                <div class="epoch-bar-fill" id="epoch-bar-fill" style="width: 62%;">
                    <span class="epoch-bar-text" id="epoch-bar-text">62%</span>
                </div>
            </div>
            
            <div class="epoch-stats">
                <div class="epoch-stat">
                    <div class="epoch-stat-label">Block</div>
                    <div class="epoch-stat-value" id="epoch-block-current">1,247</div>
                </div>
                <div class="epoch-stat">
                    <div class="epoch-stat-label">of</div>
                    <div class="epoch-stat-value">2,016</div>
                </div>
                <div class="epoch-stat">
                    <div class="epoch-stat-label">Blocks Remaining</div>
                    <div class="epoch-stat-value" id="epoch-blocks-remaining">769</div>
                </div>
                <div class="epoch-stat">
                    <div class="epoch-stat-label">Est. Adjustment</div>
                    <div class="epoch-stat-value positive" id="epoch-adjustment">+3.2%</div>
                </div>
                <div class="epoch-stat">
                    <div class="epoch-stat-label">Time to Adjust</div>
                    <div class="epoch-stat-value" id="epoch-time-remaining">~5 days</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 12. TIMECHAIN CLOCK - World-Class Enhancement -->
<section class="container">
    <div class="timechain-module">
        <div class="timechain-header">
            <div class="timechain-icon-wrap">
                <div class="timechain-icon-glow"></div>
                <i class="fas fa-hourglass-half"></i>
            </div>
            <div class="timechain-title-wrap">
                <h3 class="timechain-title">Timechain Clock</h3>
                <p class="timechain-subtitle">Bitcoin Measures Time in Blocks, Not Seconds</p>
            </div>
        </div>
        
        <div class="timechain-content">
            <div class="timechain-clock-visual">
                <div class="clock-outer-ring">
                    <div class="clock-epoch-markers">
                        <span class="epoch-marker" style="--angle: 0deg;">2024</span>
                        <span class="epoch-marker" style="--angle: 90deg;">2028</span>
                        <span class="epoch-marker" style="--angle: 180deg;">2032</span>
                        <span class="epoch-marker" style="--angle: 270deg;">2036</span>
                    </div>
                    <div class="clock-face-enhanced" id="timechain-clock">
                        <div class="clock-glow-inner"></div>
                        <div class="clock-tick-marks"></div>
                        <div class="clock-hand epoch-hand" id="clock-epoch-hand"></div>
                        <div class="clock-hand block-hand" id="clock-block-hand"></div>
                        <div class="clock-hand minute-hand" id="clock-minute-hand"></div>
                        <div class="clock-center-bitcoin">
                            <i class="fab fa-bitcoin"></i>
                        </div>
                    </div>
                </div>
                <div class="clock-legend">
                    <div class="legend-item"><span class="legend-dot epoch"></span> Halving Epoch</div>
                    <div class="legend-item"><span class="legend-dot block"></span> Block Progress</div>
                    <div class="legend-item"><span class="legend-dot minute"></span> Time Since Block</div>
                </div>
            </div>
            
            <div class="timechain-data-panel">
                <div class="timechain-block-display">
                    <div class="block-height-wrap">
                        <span class="block-hash-prefix">#</span>
                        <span class="block-height-value" id="clock-block-height">879,241</span>
                    </div>
                    <div class="block-height-label">Current Block Height</div>
                    <div class="block-progress-bar">
                        <div class="block-progress-fill" id="block-epoch-progress"></div>
                    </div>
                    <div class="block-progress-label"><span id="epoch-progress-pct">0</span>% through current epoch</div>
                </div>
                
                <div class="timechain-stats-grid">
                    <div class="timechain-stat">
                        <div class="stat-icon"><i class="fas fa-stopwatch"></i></div>
                        <div class="stat-data">
                            <div class="stat-value" id="clock-since-block">7:24</div>
                            <div class="stat-label">Since Last Block</div>
                        </div>
                    </div>
                    <div class="timechain-stat">
                        <div class="stat-icon"><i class="fas fa-gem"></i></div>
                        <div class="stat-data">
                            <div class="stat-value" id="current-subsidy">3.125 BTC</div>
                            <div class="stat-label">Block Subsidy</div>
                        </div>
                    </div>
                    <div class="timechain-stat">
                        <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="stat-data">
                            <div class="stat-value" id="clock-halving-blocks">115,759</div>
                            <div class="stat-label">Blocks to Halving</div>
                        </div>
                    </div>
                    <div class="timechain-stat">
                        <div class="stat-icon"><i class="fas fa-rocket"></i></div>
                        <div class="stat-data">
                            <div class="stat-value" id="halving-eta">~2028</div>
                            <div class="stat-label">Next Halving</div>
                        </div>
                    </div>
                </div>
                
                <div class="timechain-insight">
                    <div class="insight-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="insight-text">
                        <strong>Timechain Fact:</strong> Bitcoin's difficulty adjustment ensures blocks arrive every ~10 minutes on average, making it the most accurate timekeeping system ever created.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="timechain-footer">
            <div class="epoch-timeline">
                <div class="epoch-bar">
                    <div class="epoch-segment complete" style="width: 25%;" title="2012: 5025 BTC"></div>
                    <div class="epoch-segment complete" style="width: 25%;" title="2016: 2512.5 BTC"></div>
                    <div class="epoch-segment complete" style="width: 25%;" title="2020: 12.56.25 BTC"></div>
                    <div class="epoch-segment active" style="width: 25%;" title="2024: 6.253.125 BTC">
                        <div class="epoch-current-marker" id="epoch-marker"></div>
                    </div>
                </div>
                <div class="epoch-labels">
                    <span>2012</span>
                    <span>2016</span>
                    <span>2020</span>
                    <span>2024</span>
                    <span>2028</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 14. GENESIS BLOCK SHRINE -->
<section class="container">
    <div class="genesis-shrine" style="background: radial-gradient(ellipse at center, rgba(247, 147, 26, 0.08) 0%, rgba(20, 10, 0, 0.95) 50%, rgba(0, 0, 0, 1) 100%); border: 2px solid rgba(247, 147, 26, 0.3); box-shadow: 0 0 60px rgba(247, 147, 26, 0.15), inset 0 0 100px rgba(247, 147, 26, 0.05); padding: 50px 30px;">
        <div class="genesis-flame" style="height: 4px; background: linear-gradient(90deg, transparent, #f7931a, #ff6600, #f7931a, transparent); animation: genesisPulse 3s ease-in-out infinite;"></div>
        
        <div class="genesis-content" style="text-align: center;">
            <div class="genesis-block-visual" style="font-size: 5rem; font-weight: 900; color: #f7931a; text-shadow: 0 0 60px rgba(247, 147, 26, 0.6), 0 0 120px rgba(247, 147, 26, 0.3); margin-bottom: 20px; font-family: 'JetBrains Mono', monospace; letter-spacing: -5px; animation: genesisGlow 4s ease-in-out infinite;">
                #0
            </div>
            
            <div class="genesis-info">
                <div class="genesis-title" style="font-size: 2rem; font-weight: 800; color: #f7931a; text-transform: uppercase; letter-spacing: 8px; margin-bottom: 10px; text-shadow: 0 0 30px rgba(247, 147, 26, 0.5);">The Genesis Block</div>
                <div class="genesis-date" style="font-size: 1rem; color: rgba(255, 255, 255, 0.7); letter-spacing: 3px; margin-bottom: 30px;">January 3, 2009  <span style="color: #f7931a;">Satoshi Nakamoto</span></div>
                
                <div class="genesis-headline" style="font-size: 1.2rem; font-style: italic; color: rgba(255, 255, 255, 0.9); max-width: 700px; margin: 0 auto 30px; padding: 25px; background: rgba(247, 147, 26, 0.08); border-left: 4px solid #f7931a; border-radius: 0 12px 12px 0; text-align: left; display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                    <a href="https://www.thetimes.co.uk/article/chancellor-alistair-darling-on-brink-of-second-bailout-for-banks-n9l382mn62h" target="_blank" rel="noopener noreferrer" style="flex-shrink: 0; transition: transform 0.3s; display: block;">
                        <img src="/static/images/times-2009-01-03.jpg" alt="The Times - January 3, 2009 - Chancellor on brink of second bailout for banks" style="width: 140px; height: auto; border: 2px solid rgba(247, 147, 26, 0.5); border-radius: 8px; box-shadow: 0 0 20px rgba(247, 147, 26, 0.3); cursor: pointer; transition: 0.5s;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 30px rgba(247, 147, 26, 0.5)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 20px rgba(247, 147, 26, 0.3)'">
                    </a>
                    <div style="flex: 1; min-width: 200px;">
                        "The Times 03/Jan/2009 Chancellor on brink of second bailout for banks"
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 10px; font-style: normal;">
                            <i class="fas fa-external-link-alt me-1"></i> Click image to view original article
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 30px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: 700; color: #f7931a;" id="genesis-days-count">5,870</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 2px;">Days of Uptime</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: 700; color: #22c55e;">99.99%</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 2px;">Network Uptime</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: 700; color: #3b82f6;">50 BTC</div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 2px;">First Reward (Unspendable)</div>
                    </div>
                </div>
                
                <button class="genesis-expand-btn" onclick="toggleGenesisExpand()" style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.2) 0%, rgba(247, 147, 26, 0.05) 100%); border: 1px solid rgba(247, 147, 26, 0.4); color: #f7931a; padding: 12px 30px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-cube me-2"></i> View Sacred Block Data
                </button>
                
                <div id="genesis-expanded" style="display: none; margin-top: 30px; padding: 25px; background: rgba(0,0,0,0.6); border: 1px solid rgba(247, 147, 26, 0.2); border-radius: 12px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: rgba(255,255,255,0.8); text-align: left; max-width: 700px; margin-left: auto; margin-right: auto;">
                    <p style="word-break: break-all;"><span style="color: #f7931a;">Block Hash:</span><br><span style="opacity: 0.7;">000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</span></p>
                    <p style="margin-top: 15px; word-break: break-all;"><span style="color: #f7931a;">Merkle Root:</span><br><span style="opacity: 0.7;">4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b</span></p>
                    <p style="margin-top: 15px;"><span style="color: #f7931a;">Timestamp:</span> <span style="opacity: 0.7;">2009-01-03 18:15:05 UTC</span></p>
                    <p style="margin-top: 15px;"><span style="color: #f7931a;">Coinbase Reward:</span> <span style="opacity: 0.7;">50 BTC (forever unspendable due to original code bug)</span></p>
                    <p style="margin-top: 15px;"><span style="color: #f7931a;">Nonce:</span> <span style="opacity: 0.7;">2083236893</span></p>
                    <p style="margin-top: 15px;"><span style="color: #f7931a;">Difficulty:</span> <span style="opacity: 0.7;">1</span></p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
@keyframes genesisGlow {
    0%, 100% { text-shadow: 0 0 60px rgba(247, 147, 26, 0.6), 0 0 120px rgba(247, 147, 26, 0.3); }
    50% { text-shadow: 0 0 80px rgba(247, 147, 26, 0.8), 0 0 160px rgba(247, 147, 26, 0.5); }
}
@keyframes genesisPulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}
</style>

<!-- 15. CALL TO ACTION -->
<section class="container" style="margin-bottom: 40px;">
    <div class="cta-section">
        <div class="cta-title">Join the Sovereign Network</div>
        
        <div class="cta-options">
            <div class="cta-option" id="cta-email-option">
                <div class="cta-option-icon email"><i class="fas fa-envelope"></i></div>
                <div class="cta-option-title">Daily Pulse</div>
                <div class="cta-option-desc">Get verified intelligence at 6am EST</div>
                <form class="cta-email-form" onsubmit="subscribeEmail(event)">
                    <input type="email" class="cta-email-input" placeholder="your@email.com" required>
                    <button type="submit" class="cta-email-btn">Subscribe</button>
                </form>
            </div>
            
            <a href="https://primal.net/protocolpulse" target="_blank" class="cta-option">
                <div class="cta-option-icon nostr"><i class="fas fa-broadcast-tower"></i></div>
                <div class="cta-option-title">Follow on Nostr</div>
                <div class="cta-option-desc">The uncensorable network</div>
            </a>
            
            <a href="https://x.com/protocolpulse" target="_blank" class="cta-option">
                <div class="cta-option-icon twitter" style="background: rgba(0, 0, 0, 0.8); border-color: rgba(255, 255, 255, 0.3);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </div>
                <div class="cta-option-title">Follow on X</div>
                <div class="cta-option-desc">Join 12.4K sovereign individuals</div>
            </a>
            
            <div class="cta-option" onclick="showLightningTip()">
                <div class="cta-option-icon lightning"><i class="fas fa-bolt"></i></div>
                <div class="cta-option-title">Support the Signal</div>
                <div class="cta-option-desc">Lightning tip jar</div>
            </div>
        </div>
    </div>
</section>

<!-- SOVEREIGN INTELLIGENCE DASHBOARD (Original Metrics Grid) -->
<section class="sovereign-dashboard container-fluid" style="margin-top: 60px; padding-top: 40px; padding-bottom: 60px; border-top: 1px solid rgba(220, 38, 38, 0.2); background: linear-gradient(180deg, rgba(10, 5, 5, 0.95) 0%, rgba(0, 0, 0, 1) 100%);">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12"><div class="dashboard-divider"></div></div>
        </div>

        <div class="row g-4 text-center">
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Sustainable Energy</small>
                    <h2 class="stat-value" id="intel-renewable">54.5%</h2>
                    <p class="stat-note">Network Renewable Mix</p>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Network Shield</small>
                    <h2 class="stat-value" id="intel-nodes">18,241</h2>
                    <p class="stat-note">Active Sovereign Nodes</p>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Computational Moat</small>
                    <h2 class="stat-value" id="intel-hashrate">-- EH/s</h2>
                    <p class="stat-note">Exahash Per Second</p>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Unconfirmed</small>
                    <h2 class="stat-value" id="intel-pending">--</h2>
                    <p class="stat-note">Pending Transactions</p>
                </div>
            </div>
        </div>
        
        <div class="row g-4 text-center mt-2">
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Lightning Network</small>
                    <h2 class="stat-value" id="intel-lightning">-- BTC</h2>
                    <p class="stat-note">Public Channel Capacity</p>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Mining Difficulty</small>
                    <h2 class="stat-value" id="intel-difficulty">-- T</h2>
                    <p class="stat-note">Network Security Level</p>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Next Halving</small>
                    <h2 class="stat-value" id="intel-halving">-- days</h2>
                    <p class="stat-note">Subsidy Reduction ETA</p>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card p-4">
                    <small class="stat-label">Block Height</small>
                    <h2 class="stat-value" id="intel-height">#---,---</h2>
                    <p class="stat-note">Latest Confirmed Block</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Infrastructure Used Layer - Subtle institutional disclosure -->
<section class="intelligence-module" style="background: transparent; border: none; margin-top: 40px;">
    <div class="infrastructure-disclosure">
        <div class="disclosure-header">
            <span class="disclosure-label"><i class="fas fa-link"></i> Infrastructure Referenced</span>
            <a href="/logistics" class="disclosure-link">Full Index &rarr;</a>
        </div>
        <p class="disclosure-text">
            This terminal reflects data aggregated from sovereign infrastructure. 
            <span class="infra-ref" title="Liquidity rails">Exchange liquidity</span> | 
            <span class="infra-ref" title="Mining hardware">Hash infrastructure</span> | 
            <span class="infra-ref" title="Generational security">Insurance coverage</span>
        </p>
    </div>
    
    <!-- Legacy Leak Alert - Diegetic placement for Meanwhile -->
    <div class="legacy-leak-alert">
        <div class="leak-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="leak-content">
            <span class="leak-label">LEGACY LEAK DETECTED</span>
            <span class="leak-text">Purchasing power decay without generational coverage = wealth erosion.</span>
        </div>
        <a href="/go/meanwhile" class="leak-cta">Seal the Leak <i class="fas fa-arrow-right"></i></a>
    </div>
</section>

<style>
.infrastructure-disclosure {
    max-width: 680px;
    margin: 0 auto;
    text-align: center;
    padding: 24px;
    background: rgba(255, 255, 255, 0.01);
    border: 1px solid rgba(255, 255, 255, 0.04);
    border-radius: 8px;
}

.disclosure-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.disclosure-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: rgba(255, 255, 255, 0.25);
}

.disclosure-label i {
    margin-right: 6px;
}

.disclosure-link {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.3);
    text-decoration: none;
    transition: color 0.2s ease;
}

.disclosure-link:hover {
    color: rgba(255, 255, 255, 0.6);
}

.disclosure-text {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.3);
    line-height: 1.6;
    margin: 0;
}

.infra-ref {
    color: rgba(255, 255, 255, 0.4);
    cursor: help;
    border-bottom: 1px dotted rgba(255, 255, 255, 0.2);
    transition: color 0.2s ease;
}

.infra-ref:hover {
    color: rgba(255, 255, 255, 0.6);
}

.legacy-leak-alert {
    display: flex;
    align-items: center;
    gap: 15px;
    max-width: 680px;
    margin: 20px auto 0;
    padding: 16px 20px;
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.08) 0%, rgba(245, 158, 11, 0.03) 100%);
    border: 1px solid rgba(245, 158, 11, 0.2);
    border-radius: 10px;
    flex-wrap: wrap;
}

.leak-icon {
    color: #f59e0b;
    font-size: 1rem;
    opacity: 0.8;
}

.leak-content {
    flex: 1;
    min-width: 200px;
}

.leak-label {
    display: block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: #f59e0b;
    letter-spacing: 0.15em;
    margin-bottom: 4px;
}

.leak-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.5);
}

.leak-cta {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: #f59e0b;
    text-decoration: none;
    padding: 8px 16px;
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: 6px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.leak-cta:hover {
    background: rgba(245, 158, 11, 0.1);
    border-color: #f59e0b;
    color: #f59e0b;
}

@media (max-width: 600px) {
    .legacy-leak-alert {
        flex-direction: column;
        text-align: center;
    }
    .leak-cta {
        width: 100%;
        justify-content: center;
    }
}
</style>

<!-- Footer Buffer Space -->
<div style="height: 80px;"></div>
{% endblock %}

{% block scripts %}
<!-- Three.js Core -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<!-- Three.js Post-Processing -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<script src="{{ url_for('static', filename='js/visualizer.js') }}?v=20260128h"></script>
<script>
// Ensure video plays on load
window.addEventListener('DOMContentLoaded', () => {
    const v = document.getElementById('pulse-bg-video');
    if (!v) return;
    
    const tryPlay = async () => {
        try { await v.play(); } catch (e) { console.log('Video autoplay blocked'); }
    };
    
    tryPlay();
    
    const unlock = () => {
        tryPlay();
        window.removeEventListener('click', unlock);
        window.removeEventListener('touchstart', unlock);
    };
    
    window.addEventListener('click', unlock, { once: true });
    window.addEventListener('touchstart', unlock, { once: true });
});
</script>
<script>
// Update Sovereign Status Bar with live network intel
async function updateSovereignStatusBar() {
    try {
        const [feesRes, hashrateRes, diffRes] = await Promise.all([
            fetch('https://mempool.space/api/v1/fees/recommended'),
            fetch('https://mempool.space/api/v1/mining/hashrate/1d'),
            fetch('https://mempool.space/api/v1/difficulty-adjustment')
        ]);
        
        const fees = await feesRes.json();
        const hashrate = await hashrateRes.json();
        const diff = await diffRes.json();
        
        // Fastest fee in sats/vB
        document.getElementById('status-fee-rate').textContent = fees.fastestFee + ' sat/vB';
        
        // Hashrate in EH/s
        if (hashrate.currentHashrate) {
            const ehps = (hashrate.currentHashrate / 1e18).toFixed(2);
            document.getElementById('status-hashrate').textContent = ehps + ' EH/s';
        }
        
        // Blocks until difficulty retarget
        if (diff.remainingBlocks !== undefined) {
            document.getElementById('status-retarget').textContent = diff.remainingBlocks.toLocaleString();
        }
        
        // Update Intel Strip - Difficulty (use current difficulty from API)
        try {
            const difficultyRes = await fetch('https://mempool.space/api/v1/mining/hashrate/3d');
            const diffData = await difficultyRes.json();
            if (diffData.currentDifficulty) {
                const diffT = (diffData.currentDifficulty / 1e12).toFixed(2);
                document.getElementById('intel-difficulty').textContent = diffT + ' T';
            }
        } catch (diffErr) {
            console.log('Difficulty fetch error:', diffErr);
        }
    } catch (e) {
        console.error('Status bar update error:', e);
    }
}

// Update Sovereign Intelligence Dashboard
async function updateNetworkIntel() {
    try {
        const [lnRes, blocksRes, mempoolRes, hashrateRes] = await Promise.all([
            fetch('https://mempool.space/api/v1/lightning/statistics/latest'),
            fetch('https://mempool.space/api/blocks/tip/height'),
            fetch('https://mempool.space/api/mempool'),
            fetch('https://mempool.space/api/v1/mining/hashrate/1d')
        ]);
        
        // Lightning Network capacity
        const ln = await lnRes.json();
        if (ln.latest && ln.latest.total_capacity) {
            const btcCapacity = (ln.latest.total_capacity / 100000000).toLocaleString();
            document.getElementById('intel-lightning').textContent = btcCapacity + ' BTC';
        }
        
        // Block height and halving ETA
        const currentHeight = await blocksRes.json();
        document.getElementById('intel-height').textContent = '#' + currentHeight.toLocaleString();
        
        const nextHalving = 1050000;
        const blocksRemaining = nextHalving - currentHeight;
        const daysRemaining = Math.round((blocksRemaining * 10) / 1440);
        document.getElementById('intel-halving').textContent = daysRemaining.toLocaleString() + ' days';
        
        // Pending transactions
        const mempool = await mempoolRes.json();
        const pendingK = (mempool.count / 1000).toFixed(1);
        document.getElementById('intel-pending').textContent = pendingK + 'K';
        
        // Hashrate
        const hashrate = await hashrateRes.json();
        if (hashrate.currentHashrate) {
            const ehps = (hashrate.currentHashrate / 1e18).toFixed(0);
            document.getElementById('intel-hashrate').textContent = '~' + ehps + ' EH/s';
        }
        
    } catch (e) {
        console.error('Network intel update error:', e);
    }
}

// Initial load + refresh every 60 seconds
updateSovereignStatusBar();
updateNetworkIntel();
setInterval(updateSovereignStatusBar, 30000);
setInterval(updateNetworkIntel, 60000);

async function updateMempoolData() {
    try {
        const [mempoolRes, feesRes, blocksRes] = await Promise.all([
            fetch('https://mempool.space/api/mempool'),
            fetch('https://mempool.space/api/v1/fees/recommended'),
            fetch('https://mempool.space/api/blocks')
        ]);
        
        const mempool = await mempoolRes.json();
        const fees = await feesRes.json();
        const blocks = await blocksRes.json();
        
        const mempoolMB = (mempool.vsize / 1000000).toFixed(1);
        const mempoolPercent = Math.min((mempool.vsize / 300000000) * 100, 100);
        
        document.getElementById('mempool-size').textContent = mempoolMB + ' vMB';
        document.getElementById('pending-txs').textContent = mempool.count.toLocaleString();
        document.getElementById('mempool-mb').textContent = mempoolMB + ' MB';
        document.getElementById('mempool-bar').style.height = mempoolPercent + '%';
        
        const nextBlockFee = fees.fastestFee;
        const feeEl = document.getElementById('next-block-fee');
        feeEl.textContent = nextBlockFee + ' sat/vB';
        feeEl.className = 'metric-value ' + (nextBlockFee < 10 ? 'fee-low' : nextBlockFee < 50 ? 'fee-medium' : 'fee-high');
        
        document.getElementById('low-fee').textContent = fees.hourFee + ' sat/vB';
        
        // Update heatmap elements
        const heatmapTotalTxs = document.getElementById('heatmap-total-txs');
        if (heatmapTotalTxs) heatmapTotalTxs.textContent = mempool.count.toLocaleString();
        
        const heatmapMedianFee = document.querySelectorAll('#heatmap-median-fee');
        const medianFee = Math.round((fees.fastestFee + fees.hourFee) / 2);
        heatmapMedianFee.forEach(el => el.textContent = medianFee + ' sat/vB');
        
        // Update fee distribution grid from histogram
        if (mempool.fee_histogram && mempool.fee_histogram.length > 0) {
            const histogram = mempool.fee_histogram;
            let fee1_5 = 0, fee5_10 = 0, fee10_20 = 0, fee20_50 = 0, fee50 = 0;
            histogram.forEach(([feeRate, vsize]) => {
                if (feeRate <= 5) fee1_5 += Math.round(vsize / 1000);
                else if (feeRate <= 10) fee5_10 += Math.round(vsize / 1000);
                else if (feeRate <= 20) fee10_20 += Math.round(vsize / 1000);
                else if (feeRate <= 50) fee20_50 += Math.round(vsize / 1000);
                else fee50 += Math.round(vsize / 1000);
            });
            const updateGridFee = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val > 999 ? (val/1000).toFixed(1) + 'k' : val; };
            updateGridFee('grid-fee-1-5', fee1_5);
            updateGridFee('grid-fee-5-10', fee5_10);
            updateGridFee('grid-fee-10-20', fee10_20);
            updateGridFee('grid-fee-20-50', fee20_50);
            updateGridFee('grid-fee-50', fee50);
            updateGridFee('fee-1-5-count', fee1_5);
            updateGridFee('fee-5-10-count', fee5_10);
            updateGridFee('fee-10-20-count', fee10_20);
            updateGridFee('fee-20-30-count', Math.round(fee20_50 * 0.6));
            updateGridFee('fee-30-50-count', Math.round(fee20_50 * 0.4));
            updateGridFee('fee-50-100-count', Math.round(fee50 * 0.7));
            updateGridFee('fee-100-count', Math.round(fee50 * 0.3));
        }
        
        if (blocks.length > 0) {
            const latest = blocks[0];
            document.getElementById('block-height').textContent = '#' + latest.height.toLocaleString();
            
            const blockTime = new Date(latest.timestamp * 1000);
            const now = new Date();
            const minAgo = Math.floor((now - blockTime) / 60000);
            document.getElementById('block-time').textContent = minAgo + ' min ago';
            
            document.getElementById('block-txs').textContent = latest.tx_count.toLocaleString();
            document.getElementById('block-size').textContent = (latest.size / 1000000).toFixed(2) + ' MB';
        }
        
        if (nextBlockFee <= 5) {
            checkAndNotifyLowFees(nextBlockFee);
        }
        
    } catch (error) {
        console.error('Mempool data fetch error:', error);
        document.getElementById('connection-status').textContent = 'Reconnecting...';
    }
}

function checkAndNotifyLowFees(fee) {
    if ('Notification' in window && Notification.permission === 'granted') {
        if (!window.lastFeeNotification || Date.now() - window.lastFeeNotification > 300000) {
            new Notification('Protocol Pulse: Low Fee Alert', {
                body: `Network fees dropped to ${fee} sat/vB. Optimal time to transact.`,
                icon: '/static/images/protocol-pulse-logo-transparent.png'
            });
            window.lastFeeNotification = Date.now();
        }
    }
}

updateMempoolData();
setInterval(updateMempoolData, 10000);

if ('Notification' in window && Notification.permission === 'default') {
    setTimeout(() => {
        Notification.requestPermission();
    }, 5000);
}

function closeTxPopup() {
    const overlay = document.getElementById('tx-popup-overlay');
    const card = document.getElementById('tx-popup-card');
    if (overlay) overlay.classList.remove('show');
    if (card) card.classList.remove('show');
}

function toggleVisualizer(mode) {
    const customViz = document.getElementById('visualizer-container');
    const bitfeedIframe = document.getElementById('bitfeed-iframe');
    const vizHud = document.querySelector('.viz-hud');
    const toggleCustom = document.getElementById('toggle-custom');
    const toggleBitfeed = document.getElementById('toggle-bitfeed');
    
    if (mode === 'custom') {
        customViz.style.display = 'block';
        bitfeedIframe.style.display = 'none';
        vizHud.style.display = 'block';
        toggleCustom.classList.add('active');
        toggleBitfeed.classList.remove('active');
        
        if (window.visualizer) {
            window.visualizer.start();
        }
    } else {
        customViz.style.display = 'none';
        bitfeedIframe.style.display = 'block';
        vizHud.style.display = 'none';
        toggleCustom.classList.remove('active');
        toggleBitfeed.classList.add('active');
        
        if (window.visualizer) {
            window.visualizer.stop();
        }
    }
}

if (localStorage.getItem('sovereignMode') === 'true') {
    document.body.classList.add('sovereign-active');
}

// ============================================
// INTELLIGENCE DESCENT - Consolidated Data Updates
// ============================================

// Shared cache for mempool data (reduces redundant API calls)
window.mempoolCache = {
    blocks: null,
    fees: null,
    mempool: null,
    difficulty: null,
    lastFetch: 0
};

// Consolidated mempool data fetch (shared by all modules)
async function fetchMempoolData() {
    const now = Date.now();
    // Cache for 10 seconds to avoid redundant calls
    if (now - window.mempoolCache.lastFetch < 10000 && window.mempoolCache.blocks) {
        return window.mempoolCache;
    }
    
    try {
        const [blocksRes, feesRes, mempoolRes, diffRes, heightRes] = await Promise.all([
            fetch('https://mempool.space/api/blocks'),
            fetch('https://mempool.space/api/v1/fees/recommended'),
            fetch('https://mempool.space/api/mempool'),
            fetch('https://mempool.space/api/v1/difficulty-adjustment'),
            fetch('https://mempool.space/api/blocks/tip/height')
        ]);
        
        window.mempoolCache = {
            blocks: await blocksRes.json(),
            fees: await feesRes.json(),
            mempool: await mempoolRes.json(),
            difficulty: await diffRes.json(),
            height: await heightRes.json(),
            lastFetch: now
        };
        
        return window.mempoolCache;
    } catch (e) {
        console.error('Mempool data fetch error:', e);
        return window.mempoolCache;
    }
}

// Master update function for all Intelligence Descent modules
async function updateIntelligenceDescent() {
    const data = await fetchMempoolData();
    if (!data.blocks) return;
    
    // 1. Update Sovereign Health HUD
    updateSovereignHealthFromCache(data);
    
    // 2. Update Protocol Roadmap
    updateProtocolRoadmapFromCache(data);
    
    // 3. Update Energy Proof (estimated data)
    updateEnergyProofEstimates();
    
    // 4. Update Whale Radar (estimated data)
    updateWhaleRadarEstimates();
    
    // 5. Update verdict timestamp
    updateVerdictTimestamp();
}

// Listen for visualizer refresh events to sync heartbeat pulse
window.addEventListener('visualizer-refresh', () => {
    const heartbeatCore = document.querySelector('.heartbeat-core');
    if (heartbeatCore) {
        heartbeatCore.classList.add('synced');
        setTimeout(() => heartbeatCore.classList.remove('synced'), 500);
    }
});

// 1. Sovereign Health HUD (uses cached live data)
function updateSovereignHealthFromCache(data) {
    const blocks = data.blocks;
    const fees = data.fees;
    const heartbeatCore = document.querySelector('.heartbeat-core');
    
    if (blocks && blocks.length > 0) {
        const lastBlockTime = blocks[0].timestamp * 1000;
        const now = Date.now();
        const minSinceBlock = Math.floor((now - lastBlockTime) / 60000);
        const secSinceBlock = Math.floor(((now - lastBlockTime) % 60000) / 1000);
        
        const timeEl = document.getElementById('health-block-time');
        if (timeEl) timeEl.textContent = minSinceBlock + ':' + secSinceBlock.toString().padStart(2, '0');
        
        const statusEl = document.getElementById('health-status');
        
        if (statusEl) {
            if (minSinceBlock < 10) {
                statusEl.textContent = 'On Schedule';
                statusEl.className = 'heartbeat-status normal';
                if (heartbeatCore) heartbeatCore.style.background = 'radial-gradient(circle, #22c55e 0%, #166534 100%)';
            } else if (minSinceBlock < 20) {
                statusEl.textContent = 'Slightly Delayed';
                statusEl.className = 'heartbeat-status delayed';
                if (heartbeatCore) heartbeatCore.style.background = 'radial-gradient(circle, #eab308 0%, #a16207 100%)';
            } else {
                statusEl.textContent = 'Block Overdue';
                statusEl.className = 'heartbeat-status overdue';
                if (heartbeatCore) heartbeatCore.style.background = 'radial-gradient(circle, #dc2626 0%, #991b1b 100%)';
            }
        }
        
        const rings = document.querySelectorAll('.heartbeat-ring');
        const animDuration = minSinceBlock > 15 ? '3s' : '1.5s';
        rings.forEach(r => r.style.animationDuration = animDuration);
    }
    
    if (fees) {
        const economyEl = document.getElementById('fee-economy');
        const standardEl = document.getElementById('fee-standard');
        const priorityEl = document.getElementById('fee-priority');
        const urgentEl = document.getElementById('fee-urgent');
        
        if (economyEl) economyEl.textContent = fees.hourFee;
        if (standardEl) standardEl.textContent = fees.halfHourFee;
        if (priorityEl) priorityEl.textContent = fees.fastestFee;
        if (urgentEl) urgentEl.textContent = Math.ceil(fees.fastestFee * 1.2);
        
        const btcPrice = window.currentBtcPrice || 88000;
        const costSats = fees.fastestFee * 140;
        const costUsd = (costSats / 100000000) * btcPrice;
        const finalityEl = document.getElementById('finality-cost');
        if (finalityEl) finalityEl.textContent = '~$' + costUsd.toFixed(2);
    }
}

// 2. Protocol Roadmap (uses cached live data)
function updateProtocolRoadmapFromCache(data) {
    const diff = data.difficulty;
    const height = data.height;
    
    if (diff && diff.remainingBlocks !== undefined) {
        const diffEl = document.getElementById('countdown-diff-blocks');
        if (diffEl) diffEl.textContent = diff.remainingBlocks.toLocaleString();
    }
    
    if (height) {
        const nextHalving = 1050000;
        const blocksToHalving = nextHalving - height;
        const daysToHalving = Math.round((blocksToHalving * 10) / 1440);
        
        const halvingEl = document.getElementById('countdown-halving-days');
        if (halvingEl) halvingEl.textContent = daysToHalving.toLocaleString();
        
        const epoch = Math.floor(height / 210000) + 1;
        const epochEl = document.getElementById('countdown-epoch');
        if (epochEl) epochEl.textContent = epoch;
    }
}

// 3. Energy Proof (ESTIMATED - Based on Bitcoin Mining Council quarterly reports)
function updateEnergyProofEstimates() {
    // Note: These are estimates based on latest Bitcoin Mining Council data
    // Real-time API would require Cambridge CBECI or Mining Council partnership
    const renewablePct = (52 + Math.random() * 8).toFixed(1);
    const powerGW = (16 + Math.random() * 4).toFixed(1);
    const hydroPct = (20 + Math.random() * 8).toFixed(0);
    
    const renewEl = document.getElementById('energy-renewable');
    const megaEl = document.getElementById('energy-megawatts');
    const hydroEl = document.getElementById('energy-hydro');
    
    if (renewEl) renewEl.textContent = renewablePct + '%';
    if (megaEl) megaEl.textContent = '~' + powerGW + ' GW';
    if (hydroEl) hydroEl.textContent = hydroPct + '%';
    
    const carbonEl = document.getElementById('carbon-avoided');
    if (carbonEl) {
        const currentCarbon = parseInt(carbonEl.textContent.replace(/,/g, '')) || 800000;
        carbonEl.textContent = (currentCarbon + Math.floor(Math.random() * 50)).toLocaleString();
    }
}

// 4. Whale Radar (ESTIMATED - Would require Glassnode/CryptoQuant API)
function updateWhaleRadarEstimates() {
    // Note: Exchange flow data requires premium on-chain analytics API
    // These are estimates for demonstration purposes
    const netFlow = Math.floor(Math.random() * 5000) - 1000;
    const flowEl = document.getElementById('exchange-net-flow');
    const labelEl = document.querySelector('.drain-label');
    
    if (flowEl) {
        if (netFlow > 0) {
            flowEl.textContent = '+' + netFlow.toLocaleString() + ' BTC';
            flowEl.classList.remove('negative');
            if (labelEl) labelEl.textContent = 'Est. Net Outflow (Bullish Signal)';
        } else {
            flowEl.textContent = netFlow.toLocaleString() + ' BTC';
            flowEl.classList.add('negative');
            if (labelEl) labelEl.textContent = 'Est. Net Inflow (Distribution Risk)';
        }
    }
}

// 5. Final Verdict timestamp
function updateVerdictTimestamp() {
    const now = new Date();
    const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        timeZoneName: 'short'
    };
    const el = document.getElementById('verdict-timestamp');
    if (el) el.textContent = 'Updated: ' + now.toLocaleDateString('en-US', options);
}

// Initialize Intelligence Descent with consolidated updates
updateIntelligenceDescent();

// Single unified refresh interval (every 15 seconds)
setInterval(updateIntelligenceDescent, 15000);

// ============================================
// NEW MODULES - JavaScript
// ============================================

// 1. MEMPOOL EXPLAINER TOGGLE
function toggleExplainer() {
    const content = document.getElementById('explainer-content');
    const arrow = document.getElementById('explainer-arrow');
    content.classList.toggle('open');
    arrow.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
}

// 2. EPOCH PROGRESS BAR
async function updateEpochProgress() {
    if (!window.mempoolCache.difficulty || !window.mempoolCache.height) return;
    
    const diff = window.mempoolCache.difficulty;
    const height = window.mempoolCache.height;
    
    const blocksInEpoch = height % 2016;
    const percentage = ((blocksInEpoch / 2016) * 100).toFixed(1);
    const blocksRemaining = 2016 - blocksInEpoch;
    
    const barFill = document.getElementById('epoch-bar-fill');
    const barText = document.getElementById('epoch-bar-text');
    const blockCurrent = document.getElementById('epoch-block-current');
    const blocksRem = document.getElementById('epoch-blocks-remaining');
    const adjustment = document.getElementById('epoch-adjustment');
    const timeRem = document.getElementById('epoch-time-remaining');
    
    if (barFill) barFill.style.width = percentage + '%';
    if (barText) barText.textContent = percentage + '%';
    if (blockCurrent) blockCurrent.textContent = blocksInEpoch.toLocaleString();
    if (blocksRem) blocksRem.textContent = blocksRemaining.toLocaleString();
    
    if (diff.difficultyChange !== undefined && adjustment) {
        const change = diff.difficultyChange.toFixed(2);
        adjustment.textContent = (change >= 0 ? '+' : '') + change + '%';
        adjustment.className = 'epoch-stat-value ' + (change >= 0 ? 'positive' : 'negative');
    }
    
    if (diff.remainingTime !== undefined && timeRem) {
        const days = Math.floor(diff.remainingTime / 86400000);
        const hours = Math.floor((diff.remainingTime % 86400000) / 3600000);
        timeRem.textContent = '~' + days + 'd ' + hours + 'h';
    }
}

// 3. MINING POOL DISTRIBUTION (using mempool.space mining pool data)
async function updateMiningPools() {
    try {
        const res = await fetch('https://mempool.space/api/v1/mining/pools/1w');
        const data = await res.json();
        
        if (data.pools && data.pools.length > 0) {
            const legend = document.getElementById('pool-legend');
            const colors = ['#f7931a', '#dc2626', '#22c55e', '#3b82f6', '#8b5cf6', '#14b8a6', '#eab308', '#ec4899'];
            
            if (!legend) return;
            legend.innerHTML = '';
            
            // Calculate total blocks to derive percentages
            const totalBlocks = data.blockCount || data.pools.reduce((sum, p) => sum + p.blockCount, 0);
            
            // Add share percentage to each pool
            const poolsWithShare = data.pools.slice(0, 6).map(pool => ({
                ...pool,
                share: (pool.blockCount / totalBlocks) * 100
            }));
            
            poolsWithShare.forEach((pool, i) => {
                const item = document.createElement('div');
                item.className = 'pool-legend-item';
                item.innerHTML = `
                    <div class="pool-legend-name">
                        <div class="pool-legend-dot" style="background: ${colors[i]}"></div>
                        <span>${pool.name}</span>
                    </div>
                    <span class="pool-legend-pct">${pool.share.toFixed(1)}%</span>
                `;
                legend.appendChild(item);
                
                // Check for centralization warning
                const warningEl = document.getElementById('pool-warning');
                if (pool.share > 35 && warningEl) {
                    warningEl.style.display = 'block';
                }
            });
            
            // Update total hashrate display
            if (data.lastEstimatedHashrate) {
                const hashrateEl = document.getElementById('pool-total-hashrate');
                if (hashrateEl) {
                    const ehps = data.lastEstimatedHashrate / 1e18;
                    hashrateEl.textContent = ehps.toFixed(0) + ' EH/s';
                }
            }
            
            // Draw simple donut chart
            drawPoolDonut(poolsWithShare, colors);
        }
    } catch (e) {
        console.error('Mining pools update error:', e);
    }
}

function drawPoolDonut(pools, colors) {
    const canvas = document.getElementById('pool-chart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 80;
    const innerRadius = 50;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    let startAngle = -Math.PI / 2;
    pools.forEach((pool, i) => {
        const sliceAngle = (pool.share / 100) * 2 * Math.PI;
        
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
        ctx.arc(centerX, centerY, innerRadius, startAngle + sliceAngle, startAngle, true);
        ctx.closePath();
        ctx.fillStyle = colors[i];
        ctx.fill();
        
        startAngle += sliceAngle;
    });
}

// 4. NODE GLOBE (Three.js) - Enhanced with interactive tooltips
let nodeGlobe = null;
let globeAutoRotate = true;
let nodeDataArray = []; // Store node data for tooltips

// Node data with accurate geographic coordinates for major Bitcoin node concentrations
const nodeRegions = [
    { name: 'Germany', flag: '', city: 'Frankfurt', version: '/Satoshi:25.0.0/', lat: 50.1, lon: 8.7, count: 2847 },
    { name: 'Germany', flag: '', city: 'Berlin', version: '/Satoshi:26.0.0/', lat: 52.5, lon: 13.4, count: 1200 },
    { name: 'Germany', flag: '', city: 'Munich', version: '/Satoshi:25.1.0/', lat: 48.1, lon: 11.6, count: 800 },
    { name: 'United States', flag: '', city: 'San Francisco', version: '/Satoshi:26.0.0/', lat: 37.7, lon: -122.4, count: 2412 },
    { name: 'United States', flag: '', city: 'New York', version: '/Satoshi:25.1.0/', lat: 40.7, lon: -74.0, count: 1850 },
    { name: 'United States', flag: '', city: 'Chicago', version: '/Satoshi:25.0.0/', lat: 41.9, lon: -87.6, count: 950 },
    { name: 'United States', flag: '', city: 'Los Angeles', version: '/Satoshi:26.0.0/', lat: 34.0, lon: -118.2, count: 780 },
    { name: 'United States', flag: '', city: 'Austin', version: '/Satoshi:25.1.0/', lat: 30.3, lon: -97.7, count: 620 },
    { name: 'United Kingdom', flag: '', city: 'London', version: '/Satoshi:24.1.0/', lat: 51.5, lon: -0.1, count: 847 },
    { name: 'France', flag: '', city: 'Paris', version: '/Satoshi:26.0.0/', lat: 48.8, lon: 2.3, count: 982 },
    { name: 'Netherlands', flag: '', city: 'Amsterdam', version: '/Satoshi:25.0.0/', lat: 52.4, lon: 4.9, count: 847 },
    { name: 'Japan', flag: '', city: 'Tokyo', version: '/Satoshi:25.0.0/', lat: 35.7, lon: 139.7, count: 523 },
    { name: 'Singapore', flag: '', city: 'Singapore', version: '/Satoshi:24.0.1/', lat: 1.3, lon: 103.8, count: 312 },
    { name: 'Canada', flag: '', city: 'Toronto', version: '/Satoshi:26.0.0/', lat: 43.7, lon: -79.4, count: 489 },
    { name: 'Australia', flag: '', city: 'Sydney', version: '/Satoshi:25.0.0/', lat: -33.9, lon: 151.2, count: 287 },
];

function initNodeGlobe() {
    const container = document.getElementById('node-globe');
    if (!container || !window.THREE) return;
    
    const width = container.clientWidth;
    const height = container.clientHeight || 400;
    
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
    camera.position.z = 2.8;
    
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(width, height);
    renderer.setClearColor(0x000000, 0);
    container.insertBefore(renderer.domElement, container.firstChild);
    
    // Globe with glow effect
    const globeGeometry = new THREE.SphereGeometry(1, 64, 64);
    const globeMaterial = new THREE.MeshBasicMaterial({
        color: 0x1a3a6e,
        wireframe: true,
        transparent: true,
        opacity: 0.25
    });
    const globe = new THREE.Mesh(globeGeometry, globeMaterial);
    scene.add(globe);
    
    // Add inner glow sphere
    const glowGeometry = new THREE.SphereGeometry(0.98, 32, 32);
    const glowMaterial = new THREE.MeshBasicMaterial({
        color: 0x0a1628,
        transparent: true,
        opacity: 0.8
    });
    const glowSphere = new THREE.Mesh(glowGeometry, glowMaterial);
    scene.add(glowSphere);
    
    // Generate nodes with data
    nodeDataArray = [];
    const nodePositions = [];
    const nodeSizes = [];
    const nodeColors = [];
    
    // Calculate total count for weighted distribution
    const totalNodes = nodeRegions.reduce((sum, r) => sum + r.count, 0);
    
    for (let i = 0; i < 400; i++) {
        let region;
        let lat, lon;
        
        // Weighted selection based on actual node counts per region
        let rand = Math.random() * totalNodes;
        let cumulative = 0;
        for (const r of nodeRegions) {
            cumulative += r.count;
            if (rand <= cumulative) {
                region = r;
                break;
            }
        }
        if (!region) region = nodeRegions[0];
        
        // Wide spread across region for visual symmetry (25-45 degree spread)
        const clusterSpread = 25 + Math.random() * 20;
        lat = region.lat + (Math.random() - 0.5) * clusterSpread;
        lon = region.lon + (Math.random() - 0.5) * clusterSpread;
        
        const phi = (90 - lat) * (Math.PI / 180);
        const theta = (lon + 180) * (Math.PI / 180);
        const r = 1.02;
        
        const x = r * Math.sin(phi) * Math.cos(theta);
        const y = r * Math.cos(phi);
        const z = r * Math.sin(phi) * Math.sin(theta);
        
        nodePositions.push(x, y, z);
        
        // Store node data for tooltips
        const uptimeDays = Math.floor(Math.random() * 1000) + 30;
        const blockHeight = 879000 + Math.floor(Math.random() * 100);
        nodeDataArray.push({
            region: region.name,
            flag: region.flag,
            city: region.city,
            version: region.version,
            uptime: uptimeDays,
            blockHeight: blockHeight,
            connections: Math.floor(Math.random() * 100) + 8,
            position: { x, y, z }
        });
    }
    
    const nodesGeometry = new THREE.BufferGeometry();
    nodesGeometry.setAttribute('position', new THREE.Float32BufferAttribute(nodePositions, 3));
    
    const nodesMaterial = new THREE.PointsMaterial({
        color: 0xf7931a,
        size: 0.025,
        transparent: true,
        opacity: 0.9,
        sizeAttenuation: true
    });
    
    const nodes = new THREE.Points(nodesGeometry, nodesMaterial);
    scene.add(nodes);
    
    // Raycaster for hover detection
    const raycaster = new THREE.Raycaster();
    raycaster.params.Points.threshold = 0.05;
    const mouse = new THREE.Vector2();
    const tooltip = document.getElementById('node-tooltip');
    const tooltipContent = document.getElementById('node-tooltip-content');
    
    // Mouse interaction
    let isDragging = false;
    let previousMousePosition = { x: 0, y: 0 };
    
    renderer.domElement.addEventListener('mousedown', (e) => {
        isDragging = true;
        previousMousePosition = { x: e.clientX, y: e.clientY };
    });
    
    renderer.domElement.addEventListener('mousemove', (e) => {
        const rect = renderer.domElement.getBoundingClientRect();
        mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
        mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
        
        if (isDragging) {
            const deltaX = e.clientX - previousMousePosition.x;
            const deltaY = e.clientY - previousMousePosition.y;
            
            globe.rotation.y += deltaX * 0.005;
            nodes.rotation.y += deltaX * 0.005;
            glowSphere.rotation.y += deltaX * 0.005;
            globe.rotation.x += deltaY * 0.005;
            nodes.rotation.x += deltaY * 0.005;
            glowSphere.rotation.x += deltaY * 0.005;
            
            previousMousePosition = { x: e.clientX, y: e.clientY };
            tooltip.style.display = 'none';
        } else {
            // Hover detection
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(nodes);
            
            if (intersects.length > 0) {
                const idx = intersects[0].index;
                const nodeData = nodeDataArray[idx];
                
                tooltipContent.innerHTML = `
                    <div style="font-size: 1rem; margin-bottom: 8px;">${nodeData.flag} <span style="color: #fff;">${nodeData.city}, ${nodeData.region}</span></div>
                    <div style="font-size: 0.7rem; color: rgba(255,255,255,0.6); margin-bottom: 10px; font-family: 'JetBrains Mono', monospace;">${nodeData.version}</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.75rem;">
                        <div><span style="color: rgba(255,255,255,0.5);">Uptime:</span> <span style="color: #22c55e;">${nodeData.uptime}d</span></div>
                        <div><span style="color: rgba(255,255,255,0.5);">Peers:</span> <span style="color: #f7931a;">${nodeData.connections}</span></div>
                        <div style="grid-column: span 2;"><span style="color: rgba(255,255,255,0.5);">Block:</span> <span style="color: #3b82f6; font-family: 'JetBrains Mono', monospace;">#${nodeData.blockHeight.toLocaleString()}</span></div>
                    </div>
                `;
                
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX - rect.left + 15) + 'px';
                tooltip.style.top = (e.clientY - rect.top - 10) + 'px';
            } else {
                tooltip.style.display = 'none';
            }
        }
    });
    
    renderer.domElement.addEventListener('mouseup', () => isDragging = false);
    renderer.domElement.addEventListener('mouseleave', () => {
        isDragging = false;
        tooltip.style.display = 'none';
    });
    
    // Hide tooltip on scroll to prevent it from floating over other content
    window.addEventListener('scroll', () => {
        tooltip.style.display = 'none';
    }, { passive: true });
    
    // Mouse wheel zoom
    renderer.domElement.addEventListener('wheel', (e) => {
        e.preventDefault();
        camera.position.z += e.deltaY * 0.002;
        camera.position.z = Math.max(1.5, Math.min(5, camera.position.z));
    }, { passive: false });
    
    // Touch support for mobile
    let touchStartDistance = 0;
    let isTouchDragging = false;
    let previousTouchPosition = { x: 0, y: 0 };
    
    renderer.domElement.addEventListener('touchstart', (e) => {
        if (e.touches.length === 1) {
            isTouchDragging = true;
            previousTouchPosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
        } else if (e.touches.length === 2) {
            // Pinch zoom - calculate initial distance
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            touchStartDistance = Math.sqrt(dx * dx + dy * dy);
        }
    }, { passive: true });
    
    renderer.domElement.addEventListener('touchmove', (e) => {
        if (e.touches.length === 1 && isTouchDragging) {
            const deltaX = e.touches[0].clientX - previousTouchPosition.x;
            const deltaY = e.touches[0].clientY - previousTouchPosition.y;
            
            globe.rotation.y += deltaX * 0.008;
            nodes.rotation.y += deltaX * 0.008;
            glowSphere.rotation.y += deltaX * 0.008;
            globe.rotation.x += deltaY * 0.008;
            nodes.rotation.x += deltaY * 0.008;
            glowSphere.rotation.x += deltaY * 0.008;
            
            previousTouchPosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            tooltip.style.display = 'none';
        } else if (e.touches.length === 2) {
            // Pinch zoom
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (touchStartDistance > 0) {
                const delta = touchStartDistance - distance;
                camera.position.z += delta * 0.01;
                camera.position.z = Math.max(1.5, Math.min(5, camera.position.z));
                touchStartDistance = distance;
            }
        }
    }, { passive: true });
    
    renderer.domElement.addEventListener('touchend', () => {
        isTouchDragging = false;
        touchStartDistance = 0;
    }, { passive: true });
    
    // Animation with pulsing nodes
    let time = 0;
    function animate() {
        requestAnimationFrame(animate);
        time += 0.01;
        
        if (globeAutoRotate && !isDragging) {
            globe.rotation.y += 0.001;
            nodes.rotation.y += 0.001;
            glowSphere.rotation.y += 0.001;
        }
        
        // Subtle pulse effect
        nodesMaterial.opacity = 0.7 + Math.sin(time * 2) * 0.2;
        
        renderer.render(scene, camera);
    }
    
    animate();
    
    // Set initial rotation to center on North America (longitude ~-100)
    // Y rotation of ~1.75 radians rotates globe to show North America
    const northAmericaRotation = 1.75;
    globe.rotation.y = northAmericaRotation;
    nodes.rotation.y = northAmericaRotation;
    glowSphere.rotation.y = northAmericaRotation;
    
    nodeGlobe = { globe, nodes, glowSphere, renderer, scene, camera };
}

// Default rotation for North America view
const NORTH_AMERICA_ROTATION = 1.75;

function resetGlobeRotation() {
    if (nodeGlobe) {
        // Reset to North America centered view
        nodeGlobe.globe.rotation.set(0, NORTH_AMERICA_ROTATION, 0);
        nodeGlobe.nodes.rotation.set(0, NORTH_AMERICA_ROTATION, 0);
        if (nodeGlobe.glowSphere) nodeGlobe.glowSphere.rotation.set(0, NORTH_AMERICA_ROTATION, 0);
    }
}

function toggleGlobeAutoRotate() {
    globeAutoRotate = !globeAutoRotate;
}

// Globe zoom controls
const globeZoomLimits = { min: 1.5, max: 5.0, step: 0.3 };
let currentGlobeZoom = 2.8;

function globeZoomIn() {
    if (nodeGlobe && nodeGlobe.camera) {
        currentGlobeZoom = Math.max(globeZoomLimits.min, currentGlobeZoom - globeZoomLimits.step);
        nodeGlobe.camera.position.z = currentGlobeZoom;
        console.log('Globe zoom in:', currentGlobeZoom);
    }
}

function globeZoomOut() {
    if (nodeGlobe && nodeGlobe.camera) {
        currentGlobeZoom = Math.min(globeZoomLimits.max, currentGlobeZoom + globeZoomLimits.step);
        nodeGlobe.camera.position.z = currentGlobeZoom;
        console.log('Globe zoom out:', currentGlobeZoom);
    }
}

// Mobile pinch-to-zoom for Node Globe
function initGlobePinchZoom() {
    const container = document.getElementById('node-globe');
    if (!container) return;
    
    let initialDistance = 0;
    let initialZoom = currentGlobeZoom;
    
    container.addEventListener('touchstart', (e) => {
        if (e.touches.length === 2) {
            e.preventDefault();
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            // Guard against zero distance (identical touch points)
            if (distance > 10) {
                initialDistance = distance;
                // Sync with actual camera position
                if (nodeGlobe && nodeGlobe.camera) {
                    currentGlobeZoom = nodeGlobe.camera.position.z;
                }
                initialZoom = currentGlobeZoom;
            }
        }
    }, { passive: false });
    
    container.addEventListener('touchmove', (e) => {
        if (e.touches.length === 2 && initialDistance > 10) {
            e.preventDefault();
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // Guard against division by zero
            if (distance > 0 && initialDistance > 0) {
                const scale = distance / initialDistance;
                // Invert: pinch in (scale < 1) zooms in (smaller z)
                currentGlobeZoom = Math.min(globeZoomLimits.max, Math.max(globeZoomLimits.min, initialZoom / scale));
                
                if (nodeGlobe && nodeGlobe.camera) {
                    nodeGlobe.camera.position.z = currentGlobeZoom;
                }
            }
        }
    }, { passive: false });
    
    container.addEventListener('touchend', () => {
        initialDistance = 0;
    });
}

// Initialize pinch zoom after globe is initialized
function syncGlobeZoomState() {
    if (nodeGlobe && nodeGlobe.camera) {
        currentGlobeZoom = nodeGlobe.camera.position.z;
    }
    initGlobePinchZoom();
}

// Hook into globe initialization
const originalInitNodeGlobe = window.initNodeGlobe;
if (typeof originalInitNodeGlobe === 'function') {
    window.initNodeGlobe = function() {
        originalInitNodeGlobe();
        syncGlobeZoomState();
    };
} else {
    // Fallback: initialize after delay if direct hook not available
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(syncGlobeZoomState, 2500);
    });
}

// Fetch node count from Bitnodes API
async function updateNodeCount() {
    try {
        const res = await fetch('https://bitnodes.io/api/v1/snapshots/latest/');
        const data = await res.json();
        if (data.total_nodes) {
            document.getElementById('globe-node-count').textContent = data.total_nodes.toLocaleString();
        }
    } catch (e) {
        console.log('Bitnodes API unavailable, using estimate');
    }
}

// 5. SOVEREIGNTY CALCULATOR - Enhanced with full historical data
let btcPriceHistory = [];

// Comprehensive historical BTC prices (monthly averages from 2009 to 2026)
const historicalBtcPrices = {
    // 2009 - Early days (negligible value)
    '2009-01': 0.0008, '2009-06': 0.0008, '2009-12': 0.001,
    // 2010 - First exchanges
    '2010-01': 0.001, '2010-05': 0.005, '2010-07': 0.08, '2010-10': 0.1, '2010-12': 0.25,
    // 2011 - First bubble
    '2011-01': 0.3, '2011-04': 1.0, '2011-06': 15, '2011-08': 10, '2011-12': 4,
    // 2012 - Steady growth
    '2012-01': 5, '2012-06': 6, '2012-11': 12, '2012-12': 13,
    // 2013 - Major rally
    '2013-01': 13, '2013-04': 120, '2013-07': 100, '2013-11': 1000, '2013-12': 800,
    // 2014 - Mt Gox crash
    '2014-01': 800, '2014-02': 550, '2014-06': 600, '2014-12': 320,
    // 2015 - Bear market bottom
    '2015-01': 250, '2015-06': 250, '2015-10': 300, '2015-12': 430,
    // 2016 - Halving rally start
    '2016-01': 430, '2016-06': 550, '2016-07': 650, '2016-12': 950,
    // 2017 - Major bull run
    '2017-01': 1000, '2017-05': 2000, '2017-08': 4000, '2017-11': 8000, '2017-12': 14000,
    // 2018 - Crypto winter
    '2018-01': 13000, '2018-06': 6500, '2018-12': 3800,
    // 2019 - Recovery
    '2019-01': 3600, '2019-06': 11000, '2019-12': 7200,
    // 2020 - COVID and halving
    '2020-01': 7200, '2020-03': 5200, '2020-06': 9400, '2020-10': 13000, '2020-12': 28000,
    // 2021 - ATH run
    '2021-01': 32000, '2021-04': 58000, '2021-05': 38000, '2021-07': 33000, '2021-10': 55000, '2021-11': 67000, '2021-12': 47000,
    // 2022 - Bear market
    '2022-01': 42000, '2022-05': 30000, '2022-06': 20000, '2022-11': 16500, '2022-12': 16800,
    // 2023 - Recovery
    '2023-01': 21000, '2023-03': 28000, '2023-06': 30000, '2023-10': 34000, '2023-12': 42000,
    // 2024 - ETF and halving
    '2024-01': 44000, '2024-03': 70000, '2024-04': 64000, '2024-06': 65000, '2024-09': 60000, '2024-11': 90000, '2024-12': 95000,
    // 2025-2026 - Projection based on current price
    '2025-01': 100000, '2025-06': 102000, '2025-12': 105000, '2026-01': 103000
};

function generateHistoricalPrices() {
    const prices = [];
    const now = new Date();
    const startDate = new Date('2009-01-03');
    
    let current = new Date(startDate);
    let lastKnownPrice = 0.0008;
    
    while (current <= now) {
        const year = current.getFullYear();
        const month = String(current.getMonth() + 1).padStart(2, '0');
        const key = `${year}-${month}`;
        
        // Find closest known price
        if (historicalBtcPrices[key]) {
            lastKnownPrice = historicalBtcPrices[key];
        }
        
        // Add some daily variation
        const variation = 1 + (Math.random() - 0.5) * 0.05;
        prices.push({
            date: new Date(current),
            price: lastKnownPrice * variation
        });
        
        current.setDate(current.getDate() + 1);
    }
    
    return prices;
}

function fetchBtcPriceHistory() {
    btcPriceHistory = generateHistoricalPrices();
    return Promise.resolve();
}

function calculateDCA() {
    const amount = parseFloat(document.getElementById('calc-amount').value) || 50;
    const startDate = new Date(document.getElementById('calc-start-date').value);
    const frequencyEl = document.getElementById('calc-frequency');
    const frequency = frequencyEl ? frequencyEl.value : 'weekly';
    const currentPrice = window.currentBtcPrice || 88000;
    
    if (btcPriceHistory.length === 0) {
        fetchBtcPriceHistory();
    }
    
    // Determine step based on frequency
    let dayStep = 7; // weekly default
    if (frequency === 'daily') dayStep = 1;
    else if (frequency === 'monthly') dayStep = 30;
    
    let totalInvested = 0;
    let totalBtc = 0;
    const chartData = [];
    
    // Filter prices based on frequency
    let lastPurchaseDate = null;
    btcPriceHistory.forEach(entry => {
        if (entry.date >= startDate) {
            // Check if enough days have passed
            if (!lastPurchaseDate || (entry.date - lastPurchaseDate) >= (dayStep * 24 * 60 * 60 * 1000)) {
                totalInvested += amount;
                totalBtc += amount / entry.price;
                lastPurchaseDate = entry.date;
                chartData.push({ date: entry.date, btc: totalBtc, value: totalBtc * entry.price, invested: totalInvested });
            }
        }
    });
    
    const currentValue = totalBtc * currentPrice;
    const gain = totalInvested > 0 ? ((currentValue - totalInvested) / totalInvested * 100).toFixed(1) : 0;
    
    document.getElementById('calc-invested').textContent = '$' + Math.round(totalInvested).toLocaleString();
    document.getElementById('calc-btc').textContent = totalBtc.toFixed(4) + ' BTC';
    document.getElementById('calc-value').textContent = '$' + Math.round(currentValue).toLocaleString();
    
    const gainEl = document.getElementById('calc-gain');
    gainEl.textContent = (gain >= 0 ? '+' : '') + parseFloat(gain).toLocaleString() + '%';
    gainEl.style.color = gain >= 0 ? '#22c55e' : '#dc2626';
    
    drawStackChart(chartData);
}

function drawStackChart(data) {
    const canvas = document.getElementById('stack-chart');
    if (!canvas || data.length === 0) return;
    
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.parentElement.clientWidth;
    canvas.height = 150;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const maxValue = Math.max(...data.map(d => d.value));
    const padding = 10;
    const chartWidth = canvas.width - padding * 2;
    const chartHeight = canvas.height - padding * 2;
    
    ctx.strokeStyle = '#f7931a';
    ctx.lineWidth = 2;
    ctx.beginPath();
    
    data.forEach((d, i) => {
        const x = padding + (i / (data.length - 1)) * chartWidth;
        const y = canvas.height - padding - (d.value / maxValue) * chartHeight;
        
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    
    ctx.stroke();
    
    // Fill gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, 'rgba(247, 147, 26, 0.3)');
    gradient.addColorStop(1, 'rgba(247, 147, 26, 0)');
    
    ctx.lineTo(padding + chartWidth, canvas.height - padding);
    ctx.lineTo(padding, canvas.height - padding);
    ctx.closePath();
    ctx.fillStyle = gradient;
    ctx.fill();
}

function setCalcPreset(preset, e) {
    const dateInput = document.getElementById('calc-start-date');
    const presets = {
        'inception': '2009-01-03',
        'halving': '2024-04-20',
        '2020': '2020-01-01',
        'ath': '2021-11-10',
        'year': new Date(Date.now() - 365*24*60*60*1000).toISOString().split('T')[0]
    };
    dateInput.value = presets[preset];
    calculateDCA();
    
    document.querySelectorAll('.calc-preset-btn').forEach(btn => btn.classList.remove('active'));
    if (e && e.target) e.target.classList.add('active');
}

// Grid version of calculator for Intel Grid
let gridCalcStartDate = '2021-01-01';

function setCalcPresetGrid(preset, e) {
    const presets = {
        'inception': '2009-01-03',
        'halving': '2024-04-20',
        '2020': '2020-01-01',
        'ath': '2021-11-10',
        'year': new Date(Date.now() - 365*24*60*60*1000).toISOString().split('T')[0]
    };
    gridCalcStartDate = presets[preset];
    
    // Update date input if exists
    const dateInput = document.getElementById('calc-start-date-grid');
    if (dateInput) dateInput.value = gridCalcStartDate;
    
    calculateDCAGrid();
    
    // Update active button styling
    const btns = e?.target?.parentElement?.querySelectorAll('button');
    if (btns) {
        btns.forEach(btn => {
            btn.style.background = 'rgba(34, 197, 94, 0.1)';
            btn.style.borderColor = 'rgba(34, 197, 94, 0.3)';
            btn.style.color = '#22c55e';
        });
        if (e?.target) {
            e.target.style.background = 'rgba(247, 147, 26, 0.2)';
            e.target.style.borderColor = 'rgba(247, 147, 26, 0.4)';
            e.target.style.color = '#f7931a';
        }
    }
}

function calculateDCAGrid() {
    const amountEl = document.getElementById('calc-amount-grid');
    const frequencyEl = document.getElementById('calc-frequency-grid');
    const dateInput = document.getElementById('calc-start-date-grid');
    
    const amount = parseFloat(amountEl?.value) || 50;
    const frequency = frequencyEl?.value || 'weekly';
    const startDate = new Date(dateInput?.value || gridCalcStartDate);
    const currentPrice = window.currentBtcPrice || 103000;
    
    if (btcPriceHistory.length === 0) {
        fetchBtcPriceHistory();
    }
    
    let dayStep = 7;
    if (frequency === 'daily') dayStep = 1;
    else if (frequency === 'monthly') dayStep = 30;
    
    let totalInvested = 0;
    let totalBtc = 0;
    const chartData = [];
    
    let lastPurchaseDate = null;
    btcPriceHistory.forEach(entry => {
        if (entry.date >= startDate) {
            if (!lastPurchaseDate || (entry.date - lastPurchaseDate) >= (dayStep * 24 * 60 * 60 * 1000)) {
                totalInvested += amount;
                totalBtc += amount / entry.price;
                lastPurchaseDate = entry.date;
                chartData.push({ date: entry.date, btc: totalBtc, value: totalBtc * entry.price, invested: totalInvested });
            }
        }
    });
    
    const currentValue = totalBtc * currentPrice;
    const gain = totalInvested > 0 ? ((currentValue - totalInvested) / totalInvested * 100).toFixed(1) : 0;
    
    // Update grid display
    const investedEl = document.getElementById('calc-invested-grid');
    const btcEl = document.getElementById('calc-btc-grid');
    const valueEl = document.getElementById('calc-value-grid');
    const gainEl = document.getElementById('calc-gain-grid');
    const gainMiniEl = document.getElementById('calc-gain-mini');
    
    if (investedEl) investedEl.textContent = '$' + Math.round(totalInvested).toLocaleString();
    if (btcEl) btcEl.textContent = totalBtc.toFixed(4) + ' BTC';
    if (valueEl) valueEl.textContent = '$' + Math.round(currentValue).toLocaleString();
    if (gainEl) {
        gainEl.textContent = (gain >= 0 ? '+' : '') + parseFloat(gain).toLocaleString() + '%';
        gainEl.style.color = gain >= 0 ? '#22c55e' : '#dc2626';
    }
    if (gainMiniEl) {
        gainMiniEl.textContent = (gain >= 0 ? '+' : '') + Math.round(gain) + '%';
    }
    
    // Draw chart in grid
    drawStackChartGrid(chartData);
}

function drawStackChartGrid(data) {
    const canvas = document.getElementById('stack-chart-grid');
    if (!canvas || data.length === 0) return;
    
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.parentElement.clientWidth - 20;
    canvas.height = 120;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const maxValue = Math.max(...data.map(d => d.value));
    const padding = 10;
    const chartWidth = canvas.width - padding * 2;
    const chartHeight = canvas.height - padding * 2;
    
    ctx.strokeStyle = '#f7931a';
    ctx.lineWidth = 2;
    ctx.beginPath();
    
    data.forEach((d, i) => {
        const x = padding + (i / (data.length - 1)) * chartWidth;
        const y = canvas.height - padding - (d.value / maxValue) * chartHeight;
        
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    
    ctx.stroke();
    
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, 'rgba(247, 147, 26, 0.3)');
    gradient.addColorStop(1, 'rgba(247, 147, 26, 0)');
    
    ctx.lineTo(padding + chartWidth, canvas.height - padding);
    ctx.lineTo(padding, canvas.height - padding);
    ctx.closePath();
    ctx.fillStyle = gradient;
    ctx.fill();
}

// Initialize grid calculator on page load
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        if (btcPriceHistory.length === 0) fetchBtcPriceHistory();
        calculateDCAGrid();
    }, 500);
});

// 6. LIGHTNING PULSE
async function updateLightningPulse() {
    try {
        const res = await fetch('https://mempool.space/api/v1/lightning/statistics/latest');
        const data = await res.json();
        
        if (data.latest) {
            const ln = data.latest;
            const capacity = (ln.total_capacity / 100000000).toLocaleString();
            document.getElementById('ln-capacity').textContent = capacity + ' BTC';
            document.getElementById('ln-nodes').textContent = ln.node_count.toLocaleString();
            document.getElementById('ln-channels').textContent = ln.channel_count.toLocaleString();
        }
    } catch (e) {
        console.error('Lightning update error:', e);
    }
}

// AD BANNER ROTATION
function initAdRotation() {
    // Globe ads rotation
    const globeSlot1 = document.getElementById('globe-ad-slot-1');
    const globeSlot2 = document.getElementById('globe-ad-slot-2');
    
    if (globeSlot1 && globeSlot2) {
        let showingGlobeSlot1 = true;
        setInterval(() => {
            if (showingGlobeSlot1) {
                globeSlot1.style.display = 'none';
                globeSlot2.style.display = 'block';
            } else {
                globeSlot2.style.display = 'none';
                globeSlot1.style.display = 'block';
            }
            showingGlobeSlot1 = !showingGlobeSlot1;
        }, 10000);
    }
}

// ARCHIVE FOLDER TOGGLE (Zone 3)
function toggleArchiveFolder(folder) {
    folder.classList.toggle('collapsed');
}

// DYNAMIC GLOW UPDATE based on fee rates
function updateDynamicGlows() {
    const nextBlockFee = window.mempoolCache?.fees?.fastestFee || 0;
    const panels = document.querySelectorAll('.instrument-panel');
    
    panels.forEach(panel => {
        panel.classList.remove('fee-low', 'fee-medium', 'fee-high');
        
        if (nextBlockFee < 10) {
            panel.classList.add('fee-low');
        } else if (nextBlockFee < 50) {
            panel.classList.add('fee-medium');
        } else {
            panel.classList.add('fee-high');
        }
    });
}

// Call dynamic glow update every 30 seconds
setInterval(updateDynamicGlows, 30000);
setTimeout(updateDynamicGlows, 5000);

// 7. TIMECHAIN CLOCK - Enhanced
function updateTimechainClock() {
    if (!window.mempoolCache.blocks || !window.mempoolCache.height) return;
    
    const height = window.mempoolCache.height;
    const blocks = window.mempoolCache.blocks;
    
    // Update digital display
    const blockHeightEl = document.getElementById('clock-block-height');
    if (blockHeightEl) blockHeightEl.textContent = height.toLocaleString();
    
    // Calculate epoch progress
    const blocksInEpoch = height % 210000;
    const epochProgressPct = ((blocksInEpoch / 210000) * 100).toFixed(1);
    
    const epochProgressEl = document.getElementById('epoch-progress-pct');
    const epochProgressBar = document.getElementById('block-epoch-progress');
    const epochMarker = document.getElementById('epoch-marker');
    
    if (epochProgressEl) epochProgressEl.textContent = epochProgressPct;
    if (epochProgressBar) epochProgressBar.style.width = epochProgressPct + '%';
    if (epochMarker) epochMarker.style.left = epochProgressPct + '%';
    
    if (blocks.length > 0) {
        const lastBlockTime = blocks[0].timestamp * 1000;
        const now = Date.now();
        const totalMinSince = (now - lastBlockTime) / 60000;
        const minSince = Math.floor(totalMinSince);
        const secSince = Math.floor(((now - lastBlockTime) % 60000) / 1000);
        
        // Update time since block display
        const sinceBlockEl = document.getElementById('clock-since-block');
        if (sinceBlockEl) sinceBlockEl.textContent = minSince + ':' + secSince.toString().padStart(2, '0');
        
        // Variance Alert for Network Heartbeat (>20 minutes)
        const varianceAlert = document.getElementById('variance-alert');
        const healthStatus = document.getElementById('health-status');
        const clockFace = document.querySelector('.clock-face-enhanced');
        
        if (varianceAlert && healthStatus) {
            if (minSince >= 20) {
                varianceAlert.style.display = 'block';
                healthStatus.textContent = 'High Variance';
                healthStatus.className = 'heartbeat-status delayed';
                healthStatus.style.background = 'rgba(250, 204, 21, 0.2)';
                healthStatus.style.borderColor = 'rgba(250, 204, 21, 0.5)';
                healthStatus.style.color = '#facc15';
                // Holographic clock - critical state
                if (clockFace) {
                    clockFace.classList.remove('variance-warning');
                    clockFace.classList.add('variance-critical');
                }
            } else if (minSince >= 15) {
                varianceAlert.style.display = 'none';
                healthStatus.textContent = 'Slightly Delayed';
                healthStatus.className = 'heartbeat-status delayed';
                healthStatus.style.background = 'rgba(250, 204, 21, 0.2)';
                healthStatus.style.borderColor = 'rgba(250, 204, 21, 0.5)';
                healthStatus.style.color = '#facc15';
                // Holographic clock - warning state
                if (clockFace) {
                    clockFace.classList.remove('variance-critical');
                    clockFace.classList.add('variance-warning');
                }
            } else {
                varianceAlert.style.display = 'none';
                healthStatus.textContent = 'On Schedule';
                healthStatus.className = 'heartbeat-status normal';
                healthStatus.style.background = 'rgba(34, 197, 94, 0.2)';
                healthStatus.style.borderColor = 'rgba(34, 197, 94, 0.5)';
                healthStatus.style.color = '#22c55e';
                // Holographic clock - normal state
                if (clockFace) {
                    clockFace.classList.remove('variance-warning', 'variance-critical');
                }
            }
        }
        
        // Update clock hands
        const blockHand = document.getElementById('clock-block-hand');
        const minuteHand = document.getElementById('clock-minute-hand');
        const epochHand = document.getElementById('clock-epoch-hand');
        
        // Block hand rotates based on blocks in current halving epoch
        const blockAngle = (blocksInEpoch / 210000) * 360;
        if (blockHand) blockHand.style.transform = `rotate(${blockAngle}deg)`;
        
        // Minute hand rotates based on time since last block (full rotation = 60 min)
        const minuteAngle = Math.min(minSince, 60) * 6;
        if (minuteHand) minuteHand.style.transform = `rotate(${minuteAngle}deg)`;
        
        // Epoch hand shows which halving we're in (epoch 4 = 2024-2028)
        const currentEpoch = Math.floor(height / 210000);
        const epochAngle = ((currentEpoch - 3) / 4) * 360; // Starting from epoch 4 (2024)
        if (epochHand) epochHand.style.transform = `rotate(${epochAngle}deg)`;
    }
    
    // Halving countdown
    const nextHalving = 1050000;
    const blocksToHalving = nextHalving - height;
    const halvingBlocksEl = document.getElementById('clock-halving-blocks');
    if (halvingBlocksEl) halvingBlocksEl.textContent = blocksToHalving.toLocaleString();
    
    // Estimate halving date (roughly 10 min per block)
    const daysToHalving = Math.floor((blocksToHalving * 10) / 1440);
    const halvingDate = new Date();
    halvingDate.setDate(halvingDate.getDate() + daysToHalving);
    const halvingYear = halvingDate.getFullYear();
    const halvingMonth = halvingDate.toLocaleString('default', { month: 'short' });
    const halvingEtaEl = document.getElementById('halving-eta');
    if (halvingEtaEl) halvingEtaEl.textContent = `${halvingMonth} ${halvingYear}`;
}

// 8. BITCOIN HEARTBEAT AUDIO
let heartbeatEnabled = false;

async function toggleHeartbeatAudio() {
    heartbeatEnabled = !heartbeatEnabled;
    
    // Get all audio toggle buttons and indicators
    const btns = document.querySelectorAll('.audio-toggle-btn');
    const icons = document.querySelectorAll('#audio-icon');
    const statusText = document.getElementById('audio-status-text');
    const label = document.getElementById('audio-label');
    const heartbeatIndicator = document.getElementById('heartbeat-indicator');
    
    if (heartbeatEnabled) {
        // Enable PulseAudioEngine with Bitcoin Heartbeat
        if (window.pulseAudio) {
            await window.pulseAudio.enable(1);
            console.log('Bitcoin Heartbeat audio started');
        }
        btns.forEach(btn => btn.classList.add('active'));
        icons.forEach(icon => icon.className = 'fas fa-heartbeat');
        if (statusText) statusText.textContent = 'Bitcoin Heartbeat Active';
        if (label) label.textContent = 'Pulse Active';
        if (heartbeatIndicator) heartbeatIndicator.classList.add('active');
        animateAudioBars();
    } else {
        // Disable PulseAudioEngine
        if (window.pulseAudio) {
            window.pulseAudio.disable();
            console.log('Bitcoin Heartbeat audio stopped');
        }
        btns.forEach(btn => btn.classList.remove('active'));
        icons.forEach(icon => icon.className = 'fas fa-heartbeat');
        if (statusText) statusText.textContent = 'Audio Off';
        if (label) label.textContent = 'Tap to Enable';
        if (heartbeatIndicator) heartbeatIndicator.classList.remove('active');
    }
}

function playBlockThud() {
    if (!heartbeatEnabled || !audioContext) return;
    
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(60, audioContext.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(30, audioContext.currentTime + 0.3);
    
    gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.5);
}

function playWhaleChime() {
    if (!heartbeatEnabled || !audioContext) return;
    
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.type = 'triangle';
    oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.5);
    
    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.8);
}

function animateAudioBars() {
    if (!heartbeatEnabled) return;
    
    const bars = document.querySelectorAll('#audio-visualizer .audio-bar');
    bars.forEach(bar => {
        bar.style.height = (10 + Math.random() * 30) + 'px';
    });
    
    setTimeout(animateAudioBars, 100);
}

// 9. GENESIS BLOCK EXPAND
function toggleGenesisExpand() {
    const expanded = document.getElementById('genesis-expanded');
    const btn = document.querySelector('.genesis-expand-btn i');
    
    if (expanded.style.display === 'none') {
        expanded.style.display = 'block';
        btn.className = 'fas fa-minus me-1';
    } else {
        expanded.style.display = 'none';
        btn.className = 'fas fa-plus me-1';
    }
}

// 10. CTA FUNCTIONS
function subscribeEmail(event) {
    event.preventDefault();
    const email = event.target.querySelector('input').value;
    alert('Thank you for subscribing! You\'ll receive the Daily Pulse at 6am EST.');
    event.target.reset();
}

function showLightningTip() {
    // Would integrate with Lightning tip jar
    alert('Lightning tip jar coming soon! ');
}

// Initialize new modules - Wait for DOM and Three.js
function initializeNewModules() {
    // Only proceed if DOM is ready and cache is available
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeNewModules);
        return;
    }
    
    // Init Node Globe (requires Three.js)
    if (typeof THREE !== 'undefined') {
        try { initNodeGlobe(); } catch (e) { console.log('Globe init error:', e); }
    } else {
        console.log('Three.js not loaded for globe');
    }
    
    updateNodeCount();
    fetchBtcPriceHistory().then(() => calculateDCA()).catch(e => console.log('DCA calc error:', e));
    updateMiningPools().catch(e => console.log('Mining pools error:', e));
    updateLightningPulse().catch(e => console.log('Lightning error:', e));
    updateEpochProgress();
    updateTimechainClock();
    initAdRotation();
    
    // Generate 60 precision tick marks for Holographic Horizon clock
    const tickContainer = document.querySelector('.clock-tick-marks');
    if (tickContainer && tickContainer.querySelectorAll('.tick-mark').length === 0) {
        for (let i = 0; i < 60; i++) {
            const tick = document.createElement('div');
            tick.className = 'tick-mark';
            const isMajor = i % 5 === 0;
            const angle = i * 6; // 360/60 = 6 degrees per tick
            
            // Position ticks on inner rim
            const tickLength = isMajor ? 12 : 6;
            const tickWidth = isMajor ? 3 : 1;
            const radius = 140; // Distance from center
            
            tick.style.cssText = `
                position: absolute;
                width: ${tickWidth}px;
                height: ${tickLength}px;
                background: ${isMajor ? '#f7931a' : 'rgba(255,255,255,0.3)'};
                left: 50%;
                top: 10px;
                margin-left: -${tickWidth/2}px;
                transform-origin: 50% ${radius}px;
                transform: rotate(${angle}deg);
                border-radius: ${isMajor ? '2px' : '1px'};
                ${isMajor ? 'box-shadow: 0 0 8px rgba(247, 147, 26, 0.6);' : ''}
            `;
            tickContainer.appendChild(tick);
        }
    }
}

// Wait for initial data cache before initializing modules that depend on it
setTimeout(initializeNewModules, 1500);

// Calculate days since Genesis Block
function updateGenesisDaysCount() {
    const genesis = new Date('2009-01-03');
    const now = new Date();
    const days = Math.floor((now - genesis) / (1000 * 60 * 60 * 24));
    const el = document.getElementById('genesis-days-count');
    if (el) el.textContent = days.toLocaleString();
}
updateGenesisDaysCount();

// Initialize purchasing power chart
let purchasingPowerChartDrawn = false;
function drawPurchasingPowerChart() {
    if (purchasingPowerChartDrawn) return; // Only draw once
    const canvas = document.getElementById('purchasing-power-chart');
    if (!canvas) return;
    
    purchasingPowerChartDrawn = true;
    const ctx = canvas.getContext('2d');
    const containerWidth = canvas.parentElement?.getBoundingClientRect().width || 400;
    canvas.width = Math.min(containerWidth - 50, 600);
    canvas.height = 200;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // USD purchasing power decline data (1913-2026, normalized to 1.00 in 1913)
    const usdData = [
        { year: 1913, value: 1.00 },
        { year: 1920, value: 0.50 },
        { year: 1930, value: 0.58 },
        { year: 1940, value: 0.70 },
        { year: 1950, value: 0.42 },
        { year: 1960, value: 0.35 },
        { year: 1970, value: 0.27 },
        { year: 1980, value: 0.13 },
        { year: 1990, value: 0.08 },
        { year: 2000, value: 0.06 },
        { year: 2010, value: 0.045 },
        { year: 2020, value: 0.035 },
        { year: 2026, value: 0.03 }
    ];
    
    const padding = { left: 40, right: 20, top: 20, bottom: 30 };
    const chartWidth = canvas.width - padding.left - padding.right;
    const chartHeight = canvas.height - padding.top - padding.bottom;
    
    // Draw grid lines
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
    ctx.lineWidth = 1;
    for (let i = 0; i <= 5; i++) {
        const y = padding.top + (chartHeight / 5) * i;
        ctx.beginPath();
        ctx.moveTo(padding.left, y);
        ctx.lineTo(canvas.width - padding.right, y);
        ctx.stroke();
    }
    
    // Draw Y-axis labels
    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
    ctx.font = '10px JetBrains Mono, monospace';
    ctx.textAlign = 'right';
    ['$1.00', '$0.80', '$0.60', '$0.40', '$0.20', '$0.00'].forEach((label, i) => {
        const y = padding.top + (chartHeight / 5) * i + 4;
        ctx.fillText(label, padding.left - 5, y);
    });
    
    // Draw X-axis labels
    ctx.textAlign = 'center';
    ['1920', '1950', '1980', '2000', '2026'].forEach((label, i) => {
        const x = padding.left + (chartWidth / 4) * i;
        ctx.fillText(label, x, canvas.height - 5);
    });
    
    // Draw USD decline line
    ctx.strokeStyle = '#dc2626';
    ctx.lineWidth = 2;
    ctx.beginPath();
    usdData.forEach((point, i) => {
        const x = padding.left + ((point.year - 1913) / (2026 - 1913)) * chartWidth;
        const y = padding.top + (1 - point.value) * chartHeight;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    });
    ctx.stroke();
    
    // Fill under USD line
    ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);
    ctx.lineTo(padding.left, padding.top + chartHeight);
    ctx.closePath();
    const gradient = ctx.createLinearGradient(0, padding.top, 0, canvas.height - padding.bottom);
    gradient.addColorStop(0, 'rgba(220, 38, 38, 0.3)');
    gradient.addColorStop(1, 'rgba(220, 38, 38, 0)');
    ctx.fillStyle = gradient;
    ctx.fill();
    
    // Bitcoin line (2009 onwards, inverted - showing appreciation)
    const btcStartX = padding.left + ((2009 - 1913) / (2026 - 1913)) * chartWidth;
    ctx.strokeStyle = '#f7931a';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(btcStartX, padding.top + chartHeight - 5);
    ctx.lineTo(padding.left + chartWidth, padding.top + 10);
    ctx.stroke();
}

// Update State of the Pulse with live data
// Fetch live BTC price from mempool.space API
async function fetchLiveBtcPrice() {
    try {
        const res = await fetch('https://mempool.space/api/v1/prices');
        const data = await res.json();
        if (data && data.USD) {
            window.currentBtcPrice = data.USD;
            console.log('Live BTC Price:', data.USD);
            updatePulseState();
            return data.USD;
        }
    } catch (e) {
        console.log('Price fetch error, using cached:', e);
    }
    return window.currentBtcPrice || 88000;
}

// Fetch price immediately and every 30 seconds
fetchLiveBtcPrice();
setInterval(fetchLiveBtcPrice, 30000);

function updatePulseState() {
    const price = window.currentBtcPrice || 88000;
    const priceEl = document.getElementById('pulse-price');
    if (priceEl) priceEl.textContent = '$' + Math.round(price).toLocaleString();
    
    // Update home price in BTC
    const homeUsdEl = document.getElementById('pp-home-usd');
    const homeBtcEl = document.getElementById('pp-home-btc');
    if (homeBtcEl && price > 0) {
        const homePrice = 434700;
        homeBtcEl.textContent = (homePrice / price).toFixed(1) + ' BTC';
    }
    
    // Update timestamp
    const timestampEl = document.getElementById('pulse-update-time');
    if (timestampEl) {
        const now = new Date();
        timestampEl.textContent = now.toLocaleDateString('en-US', { 
            month: 'long', day: 'numeric', year: 'numeric' 
        }) + ' at ' + now.toLocaleTimeString('en-US', { 
            hour: 'numeric', minute: '2-digit', hour12: true, timeZoneName: 'short' 
        });
    }
}

// Initialize new visualizations
setTimeout(() => {
    drawPurchasingPowerChart();
    updatePulseState();
    fetchBtcPriceHistory();
    calculateDCA();
}, 2000);

// Refresh new modules every 60 seconds
setInterval(() => {
    updateMiningPools();
    updateLightningPulse();
    updateEpochProgress();
    updateTimechainClock();
    updatePulseState();
}, 60000);

// Calculator input listeners
document.getElementById('calc-amount')?.addEventListener('change', calculateDCA);
document.getElementById('calc-start-date')?.addEventListener('change', calculateDCA);

// ===============================
// PROTOCOL PULSE AUDIO ENGINE
// Tier 0: Off (default)
// Tier 1: Ambient bed loop (Bitcoin Heartbeat)
// Events: tx tick, whale sub, block impact
// ===============================

class PulseAudioEngine {
  constructor(opts = {}) {
    this.enabled = false;
    this.tier = 0;
    this.useFallback = false; // Use simple HTML5 audio fallback for mobile

    this.bedUrl = opts.bedUrl || "/static/audio/pulse-bed.mp3";
    
    // Volumes (tune to taste)
    this.vol = {
      master: 0.9,
      bed: 0.25,     // Bitcoin Heartbeat ambient volume
    };

    this._initDeferred();
    
    // Detect if we should use fallback (mobile devices often have issues with WebAudio + MediaElement)
    this.useFallback = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  }

  _initDeferred() {
    this.audioCtx = null;
    this.masterGain = null;
    this.bedEl = null;
    this.bedSource = null;
  }

  async enable(tier = 1) {
    this.tier = tier;

    // Tier 0: stop everything
    if (tier === 0) {
      this.disable();
      return;
    }

    // For mobile, use simple HTML5 audio without WebAudio routing
    if (this.useFallback) {
      this.enabled = true;
      this._startBedFallback();
      return;
    }

    // Must be called from a user gesture (click/tap)
    if (!this.audioCtx) {
      try {
        this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        this.masterGain = this.audioCtx.createGain();
        this.masterGain.gain.value = this.vol.master;
        this.masterGain.connect(this.audioCtx.destination);
      } catch (e) {
        console.log('WebAudio not supported, using fallback');
        this.useFallback = true;
        this.enabled = true;
        this._startBedFallback();
        return;
      }
    }

    if (this.audioCtx.state === "suspended") {
      try {
        await this.audioCtx.resume();
      } catch (e) {
        console.log('AudioContext resume failed, using fallback');
        this.useFallback = true;
        this.enabled = true;
        this._startBedFallback();
        return;
      }
    }

    // Tier 1: start bed
    this.enabled = true;
    this._startBed();
  }

  disable() {
    this.enabled = false;
    this.tier = 0;
    this._stopBed();
  }

  setMasterVolume(v) {
    this.vol.master = Math.max(0, Math.min(1, v));
    if (this.masterGain) this.masterGain.gain.value = this.vol.master;
    if (this.useFallback && this.bedEl) {
      this.bedEl.volume = this.vol.bed * this.vol.master;
    }
  }

  setBedVolume(v) {
    this.vol.bed = Math.max(0, Math.min(1, v));
    if (this.bedGain) this.bedGain.gain.value = this.vol.bed;
    if (this.useFallback && this.bedEl) {
      this.bedEl.volume = this.vol.bed * this.vol.master;
    }
  }

  // Simple HTML5 audio fallback for mobile
  _startBedFallback() {
    if (!this.enabled) return;
    if (this.bedEl) return; // already running

    this.bedEl = new Audio(this.bedUrl);
    this.bedEl.loop = true;
    this.bedEl.volume = this.vol.bed * this.vol.master;
    this.bedEl.preload = "auto";
    
    // Mobile-friendly: muted attribute then unmute after play starts
    const playPromise = this.bedEl.play();
    
    if (playPromise !== undefined) {
      playPromise.then(() => {
        console.log('Bitcoin Heartbeat audio playing (fallback mode)');
      }).catch((e) => {
        console.log('Audio play error, retrying...', e);
        // Try again with user interaction simulation
        setTimeout(() => {
          this.bedEl.play().catch(err => console.log('Audio still blocked:', err));
        }, 100);
      });
    }
  }

  _startBed() {
    if (!this.enabled) return;
    if (this.bedEl) return; // already running

    // Use <audio> element routed into WebAudio for easy looping and stable playback
    this.bedEl = new Audio(this.bedUrl);
    this.bedEl.loop = true;
    this.bedEl.preload = "auto";
    
    // Don't use crossOrigin for same-origin resources to avoid CORS issues
    // this.bedEl.crossOrigin = "anonymous";

    try {
      this.bedSource = this.audioCtx.createMediaElementSource(this.bedEl);
      this.bedGain = this.audioCtx.createGain();
      this.bedGain.gain.value = this.vol.bed;

      // Optional: gentle lowpass so hiss never gets harsh
      this.bedFilter = this.audioCtx.createBiquadFilter();
      this.bedFilter.type = "lowpass";
      this.bedFilter.frequency.value = 12000;
      this.bedFilter.Q.value = 0.4;

      this.bedSource.connect(this.bedFilter);
      this.bedFilter.connect(this.bedGain);
      this.bedGain.connect(this.masterGain);

      this.bedEl.play().catch((e) => {
        console.log('Audio play blocked, trying fallback:', e);
        this._stopBed();
        this.useFallback = true;
        this._startBedFallback();
      });
    } catch (e) {
      console.log('WebAudio connection failed, using fallback:', e);
      this._stopBed();
      this.useFallback = true;
      this._startBedFallback();
    }
  }

  _stopBed() {
    try {
      if (this.bedEl) {
        this.bedEl.pause();
        this.bedEl.src = "";
        this.bedEl = null;
      }
      if (this.bedSource) this.bedSource.disconnect();
      if (this.bedGain) this.bedGain.disconnect();
      if (this.bedFilter) this.bedFilter.disconnect();
    } catch (e) {}
    this.bedSource = null;
    this.bedGain = null;
    this.bedFilter = null;
  }
}

// Create global instance
window.pulseAudio = new PulseAudioEngine({
  bedUrl: "/static/audio/pulse-bed.mp3"
});

// Bind to UI toggle buttons - use the unified toggleHeartbeatAudio function
document.addEventListener("DOMContentLoaded", () => {
  // Bind all audio toggle buttons to use the unified function
  const btns = document.querySelectorAll('.audio-toggle-btn');
  btns.forEach(btn => {
    // Remove inline onclick if present, use our handler
    btn.removeAttribute('onclick');
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      await toggleHeartbeatAudio();
    });
  });
  console.log("Sovereign Audio Link Established");
});

// ===============================
// MINING INTEL COMPREHENSIVE DATA
// Real-time mining metrics from mempool.space
// ===============================

async function updateMiningIntelData() {
    try {
        // Fetch mining data from mempool.space
        const [hashrateRes, diffRes, blocksRes, poolsRes] = await Promise.all([
            fetch('https://mempool.space/api/v1/mining/hashrate/1w').catch(() => null),
            fetch('https://mempool.space/api/v1/mining/difficulty-adjustments/1').catch(() => null),
            fetch('https://mempool.space/api/blocks/tip/height').catch(() => null),
            fetch('https://mempool.space/api/v1/mining/pools/24h').catch(() => null)
        ]);
        
        // Get current BTC price for economics calculations
        const btcPrice = window.currentBtcPrice || 100000;
        
        // Process hashrate data
        if (hashrateRes && hashrateRes.ok) {
            const hashrateData = await hashrateRes.json();
            if (hashrateData.hashrates && hashrateData.hashrates.length > 0) {
                const latestHashrate = hashrateData.hashrates[hashrateData.hashrates.length - 1];
                const hashEH = (latestHashrate.avgHashrate / 1e18).toFixed(0);
                
                // Update UI
                const hashrateEl = document.getElementById('mining-hashrate');
                const hashrateMini = document.getElementById('hashrate-mini');
                if (hashrateEl) hashrateEl.textContent = `${hashEH} EH/s`;
                if (hashrateMini) hashrateMini.textContent = hashEH;
                
                // Calculate 24h change if we have historical data
                if (hashrateData.hashrates.length > 1) {
                    const prevHashrate = hashrateData.hashrates[0].avgHashrate;
                    const change = ((latestHashrate.avgHashrate - prevHashrate) / prevHashrate * 100).toFixed(1);
                    const changeEl = document.getElementById('mining-hashrate-change');
                    if (changeEl) {
                        changeEl.textContent = `${change >= 0 ? '+' : ''}${change}% 7d`;
                        changeEl.style.color = change >= 0 ? '#22c55e' : '#dc2626';
                    }
                }
                
                // Calculate economics based on hashrate
                const hashrateTH = latestHashrate.avgHashrate / 1e12;
                
                // Hash price: revenue per PH/day = (blocks per day * block reward * price) / (hashrate in PH)
                const blocksPerDay = 144;
                const blockReward = 3.125;
                const dailyRevenue = blocksPerDay * blockReward * btcPrice;
                const hashratePH = hashrateTH / 1000;
                const hashPrice = (dailyRevenue / hashratePH).toFixed(2);
                const hashPriceEl = document.getElementById('mining-hash-price');
                if (hashPriceEl) hashPriceEl.textContent = `$${hashPrice}/PH/day`;
                
                // Estimated power draw (assuming 25 J/TH average efficiency)
                const efficiencyJTH = 25;
                const powerDrawGW = (hashrateTH * efficiencyJTH / 1e9).toFixed(1);
                const powerEl = document.getElementById('mining-power-draw');
                if (powerEl) powerEl.textContent = `${powerDrawGW} GW`;
                
                // Annual energy consumption in TWh
                const annualTWh = (powerDrawGW * 8760 / 1000).toFixed(0);
                const annualEl = document.getElementById('mining-annual-energy');
                if (annualEl) annualEl.textContent = `~${annualTWh} TWh`;
                
                // Cost to mine 1 BTC (at $0.05/kWh average)
                const electricityCost = 0.05;
                const energyPerBTC = (hashrateTH * efficiencyJTH * 600) / (blockReward * blocksPerDay / 24 / 6); // Joules per BTC
                const kWhPerBTC = energyPerBTC / 3.6e6;
                const costPerBTC = (kWhPerBTC * electricityCost).toFixed(0);
                const costEl = document.getElementById('mining-cost-btc');
                if (costEl) costEl.textContent = `$${parseInt(costPerBTC).toLocaleString()}`;
                
                // Breakeven electricity price
                const breakeven = (btcPrice / kWhPerBTC).toFixed(3);
                const breakevenEl = document.getElementById('mining-breakeven');
                if (breakevenEl) breakevenEl.textContent = `$${breakeven}/kWh`;
                
                // Security budget (daily miner revenue)
                const securityBudgetM = (dailyRevenue / 1e6).toFixed(1);
                const securityEl = document.getElementById('mining-security-budget');
                if (securityEl) securityEl.textContent = `$${securityBudgetM}M/day`;
                
                // 51% attack cost estimate (rough: need to acquire 51% of hashrate for 1 hour)
                const attackCostB = (hashratePH * 0.51 * 0.01).toFixed(1); // Very rough estimate
                const attackEl = document.getElementById('mining-attack-cost');
                if (attackEl) attackEl.textContent = `$${attackCostB}B+`;
            }
        }
        
        // Process difficulty data
        if (diffRes && diffRes.ok) {
            const diffData = await diffRes.json();
            if (diffData && diffData.length > 0) {
                const latestDiff = diffData[0];
                const diffT = (latestDiff.difficulty / 1e12).toFixed(2);
                const diffEl = document.getElementById('mining-difficulty');
                const diffMini = document.getElementById('diff-mini');
                if (diffEl) diffEl.textContent = `${diffT} T`;
                if (diffMini) diffMini.textContent = diffT;
                
                // Difficulty change
                const diffChange = latestDiff.change ? (latestDiff.change * 100).toFixed(2) : 0;
                const diffChangeEl = document.getElementById('mining-diff-change');
                if (diffChangeEl) {
                    diffChangeEl.textContent = `${diffChange >= 0 ? '+' : ''}${diffChange}% last adj`;
                    diffChangeEl.style.color = diffChange >= 0 ? '#22c55e' : '#dc2626';
                }
            }
        }
        
        // Process block height for halving calculation
        if (blocksRes && blocksRes.ok) {
            const blockHeight = await blocksRes.json();
            
            // Calculate blocks today (rough estimate)
            const blocksToday = blockHeight % 144;
            const blocksTodayEl = document.getElementById('mining-blocks-today');
            if (blocksTodayEl) blocksTodayEl.textContent = blocksToday;
            
            // Calculate average block time (rough based on current difficulty period)
            const blockTimeEl = document.getElementById('mining-block-time');
            if (blockTimeEl) blockTimeEl.textContent = '~10 min';
            
            const confirmsEl = document.getElementById('mining-confirms-hr');
            if (confirmsEl) confirmsEl.textContent = '~6';
            
            // Halving calculation
            const nextHalvingBlock = Math.ceil(blockHeight / 210000) * 210000;
            const blocksUntilHalving = nextHalvingBlock - blockHeight;
            const halvingBlocksEl = document.getElementById('mining-halving-blocks');
            if (halvingBlocksEl) halvingBlocksEl.textContent = `${blocksUntilHalving.toLocaleString()} blocks`;
            
            // Estimate halving date (10 min per block)
            const minutesUntil = blocksUntilHalving * 10;
            const halvingDate = new Date(Date.now() + minutesUntil * 60 * 1000);
            const halvingDateEl = document.getElementById('mining-halving-date');
            if (halvingDateEl) halvingDateEl.textContent = `~${halvingDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}`;
        }
        
        // Process mining pools - Donut Chart
        if (poolsRes && poolsRes.ok) {
            const poolsData = await poolsRes.json();
            if (poolsData && poolsData.pools) {
                const donutEl = document.getElementById('mining-pool-donut');
                const legendEl = document.getElementById('mining-pool-legend');
                const totalBlocksEl = document.getElementById('mining-pool-total-blocks');
                const decentralizationEl = document.getElementById('mining-decentralization');
                
                // Take top 8 pools, group rest as "Others"
                const topPools = poolsData.pools.slice(0, 8);
                const otherPools = poolsData.pools.slice(8);
                const totalBlocks = poolsData.blockCount || poolsData.pools.reduce((sum, p) => sum + p.blockCount, 0);
                const otherBlocks = otherPools.reduce((sum, p) => sum + p.blockCount, 0);
                
                if (otherBlocks > 0) {
                    topPools.push({ name: 'Others', blockCount: otherBlocks });
                }
                
                const poolColors = ['#f7931a', '#3b82f6', '#22c55e', '#a855f7', '#ec4899', '#14b8a6', '#facc15', '#6366f1', '#64748b'];
                
                // Update total blocks
                if (totalBlocksEl) totalBlocksEl.textContent = totalBlocks;
                
                // Generate donut chart segments
                if (donutEl) {
                    const radius = 40;
                    const circumference = 2 * Math.PI * radius;
                    let currentOffset = 0;
                    
                    let segments = `<circle cx="50" cy="50" r="${radius}" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="18"/>`;
                    
                    topPools.forEach((pool, i) => {
                        const pct = pool.blockCount / totalBlocks;
                        const segmentLength = pct * circumference;
                        const gapSize = 2; // Small gap between segments
                        
                        segments += `
                            <circle 
                                cx="50" cy="50" r="${radius}" 
                                fill="none" 
                                stroke="${poolColors[i]}" 
                                stroke-width="18"
                                stroke-dasharray="${segmentLength - gapSize} ${circumference}"
                                stroke-dashoffset="${-currentOffset}"
                                style="transition: stroke-dasharray 0.5s ease, stroke-dashoffset 0.5s ease;"
                            />
                        `;
                        currentOffset += segmentLength;
                    });
                    
                    donutEl.innerHTML = segments;
                }
                
                // Generate legend
                if (legendEl) {
                    legendEl.innerHTML = topPools.map((pool, i) => {
                        const pct = ((pool.blockCount / totalBlocks) * 100).toFixed(1);
                        return `
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 12px; height: 12px; border-radius: 3px; background: ${poolColors[i]}; flex-shrink: 0;"></div>
                                <div style="flex: 1; min-width: 0;">
                                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.85); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${pool.name}</div>
                                    <div style="font-size: 0.65rem; color: rgba(255,255,255,0.5);">${pct}%  ${pool.blockCount} blocks</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // Check decentralization health
                if (decentralizationEl && topPools.length > 0) {
                    const largestPoolPct = (topPools[0].blockCount / totalBlocks) * 100;
                    if (largestPoolPct > 40) {
                        decentralizationEl.innerHTML = `
                            <i class="fas fa-exclamation-triangle" style="color: #facc15;"></i>
                            <span style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">
                                <strong style="color: #facc15;">Concentration Warning:</strong> ${topPools[0].name} has ${largestPoolPct.toFixed(1)}% of hashrate. Decentralization is healthier below 40%.
                            </span>
                        `;
                        decentralizationEl.style.background = 'rgba(250, 204, 21, 0.1)';
                        decentralizationEl.style.borderColor = 'rgba(250, 204, 21, 0.25)';
                    } else {
                        decentralizationEl.innerHTML = `
                            <div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px;">
                                <i class="fas fa-info-circle" style="color: #3b82f6; margin-top: 2px;"></i>
                                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.7); line-height: 1.5;">
                                    <strong style="color: #3b82f6;">Room for Improvement:</strong> Distribution could be healthier. While no pool currently threatens the 40% threshold (when concern begins), the network benefits from more miners joining the fight.
                                </span>
                            </div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px;">
                                <a href="/solo-slayers" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(247, 147, 26, 0.15); border: 1px solid rgba(247, 147, 26, 0.3); border-radius: 6px; font-size: 0.7rem; color: #f7931a; text-decoration: none; transition: all 0.2s;">
                                    <i class="fas fa-hammer"></i> Solo Slayer Route
                                </a>
                                <a href="/infrastructure" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(168, 85, 247, 0.15); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 6px; font-size: 0.7rem; color: #a855f7; text-decoration: none; transition: all 0.2s;">
                                    <i class="fas fa-microchip"></i> Curated Mining Gear
                                </a>
                            </div>
                        `;
                        decentralizationEl.style.background = 'rgba(59, 130, 246, 0.1)';
                        decentralizationEl.style.borderColor = 'rgba(59, 130, 246, 0.25)';
                    }
                }
            }
        }
        
    } catch (error) {
        console.log('Mining intel data fetch error:', error);
    }
}

// Initialize mining data and refresh periodically
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(updateMiningIntelData, 3000);
    setInterval(updateMiningIntelData, 60000); // Refresh every minute
    
    // Auto-expand intel card if linked via hash (e.g., /live#intel-mining)
    const hash = window.location.hash;
    if (hash && hash.startsWith('#intel-')) {
        const targetCard = document.querySelector(hash);
        if (targetCard && targetCard.classList.contains('intel-card')) {
            setTimeout(() => {
                targetCard.classList.add('expanded');
                targetCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 500);
        }
    }
});

// ===============================
// LIGHTNING PULSE REAL-TIME FEED
// Simulated zaps for visual demo
// Connect to real API when available
// ===============================

const lightningZapExamples = [
  { amount: 21, message: 'Stack sats!', node: 'ACINQ' },
  { amount: 100, message: 'Zap! ', node: 'Voltage' },
  { amount: 500, message: 'Great content', node: 'River' },
  { amount: 1000, message: 'LFG!', node: 'Fold' },
  { amount: 2100, message: 'Bitcoin fixes this', node: 'Strike' },
  { amount: 5000, message: 'Nostr zap', node: 'WoS' },
  { amount: 10000, message: 'V4V ', node: 'Alby' },
  { amount: 21000, message: 'Pleb power', node: 'Mutiny' },
];

function addLightningZap() {
    const container = document.getElementById('lightning-zap-feed');
    if (!container) return;
    
    const zap = lightningZapExamples[Math.floor(Math.random() * lightningZapExamples.length)];
    const variation = Math.random() * 0.5 + 0.75; // 0.75 to 1.25
    const amount = Math.round(zap.amount * variation);
    
    const zapEl = document.createElement('div');
    zapEl.className = 'lightning-zap';
    zapEl.innerHTML = `
        <div class="zap-icon"><i class="fas fa-bolt"></i></div>
        <div style="flex: 1;">
            <div style="color: #facc15; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; font-weight: 600;">
                ${amount.toLocaleString()} sats
            </div>
            <div style="color: rgba(255,255,255,0.6); font-size: 0.75rem;">
                via ${zap.node}  ${zap.message}
            </div>
        </div>
        <div style="color: rgba(255,255,255,0.4); font-size: 0.7rem;">now</div>
    `;
    
    container.insertBefore(zapEl, container.firstChild);
    
    // Keep only last 6 zaps
    while (container.children.length > 6) {
        container.removeChild(container.lastChild);
    }
}

// Add initial zaps and simulate ongoing activity
setTimeout(() => {
    for (let i = 0; i < 4; i++) {
        setTimeout(() => addLightningZap(), i * 200);
    }
}, 2000);

// Simulate new zaps at random intervals (3-8 seconds)
function scheduleNextZap() {
    const delay = 3000 + Math.random() * 5000;
    setTimeout(() => {
        addLightningZap();
        scheduleNextZap();
    }, delay);
}
scheduleNextZap();
</script>
{% endblock %}
