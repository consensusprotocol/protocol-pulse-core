{% extends "base.html" %}

{% block title %}The Network - Protocol Pulse Media Hub{% endblock %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
    --bg-primary: #000000;
    --bg-secondary: #0a0a0a;
    --bg-card: #111111;
    --bg-elevated: #161616;
    --border-subtle: rgba(255,255,255,0.06);
    --border-hover: rgba(255,255,255,0.12);
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.7);
    --text-muted: rgba(255,255,255,0.4);
    --accent: #dc2626;
    --accent-glow: rgba(220,38,38,0.15);
    --bitcoin: #f7931a;
    --nostr-purple: #a855f7;
    --x-blue: #1d9bf0;
    --youtube-red: #ff0000;
    --success: #22c55e;
    --warning: #eab308;
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 24px;
}

* { box-sizing: border-box; }

.media-hub {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    padding-top: 80px;
}

.hub-container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 24px;
}

/* ========== ANIMATED HERO HEADER ========== */
.hub-hero {
    position: relative;
    padding: 80px 0 60px;
    text-align: center;
    overflow: hidden;
}

.hero-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
}

.hero-gradient {
    position: absolute;
    inset: 0;
    background: 
        radial-gradient(ellipse 80% 50% at 50% -20%, rgba(220,38,38,0.15) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 50%, rgba(168,85,247,0.1) 0%, transparent 40%),
        radial-gradient(ellipse 60% 40% at 20% 50%, rgba(247,147,26,0.08) 0%, transparent 40%);
}

.hero-grid {
    position: absolute;
    inset: 0;
    background-image: 
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
    background-size: 60px 60px;
    mask-image: radial-gradient(ellipse at center, black 30%, transparent 70%);
    animation: gridPulse 8s ease-in-out infinite;
}

@keyframes gridPulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.6; }
}

.hero-particles {
    position: absolute;
    inset: 0;
    overflow: hidden;
}

.particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--accent);
    border-radius: 50%;
    opacity: 0;
    animation: particleFloat 12s ease-in-out infinite;
}

.particle:nth-child(1) { left: 10%; animation-delay: 0s; }
.particle:nth-child(2) { left: 25%; animation-delay: 2s; }
.particle:nth-child(3) { left: 40%; animation-delay: 4s; }
.particle:nth-child(4) { left: 55%; animation-delay: 1s; }
.particle:nth-child(5) { left: 70%; animation-delay: 3s; }
.particle:nth-child(6) { left: 85%; animation-delay: 5s; }
.particle:nth-child(7) { left: 15%; animation-delay: 6s; background: var(--nostr-purple); }
.particle:nth-child(8) { left: 60%; animation-delay: 7s; background: var(--bitcoin); }
.particle:nth-child(9) { left: 35%; animation-delay: 8s; background: var(--x-blue); }
.particle:nth-child(10) { left: 75%; animation-delay: 9s; background: var(--youtube-red); }

@keyframes particleFloat {
    0% { bottom: -10%; opacity: 0; transform: translateX(0) scale(1); }
    10% { opacity: 0.8; }
    90% { opacity: 0.8; }
    100% { bottom: 110%; opacity: 0; transform: translateX(100px) scale(0.5); }
}

.hero-glow {
    position: absolute;
    width: 600px;
    height: 600px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(220,38,38,0.08) 0%, transparent 70%);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: glowPulse 6s ease-in-out infinite;
}

@keyframes glowPulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
}

.hero-scanline {
    position: absolute;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(220,38,38,0.5), transparent);
    top: 0;
    animation: scanline 4s linear infinite;
}

@keyframes scanline {
    0% { top: 0; opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { top: 100%; opacity: 0; }
}

.hero-content {
    position: relative;
    z-index: 1;
}

.hub-hero h1 {
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 800;
    letter-spacing: -0.03em;
    margin-bottom: 16px;
    background: linear-gradient(180deg, #fff 0%, rgba(255,255,255,0.7) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.hub-hero .subtitle {
    font-size: 1.1rem;
    color: var(--text-secondary);
    max-width: 650px;
    margin: 0 auto 32px;
    line-height: 1.6;
}

.hub-stats {
    display: flex;
    justify-content: center;
    gap: 48px;
    flex-wrap: wrap;
}

.hub-stat {
    text-align: center;
}

.hub-stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent);
    text-shadow: 0 0 30px rgba(220,38,38,0.4);
}

.hub-stat-label {
    font-size: 0.65rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin-top: 4px;
}

/* ========== NAVIGATION TABS ========== */
.hub-nav {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-bottom: 40px;
    flex-wrap: wrap;
    position: sticky;
    top: 70px;
    z-index: 100;
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(20px);
    padding: 16px 0;
    margin-left: -24px;
    margin-right: -24px;
    padding-left: 24px;
    padding-right: 24px;
    border-bottom: 1px solid var(--border-subtle);
}

.hub-nav .hub-tab {
    flex-shrink: 0;
    min-width: 0;
}

.hub-tab {
    padding: 10px 20px;
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: 100px;
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
}

.hub-tab:hover {
    background: var(--bg-elevated);
    border-color: var(--border-hover);
    color: var(--text-primary);
}

.hub-tab.active {
    background: var(--text-primary);
    color: var(--bg-primary);
    border-color: var(--text-primary);
}

/* ========== LIVE ACTIVITY DASHBOARD ========== */
.activity-dashboard {
    display: grid;
    grid-template-columns: 340px 1fr;
    gap: 24px;
    margin-bottom: 60px;
}

@media (max-width: 1200px) {
    .activity-dashboard { grid-template-columns: 1fr; }
}

/* Voice Tracker Panel */
.voice-tracker {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    overflow: hidden;
    max-height: 800px;
    display: flex;
    flex-direction: column;
}

.tracker-header {
    padding: 16px 20px;
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}

.tracker-title {
    font-size: 0.9rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.tracker-title i { color: var(--accent); }

.tracker-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-muted);
    background: var(--bg-primary);
    padding: 4px 10px;
    border-radius: 100px;
}

.tracker-filters {
    display: flex;
    gap: 6px;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-subtle);
    overflow-x: auto;
    flex-shrink: 0;
}

.filter-btn {
    padding: 6px 12px;
    background: transparent;
    border: 1px solid var(--border-subtle);
    border-radius: 100px;
    color: var(--text-muted);
    font-size: 0.7rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}

.filter-btn:hover { border-color: var(--border-hover); color: var(--text-secondary); }
.filter-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
.filter-btn[data-platform="youtube"].active { background: var(--youtube-red); border-color: var(--youtube-red); }
.filter-btn[data-platform="x"].active { background: var(--x-blue); border-color: var(--x-blue); }
.filter-btn[data-platform="nostr"].active { background: var(--nostr-purple); border-color: var(--nostr-purple); }

.voice-list {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
}

.voice-card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 4px;
}

.voice-card:hover { background: var(--bg-elevated); }

.voice-card.active-now {
    background: rgba(34,197,94,0.1);
    border-left: 3px solid var(--success);
}

.voice-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.85rem;
    flex-shrink: 0;
    position: relative;
}

.voice-avatar.youtube { background: linear-gradient(135deg, #dc2626, #991b1b); }
.voice-avatar.x { background: linear-gradient(135deg, #1d9bf0, #0d7dc2); }
.voice-avatar.nostr { background: linear-gradient(135deg, #a855f7, #7c3aed); }

.activity-dot {
    position: absolute;
    bottom: 2px;
    right: 2px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    border: 2px solid var(--bg-card);
}

.activity-dot.active { background: var(--success); animation: pulse 2s infinite; }
.activity-dot.recent { background: var(--warning); }
.activity-dot.inactive { background: var(--text-muted); }

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
}

.voice-info {
    flex: 1;
    min-width: 0;
}

.voice-name {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.voice-handle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-muted);
}

.voice-meta {
    text-align: right;
    flex-shrink: 0;
}

.voice-last-active {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--success);
}

.voice-tier {
    font-size: 0.6rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Pulse Social Feed */
.pulse-feed {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    max-height: 800px;
}

.feed-header {
    padding: 16px 20px;
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}

.feed-title {
    font-size: 0.9rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.feed-title i { color: var(--accent); }

.live-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(34,197,94,0.15);
    border: 1px solid rgba(34,197,94,0.3);
    padding: 4px 10px;
    border-radius: 100px;
    font-size: 0.65rem;
    color: var(--success);
    font-family: 'JetBrains Mono', monospace;
}

.live-dot {
    width: 6px;
    height: 6px;
    background: var(--success);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.feed-content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}

.social-post {
    background: var(--bg-secondary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
    animation: slideIn 0.4s ease-out;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.social-post:hover {
    border-color: var(--border-hover);
    transform: translateX(4px);
}

.social-post.youtube { border-left: 3px solid var(--youtube-red); }
.social-post.x { border-left: 3px solid var(--x-blue); }
.social-post.nostr { border-left: 3px solid var(--nostr-purple); }

.post-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.post-author {
    display: flex;
    align-items: center;
    gap: 10px;
}

.post-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.75rem;
}

.post-avatar.youtube { background: linear-gradient(135deg, #dc2626, #991b1b); }
.post-avatar.x { background: linear-gradient(135deg, #1d9bf0, #0d7dc2); }
.post-avatar.nostr { background: linear-gradient(135deg, #a855f7, #7c3aed); }

.post-author-info h4 {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 2px;
}

.post-author-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.7rem;
    color: var(--text-muted);
}

.platform-icon {
    font-size: 0.75rem;
}

.platform-icon.fa-youtube { color: var(--youtube-red); }
.platform-icon.fa-x-twitter { color: var(--x-blue); }
.platform-icon.fa-bolt { color: var(--nostr-purple); }

.post-time {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-muted);
}

.post-content {
    font-size: 0.9rem;
    line-height: 1.6;
    color: var(--text-secondary);
    margin-bottom: 12px;
}

.post-content a { color: var(--accent); text-decoration: none; }
.post-content a:hover { text-decoration: underline; }

.post-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.post-engagement {
    display: flex;
    gap: 16px;
}

.engagement-stat {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: var(--text-muted);
}

.engagement-stat i { font-size: 0.8rem; }
.engagement-stat.zaps i { color: var(--bitcoin); }
.engagement-stat.likes i { color: var(--accent); }
.engagement-stat.replies i { color: var(--x-blue); }

.post-link {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: color 0.2s;
}

.post-link:hover { color: var(--accent); }

/* ========== TRENDING TOPICS ========== */
.trending-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    margin-bottom: 24px;
    overflow-x: auto;
}

.trending-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 6px;
}

.trending-label i { color: var(--accent); }

.trending-topics {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
}

.trending-topic {
    padding: 6px 14px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 100px;
    font-size: 0.8rem;
    color: var(--text-secondary);
    white-space: nowrap;
    cursor: pointer;
    transition: all 0.2s;
}

.trending-topic:hover {
    border-color: var(--accent);
    color: var(--accent);
}

.trending-topic .count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-muted);
    margin-left: 6px;
}

/* ========== SERIES SECTION ========== */
.hub-section {
    margin-bottom: 60px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    display: flex;
    align-items: center;
    gap: 12px;
}

.section-title::before {
    content: '';
    width: 4px;
    height: 24px;
    background: var(--accent);
    border-radius: 2px;
}

/* ========== BOOKS SECTION (Sovereign Library + Recommended Reading) ========== */
.books-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 1.5rem;
}

.book-card {
    background: linear-gradient(145deg, rgba(15, 15, 15, 0.95) 0%, rgba(8, 8, 8, 0.98) 100%);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    position: relative;
}

.book-card:hover {
    border-color: rgba(220, 38, 38, 0.5);
    transform: translateY(-6px);
    box-shadow: 0 20px 40px rgba(220, 38, 38, 0.15);
}

.book-cover {
    height: 200px;
    background-size: cover;
    background-position: center;
    background-color: var(--bg-elevated);
}

.book-info {
    padding: 1.25rem;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.book-badge {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: var(--bitcoin);
    color: #000;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 0.25rem 0.6rem;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.book-title {
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 0.35rem;
    color: var(--text-primary);
    line-height: 1.3;
}

.book-author {
    font-size: 0.8rem;
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    margin-bottom: 0.5rem;
}

.book-desc {
    font-size: 0.8rem;
    color: var(--text-secondary);
    line-height: 1.45;
    margin-bottom: 0.75rem;
    flex: 1;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    display: -webkit-box;
}

.book-cta {
    font-size: 0.8rem;
    color: var(--accent);
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
}

.book-card:hover .book-cta { color: #f97316; }

/* Books strip on Live Feed (visible by default on /media) */
.books-on-feed {
    margin-top: 2rem;
    padding: 1.5rem 0;
    border-top: 1px solid var(--border-subtle);
}
.books-on-feed-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
}
.books-on-feed-title {
    font-size: 1.1rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-primary);
}
.books-on-feed-title i { color: var(--accent); }
.books-on-feed-more {
    background: transparent;
    border: 1px solid var(--accent);
    color: var(--accent);
    padding: 0.4rem 0.9rem;
    border-radius: 6px;
    font-size: 0.8rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    transition: all 0.2s;
}
.books-on-feed-more:hover {
    background: var(--accent);
    color: white;
}
.books-on-feed-sub {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 1.25rem;
}
.books-on-feed-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 1rem;
}
.book-card-inline .book-cover { height: 160px; }
.book-card-inline .book-info { padding: 0.75rem; }
.book-card-inline .book-title { font-size: 0.9rem; }
.book-card-inline .book-desc { display: none; }
@media (max-width: 768px) {
    .books-on-feed-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.75rem; }
    .book-card-inline .book-cover { height: 140px; }
}

@media (max-width: 768px) {
    .books-grid { grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    .book-cover { height: 160px; }
    .book-info { padding: 1rem; }
}

/* ========== SERIES SHOWCASE (original interactive design) ========== */
.series-showcase {
    padding: 3rem 0;
    background: radial-gradient(ellipse at 20% 80%, rgba(220, 38, 38, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(220, 38, 38, 0.05) 0%, transparent 40%);
    position: relative;
    overflow: hidden;
}

.series-showcase::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(220, 38, 38, 0.3), transparent);
}

.showcase-header {
    text-align: center;
    margin-bottom: 2.5rem;
}

.showcase-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(220, 38, 38, 0.05) 100%);
    border: 1px solid rgba(220, 38, 38, 0.3);
    padding: 0.6rem 1.5rem;
    border-radius: 50px;
    margin-bottom: 1rem;
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    letter-spacing: 3px;
    text-transform: uppercase;
}

.showcase-title {
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 800;
    letter-spacing: -2px;
    margin-bottom: 0.5rem;
    background: linear-gradient(180deg, #ffffff 0%, rgba(255, 255, 255, 0.75) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.showcase-subtitle {
    font-size: 1rem;
    color: var(--text-secondary);
    max-width: 560px;
    margin: 0 auto;
    line-height: 1.6;
}

.series-carousel {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
}

#section-series .series-card {
    background: linear-gradient(145deg, rgba(15, 15, 15, 0.95) 0%, rgba(8, 8, 8, 0.98) 100%);
    border: 1px solid var(--border-subtle);
    border-radius: 24px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    position: relative;
}

#section-series .series-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0;
    transition: opacity 0.4s ease;
}

#section-series .series-card:hover {
    transform: translateY(-12px) scale(1.02);
    border-color: rgba(220, 38, 38, 0.5);
    box-shadow: 0 30px 60px rgba(220, 38, 38, 0.2), 0 15px 30px rgba(0, 0, 0, 0.4);
}

#section-series .series-card:hover::before {
    opacity: 1;
}

.series-thumbnail {
    height: 200px;
    background-size: cover;
    background-position: center;
    position: relative;
    overflow: hidden;
}

.series-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.7) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.4s ease;
}

#section-series .series-card:hover .series-overlay {
    opacity: 1;
}

.play-ring {
    width: 70px;
    height: 70px;
    border: 2px solid rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(220, 38, 38, 0.9);
    transform: scale(0.8);
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    box-shadow: 0 10px 40px rgba(220, 38, 38, 0.5);
}

#section-series .series-card:hover .play-ring {
    transform: scale(1);
}

.play-ring i {
    color: white;
    font-size: 1.5rem;
    margin-left: 4px;
}

.series-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    padding: 0.4rem 0.8rem;
    border-radius: 50px;
    font-size: 0.7rem;
    font-family: 'JetBrains Mono', monospace;
    color: var(--accent);
    border: 1px solid rgba(220, 38, 38, 0.3);
    letter-spacing: 1px;
}

.series-info {
    padding: 1.5rem;
}

.series-info h3 {
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
    line-height: 1.3;
}

.series-author {
    font-size: 0.8rem;
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    margin-bottom: 0.75rem;
}

#section-series .series-desc {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
    margin: 0;
    display: block;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

@media (max-width: 1200px) {
    .series-carousel { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 768px) {
    .series-carousel { grid-template-columns: 1fr; gap: 1.25rem; }
    .series-showcase { padding: 2rem 0; }
    .showcase-header { margin-bottom: 1.5rem; }
}

/* ========== NOSTR SECTION ========== */
.nostr-section {
    background: linear-gradient(135deg, rgba(168,85,247,0.05) 0%, transparent 100%);
    border: 1px solid rgba(168,85,247,0.2);
    border-radius: var(--radius-lg);
    padding: 32px;
}

.nostr-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 16px;
}

.nostr-title {
    font-size: 1.25rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 12px;
}

.nostr-title i { color: var(--nostr-purple); }

.nostr-controls {
    display: flex;
    align-items: center;
    gap: 12px;
}

.nostr-badge {
    background: rgba(168,85,247,0.15);
    border: 1px solid rgba(168,85,247,0.3);
    padding: 6px 12px;
    border-radius: 100px;
    font-size: 0.7rem;
    color: var(--nostr-purple);
    font-family: 'JetBrains Mono', monospace;
    display: flex;
    align-items: center;
    gap: 6px;
}

.live-indicator {
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.sovereign-toggle {
    background: rgba(168,85,247,0.1);
    border: 1px solid rgba(168,85,247,0.3);
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 0.7rem;
    color: rgba(255,255,255,0.6);
    cursor: pointer;
    font-family: 'JetBrains Mono', monospace;
    transition: all 0.2s;
}

.sovereign-toggle:hover, .sovereign-toggle.active {
    background: rgba(168,85,247,0.2);
    border-color: var(--nostr-purple);
    color: var(--nostr-purple);
}

#nostrFeed {
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-height: 600px;
    overflow-y: auto;
}

.nostr-post {
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(168,85,247,0.15);
    border-left: 3px solid var(--nostr-purple);
    border-radius: var(--radius-md);
    padding: 16px 20px;
    transition: all 0.3s ease;
}

.nostr-post:hover {
    border-color: rgba(168,85,247,0.4);
    transform: translateX(4px);
}

.nostr-post.slide-in { animation: slideIn 0.4s ease-out; }

.nostr-post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
    gap: 8px;
}

.nostr-author {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.author-name { font-weight: 600; font-size: 0.9rem; }

.sovereign-badge {
    background: rgba(168,85,247,0.2);
    border: 1px solid var(--nostr-purple);
    color: var(--nostr-purple);
    font-size: 0.55rem;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'JetBrains Mono', monospace;
    display: flex;
    align-items: center;
    gap: 4px;
}

.nip05-handle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-muted);
}

.nostr-time {
    font-size: 0.7rem;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
}

.nostr-content {
    font-size: 0.9rem;
    line-height: 1.6;
    color: var(--text-secondary);
    margin-bottom: 12px;
    word-break: break-word;
}

.nostr-content a { color: var(--nostr-purple); text-decoration: none; }
.nostr-content a:hover { text-decoration: underline; }
.nostr-hashtag { color: var(--accent); }

.nostr-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.zap-counter {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
}

.zap-icon { color: var(--bitcoin); }
.zap-count { color: var(--bitcoin); font-weight: 600; }

.view-on-nostr {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-decoration: none;
    transition: color 0.2s;
}

.view-on-nostr:hover { color: var(--nostr-purple); }

.nostr-loading {
    text-align: center;
    padding: 40px;
    color: var(--text-muted);
}

/* ========== MODAL ========== */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.95);
    z-index: 9999;
    display: none;
    padding: 40px;
    overflow-y: auto;
}

.modal-overlay.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-close {
    position: fixed;
    top: 24px;
    right: 24px;
    width: 48px;
    height: 48px;
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: 50%;
    color: var(--text-primary);
    font-size: 1.25rem;
    cursor: pointer;
    z-index: 10001;
    transition: all 0.2s;
}

.modal-close:hover { background: var(--accent); }

.modal-content { max-width: 1200px; margin: 0 auto; }

.modal-video {
    border-radius: var(--radius-lg);
    overflow: hidden;
    margin-bottom: 24px;
}

.modal-video iframe {
    width: 100%;
    aspect-ratio: 16/9;
    border: none;
}

.modal-info {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 32px;
}

@media (max-width: 900px) { .modal-info { grid-template-columns: 1fr; } }

.modal-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 12px; }
.modal-description { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; }

/* Episode Intel Card (TL;DR, Key Quote, Fun Fact, Topics) */
.episode-guide-panel {
    background: linear-gradient(135deg, rgba(20,20,25,0.98) 0%, rgba(30,30,35,0.95) 100%);
    border: 1px solid rgba(220,38,38,0.3);
    border-radius: 12px;
    padding: 1.25rem;
    margin: 1rem 0;
    position: relative;
    animation: guideSlideIn 0.3s ease-out;
}
@keyframes guideSlideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
.guide-badge {
    background: linear-gradient(135deg, var(--accent) 0%, #b91c1c 100%);
    color: white;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-family: 'JetBrains Mono', monospace;
    letter-spacing: 1px;
    text-transform: uppercase;
}
.guide-episode-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1rem;
    line-height: 1.3;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 0.75rem;
}
.guide-section { margin-bottom: 1rem; }
.guide-section:last-child { margin-bottom: 0; }
.guide-label {
    font-size: 0.65rem;
    font-weight: 700;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 0.4rem;
    font-family: 'JetBrains Mono', monospace;
}
.guide-content { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; margin: 0; }
.guide-quote {
    font-size: 0.85rem;
    color: var(--bitcoin);
    font-style: italic;
    line-height: 1.5;
    margin: 0;
    padding-left: 0.75rem;
    border-left: 2px solid var(--accent);
}
.guide-topics { display: flex; flex-wrap: wrap; gap: 0.4rem; }
.guide-topic-tag {
    background: rgba(220,38,38,0.15);
    color: var(--accent);
    font-size: 0.65rem;
    padding: 0.25rem 0.6rem;
    border-radius: 12px;
    font-family: 'JetBrains Mono', monospace;
    border: 1px solid rgba(220,38,38,0.3);
}

.episode-list {
    background: var(--bg-card);
    border-radius: var(--radius-md);
    overflow: hidden;
    max-height: 400px;
    overflow-y: auto;
}

.episode-list-title {
    padding: 16px 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border-subtle);
    position: sticky;
    top: 0;
    background: var(--bg-card);
}

.episode-item {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border-subtle);
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 12px;
}

.episode-item:hover { background: var(--bg-elevated); }

.episode-item.active {
    background: var(--accent-glow);
    border-left: 3px solid var(--accent);
}

.episode-num {
    width: 28px;
    height: 28px;
    background: var(--bg-elevated);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
    flex-shrink: 0;
}

.episode-item.active .episode-num { background: var(--accent); }
.episode-title { font-size: 0.85rem; }

/* ========== RESPONSIVE ========== */
@media (max-width: 768px) {
    .hub-hero { padding: 50px 0 30px; }
    .hub-hero h1 { font-size: 1.8rem; }
    .hub-stats { gap: 24px; }
    .hub-stat-value { font-size: 1.5rem; }
    .hub-nav { gap: 6px; }
    .hub-tab { padding: 8px 12px; font-size: 0.75rem; }
    .modal-overlay { padding: 16px; }
    .trending-bar { padding: 12px 16px; }
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-secondary); }
::-webkit-scrollbar-thumb { background: var(--border-hover); border-radius: 3px; }
</style>
{% endblock %}

{% block content %}
<div class="media-hub">
    <div class="hub-container">
        
        <!-- Animated Hero -->
        <div class="hub-hero">
            <div class="hero-bg">
                <div class="hero-gradient"></div>
                <div class="hero-grid"></div>
                <div class="hero-glow"></div>
                <div class="hero-scanline"></div>
                <div class="hero-particles">
                    <div class="particle"></div><div class="particle"></div>
                    <div class="particle"></div><div class="particle"></div>
                    <div class="particle"></div><div class="particle"></div>
                    <div class="particle"></div><div class="particle"></div>
                    <div class="particle"></div><div class="particle"></div>
                </div>
            </div>
            <div class="hero-content">
                <h1>The Network</h1>
                <p class="subtitle">Real-time intelligence from 40+ trusted voices across the Bitcoin ecosystem</p>
                <div class="hub-stats">
                    <div class="hub-stat">
                        <div class="hub-stat-value" id="activeVoices">23</div>
                        <div class="hub-stat-label">Active Voices</div>
                    </div>
                    <div class="hub-stat">
                        <div class="hub-stat-value" id="postsToday">47</div>
                        <div class="hub-stat-label">Posts Today</div>
                    </div>
                    <div class="hub-stat">
                        <div class="hub-stat-value">3</div>
                        <div class="hub-stat-label">Platforms</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation: Live Feed | Books | Series | Nostr (all 4 must be visible) -->
        <nav class="hub-nav" id="hub-nav" role="tablist" aria-label="Media hub sections">
            <button type="button" class="hub-tab active" id="hub-tab-channels" role="tab" aria-selected="true" onclick="showSection('channels')">
                <i class="fas fa-satellite-dish"></i> Live Feed
            </button>
            <button type="button" class="hub-tab" id="hub-tab-books" role="tab" aria-selected="false" onclick="showSection('books')">
                <i class="fas fa-book"></i> Books
            </button>
            <button type="button" class="hub-tab" onclick="showSection('series')">
                <i class="fas fa-play-circle"></i> Series
            </button>
            <button type="button" class="hub-tab" onclick="showSection('nostr')">
                <i class="fas fa-bolt"></i> Nostr
            </button>
        </nav>

        <!-- LIVE FEED SECTION -->
        <div id="section-channels" class="hub-section">
            
            <!-- Trending Topics Bar -->
            <div class="trending-bar">
                <div class="trending-label"><i class="fas fa-fire"></i> Trending</div>
                <div class="trending-topics" id="trendingTopics">
                    <span class="trending-topic">#Bitcoin <span class="count">127</span></span>
                    <span class="trending-topic">#ETF <span class="count">84</span></span>
                    <span class="trending-topic">#Lightning <span class="count">52</span></span>
                    <span class="trending-topic">#Nostr <span class="count">41</span></span>
                    <span class="trending-topic">#Mining <span class="count">33</span></span>
                    <span class="trending-topic">#Halving <span class="count">28</span></span>
                </div>
            </div>

            <!-- Activity Dashboard -->
            <div class="activity-dashboard">
                
                <!-- Voice Tracker Panel -->
                <div class="voice-tracker">
                    <div class="tracker-header">
                        <div class="tracker-title"><i class="fas fa-users"></i> Voice Tracker</div>
                        <span class="tracker-count" id="voiceCount">40 voices</span>
                    </div>
                    <div class="tracker-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-platform="youtube" data-filter="youtube"><i class="fab fa-youtube"></i></button>
                        <button class="filter-btn" data-platform="x" data-filter="x"><i class="fab fa-x-twitter"></i></button>
                        <button class="filter-btn" data-platform="nostr" data-filter="nostr"><i class="fas fa-bolt"></i></button>
                        <button class="filter-btn" data-filter="macro">Macro</button>
                        <button class="filter-btn" data-filter="dev">Dev</button>
                        <button class="filter-btn" data-filter="media">Media</button>
                    </div>
                    <div class="voice-list" id="voiceList"></div>
                </div>

                <!-- Pulse Social Feed -->
                <div class="pulse-feed">
                    <div class="feed-header">
                        <div class="feed-title"><i class="fas fa-bolt"></i> Pulse Social Feed</div>
                        <div class="live-badge"><span class="live-dot"></span> LIVE</div>
                    </div>
                    <div class="feed-content" id="pulseFeed"></div>
                </div>
            </div>

            <!-- Sovereign Library: books visible on default /media view -->
            <div class="books-on-feed">
                <div class="books-on-feed-header">
                    <span class="books-on-feed-title"><i class="fas fa-book"></i> Sovereign Library</span>
                    <button type="button" class="books-on-feed-more" onclick="showSection('books');">
                        All books &amp; Amazon links <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <p class="books-on-feed-sub">Featured on the show + recommended reading. Support authors with our affiliate links.</p>
                <div class="books-on-feed-grid">
                    {% for book in our_books %}
                    <a href="{{ book.amazon_url }}" target="_blank" rel="noopener" class="book-card book-card-inline">
                        <div class="book-cover" style="background-image: url('{{ book.cover_url }}');"></div>
                        <div class="book-info">
                            <h3 class="book-title">{{ book.title }}</h3>
                            <p class="book-author">{{ book.author }}</p>
                            <span class="book-cta"><i class="fab fa-amazon"></i> Amazon</span>
                        </div>
                    </a>
                    {% endfor %}
                    {% for book in recommended_books[:6] %}
                    <a href="{{ book.amazon_url }}" target="_blank" rel="noopener" class="book-card book-card-inline {% if book.bestseller %}bestseller{% endif %}">
                        <div class="book-cover" style="background-image: url('{{ book.cover_url }}');"></div>
                        <div class="book-info">
                            {% if book.bestseller %}<span class="book-badge">Bestseller</span>{% endif %}
                            <h3 class="book-title">{{ book.title }}</h3>
                            <p class="book-author">{{ book.author }}</p>
                            <span class="book-cta"><i class="fab fa-amazon"></i> Amazon</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- BOOKS SECTION: Featured + Recommended Reading with Amazon links -->
        <div id="section-books" class="hub-section" style="display: none;">
            <div class="series-showcase">
                <div class="showcase-header">
                    <div class="showcase-badge">
                        <i class="fas fa-book" style="font-size: 1.25em;"></i>
                        <span>SOVEREIGN LIBRARY</span>
                    </div>
                    <h2 class="showcase-title">Featured on the Show</h2>
                    <p class="showcase-subtitle">Books we've broken down episode by episode. Get the physical copy and support the authors.</p>
                </div>
                <div class="books-grid">
                    {% for book in our_books %}
                    <a href="{{ book.amazon_url }}" target="_blank" rel="noopener" class="book-card">
                        <div class="book-cover" style="background-image: url('{{ book.cover_url }}');"></div>
                        <div class="book-info">
                            <h3 class="book-title">{{ book.title }}</h3>
                            <p class="book-author">{{ book.author }}</p>
                            <p class="book-desc">{{ book.description[:120] }}{% if book.description|length > 120 %}...{% endif %}</p>
                            <span class="book-cta"><i class="fab fa-amazon"></i> Get on Amazon</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                <div class="showcase-header" style="margin-top: 3rem;">
                    <h2 class="showcase-title">Recommended Reading</h2>
                    <p class="showcase-subtitle">Essential Bitcoin and sound-money books. Bestsellers and deep dives for every level.</p>
                </div>
                <div class="books-grid">
                    {% for book in recommended_books %}
                    <a href="{{ book.amazon_url }}" target="_blank" rel="noopener" class="book-card {% if book.bestseller %}bestseller{% endif %}">
                        <div class="book-cover" style="background-image: url('{{ book.cover_url }}');"></div>
                        <div class="book-info">
                            {% if book.bestseller %}<span class="book-badge">Bestseller</span>{% endif %}
                            <h3 class="book-title">{{ book.title }}</h3>
                            <p class="book-author">{{ book.author }}</p>
                            <p class="book-desc">{{ book.description[:120] }}{% if book.description|length > 120 %}...{% endif %}</p>
                            <span class="book-cta"><i class="fab fa-amazon"></i> Get on Amazon</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- SERIES SECTION (original interactive series guide with carousel & cards) -->
        <div id="section-series" class="hub-section" style="display: none;">
            <div class="series-showcase">
                <div class="showcase-header">
                    <div class="showcase-badge">
                        <i class="fab fa-bitcoin" style="font-size: 1.25em;"></i>
                        <span>SIGNATURE SERIES</span>
                    </div>
                    <h2 class="showcase-title">Original Book Series</h2>
                    <p class="showcase-subtitle">Cinematic deep dives with the world's leading Bitcoin authors. Each series breaks down essential ideas episode by episode.</p>
                </div>
                
                <div class="series-carousel">
                    <div class="series-card" onclick="openSeries('everything_21m')">
                        <div class="series-thumbnail" style="background-image: url('https://i.ytimg.com/vi/FA8tvWEydcA/maxresdefault.jpg');">
                            <div class="series-overlay">
                                <div class="play-ring"><i class="fas fa-play"></i></div>
                            </div>
                            <div class="series-badge">11 Episodes</div>
                        </div>
                        <div class="series-info">
                            <h3>Everything Divided by 21 Million</h3>
                            <p class="series-author"><i class="fas fa-user" style="margin-right: 0.35rem;"></i>Matty Ice & Knut Svanholm</p>
                            <p class="series-desc">Bitcoin's relationship to time, money, freedom, and human progress.</p>
                        </div>
                    </div>
                    
                    <div class="series-card" onclick="openSeries('big_print')">
                        <div class="series-thumbnail" style="background-image: url('https://i.ytimg.com/vi/W09CNU_q6Yo/maxresdefault.jpg');">
                            <div class="series-overlay">
                                <div class="play-ring"><i class="fas fa-play"></i></div>
                            </div>
                            <div class="series-badge">12 Episodes</div>
                        </div>
                        <div class="series-info">
                            <h3>The Big Print</h3>
                            <p class="series-author"><i class="fas fa-user" style="margin-right: 0.35rem;"></i>Matty Ice & Lawrence Lepard</p>
                            <p class="series-desc">How the Fed engineered the most devastating wealth extraction in history.</p>
                        </div>
                    </div>
                    
                    <div class="series-card" onclick="openSeries('daylight_robbery')">
                        <div class="series-thumbnail" style="background-image: url('https://i.ytimg.com/vi/ZCc78wvwd6U/maxresdefault.jpg');">
                            <div class="series-overlay">
                                <div class="play-ring"><i class="fas fa-play"></i></div>
                            </div>
                            <div class="series-badge">13 Episodes</div>
                        </div>
                        <div class="series-info">
                            <h3>Daylight Robbery</h3>
                            <p class="series-author"><i class="fas fa-user" style="margin-right: 0.35rem;"></i>Matty Ice & Dominic Frisby</p>
                            <p class="series-desc">The hidden story of how taxation shaped human civilization.</p>
                        </div>
                    </div>
                    
                    <div class="series-card" onclick="openSeries('genesis_book')">
                        <div class="series-thumbnail" style="background-image: url('https://i.ytimg.com/vi/3TslgynKeaA/maxresdefault.jpg');">
                            <div class="series-overlay">
                                <div class="play-ring"><i class="fas fa-play"></i></div>
                            </div>
                            <div class="series-badge">10 Episodes</div>
                        </div>
                        <div class="series-info">
                            <h3>The Genesis Book</h3>
                            <p class="series-author"><i class="fas fa-user" style="margin-right: 0.35rem;"></i>Matty Ice & Aaron van Wirdum</p>
                            <p class="series-desc">Austrian economics and the revolutionary origins of Bitcoin.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NOSTR SECTION -->
        <div id="section-nostr" class="hub-section" style="display: none;">
            <div class="nostr-section">
                <div class="nostr-header">
                    <h3 class="nostr-title"><i class="fas fa-bolt"></i> Sovereign Relay</h3>
                    <div class="nostr-controls">
                        <span class="nostr-badge"><span class="live-indicator"></span> LIVE</span>
                        <button class="sovereign-toggle" onclick="toggleSovereignOnly(this)">
                            <i class="fas fa-shield-alt"></i> Verified Only
                        </button>
                    </div>
                </div>
                
                <div id="nostrFeed">
                    <div class="nostr-loading">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 16px; display: block;"></i>
                        Connecting to Nostr relays...
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Video Player Modal -->
<div id="playerModal" class="modal-overlay">
    <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
    <div class="modal-content">
        <div class="modal-video">
            <iframe id="modalVideo" src="" allowfullscreen></iframe>
        </div>
        <div class="modal-info">
            <div>
                <h2 class="modal-title" id="modalTitle">Episode Title</h2>
                <p class="modal-description" id="modalDesc">Episode description...</p>
                <!-- Episode Intel Card (TL;DR, Key Quote, Fun Fact, Topics) -->
                <div id="episodeGuidePanel" class="episode-guide-panel" style="display: none;">
                    <div class="guide-header">
                        <span class="guide-badge"><i class="fas fa-book-open"></i> EPISODE INTEL</span>
                    </div>
                    <h4 class="guide-episode-title" id="guideEpTitle">Episode Title</h4>
                    <div class="guide-section">
                        <div class="guide-label"><i class="fas fa-bolt"></i> TL;DR</div>
                        <p class="guide-content" id="guideTldr"></p>
                    </div>
                    <div class="guide-section">
                        <div class="guide-label"><i class="fas fa-quote-left"></i> KEY QUOTE</div>
                        <p class="guide-quote" id="guideQuote"></p>
                    </div>
                    <div class="guide-section">
                        <div class="guide-label"><i class="fas fa-lightbulb"></i> FUN FACT</div>
                        <p class="guide-content" id="guideFunFact"></p>
                    </div>
                    <div class="guide-section">
                        <div class="guide-label"><i class="fas fa-tags"></i> TOPICS</div>
                        <div class="guide-topics" id="guideTopics"></div>
                    </div>
                </div>
            </div>
            <div class="episode-list" id="episodeList">
                <div class="episode-list-title">Episodes</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/nostr_relay.js') }}"></script>
<script>
// Ecosystem Voice Data
const ecosystemVoices = [
    // YouTube Voices
    { name: 'Michael Saylor', handle: '@saylor', platform: 'youtube', tier: 'macro', initials: 'MS', lastActive: 2 },
    { name: 'Lyn Alden', handle: '@lynalden', platform: 'youtube', tier: 'macro', initials: 'LA', lastActive: 5 },
    { name: 'Natalie Brunell', handle: '@natbrunell', platform: 'youtube', tier: 'media', initials: 'NB', lastActive: 1 },
    { name: 'Peter McCormack', handle: '@whatbitcoindid', platform: 'youtube', tier: 'media', initials: 'PM', lastActive: 8 },
    { name: 'Robert Breedlove', handle: '@breedlove22', platform: 'youtube', tier: 'macro', initials: 'RB', lastActive: 12 },
    { name: 'Marty Bent', handle: '@tftc', platform: 'youtube', tier: 'media', initials: 'MB', lastActive: 3 },
    { name: 'BTC Sessions', handle: '@btcsessions', platform: 'youtube', tier: 'media', initials: 'BT', lastActive: 6 },
    { name: 'Preston Pysh', handle: '@prestonpysh', platform: 'youtube', tier: 'macro', initials: 'PP', lastActive: 4 },
    { name: 'Bitcoin Magazine', handle: '@bitcoinmagazine', platform: 'youtube', tier: 'media', initials: 'BM', lastActive: 0 },
    { name: 'Saifedean Ammous', handle: '@saifedean', platform: 'youtube', tier: 'macro', initials: 'SA', lastActive: 24 },
    
    // X/Twitter Voices
    { name: 'Michael Saylor', handle: '@saylor', platform: 'x', tier: 'macro', initials: 'MS', lastActive: 0 },
    { name: 'Lyn Alden', handle: '@LynAldenContact', platform: 'x', tier: 'macro', initials: 'LA', lastActive: 1 },
    { name: 'Jeff Booth', handle: '@JeffBooth', platform: 'x', tier: 'macro', initials: 'JB', lastActive: 3 },
    { name: 'Jack Dorsey', handle: '@jack', platform: 'x', tier: 'dev', initials: 'JD', lastActive: 2 },
    { name: 'Matt Odell', handle: '@ODELL', platform: 'x', tier: 'dev', initials: 'MO', lastActive: 1 },
    { name: 'Edward Snowden', handle: '@Snowden', platform: 'x', tier: 'freedom', initials: 'ES', lastActive: 6 },
    { name: 'Adam Back', handle: '@adam3us', platform: 'x', tier: 'dev', initials: 'AB', lastActive: 4 },
    { name: 'Jameson Lopp', handle: '@lopp', platform: 'x', tier: 'dev', initials: 'JL', lastActive: 5 },
    { name: 'Willy Woo', handle: '@woonomic', platform: 'x', tier: 'quant', initials: 'WW', lastActive: 2 },
    { name: 'Checkmate', handle: '@_Checkmatey_', platform: 'x', tier: 'quant', initials: 'CM', lastActive: 1 },
    { name: 'NVK', handle: '@nvk', platform: 'x', tier: 'dev', initials: 'NV', lastActive: 3 },
    { name: 'American HODL', handle: '@americanhodl8', platform: 'x', tier: 'macro', initials: 'AH', lastActive: 0 },
    
    // Nostr Voices
    { name: 'Jack Dorsey', handle: 'jack@cash.app', platform: 'nostr', tier: 'dev', initials: 'JD', lastActive: 2 },
    { name: 'Fiatjaf', handle: 'fiatjaf@fiatjaf.com', platform: 'nostr', tier: 'dev', initials: 'FJ', lastActive: 0 },
    { name: 'Matt Odell', handle: 'odell@werunbtc.com', platform: 'nostr', tier: 'dev', initials: 'MO', lastActive: 1 },
    { name: 'Edward Snowden', handle: 'snowden@freedom.press', platform: 'nostr', tier: 'freedom', initials: 'ES', lastActive: 8 },
    { name: 'Lyn Alden', handle: 'lyn@primal.net', platform: 'nostr', tier: 'macro', initials: 'LA', lastActive: 4 },
    { name: 'NVK', handle: 'nvk@nvk.org', platform: 'nostr', tier: 'dev', initials: 'NV', lastActive: 2 },
    { name: 'Gigi', handle: 'gigi@dergigi.com', platform: 'nostr', tier: 'media', initials: 'GG', lastActive: 3 },
    { name: 'Calle', handle: 'calle@cashu.space', platform: 'nostr', tier: 'dev', initials: 'CL', lastActive: 1 },
    { name: 'Marty Bent', handle: 'marty@tftc.io', platform: 'nostr', tier: 'media', initials: 'MB', lastActive: 5 },
    { name: 'Ben Arc', handle: 'ben@lnbits.com', platform: 'nostr', tier: 'dev', initials: 'BA', lastActive: 2 }
];

// Sample posts for the pulse feed - with real profile links
const samplePosts = [
    { author: 'Michael Saylor', handle: '@saylor', platform: 'x', initials: 'MS', content: 'Bitcoin is digital energy that can be transmitted across space and time at the speed of light.', time: '2m ago', likes: 1247, replies: 89, url: 'https://x.com/saylor', image: 'https://pbs.twimg.com/profile_images/1572051865606811654/XFYBmtQi_200x200.jpg' },
    { author: 'Fiatjaf', handle: 'fiatjaf@fiatjaf.com', platform: 'nostr', initials: 'FJ', content: 'Just pushed a new update to NIP-90. Data vending machines are the future of decentralized compute.', time: '5m ago', zaps: 21000, url: 'https://primal.net/p/3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d', npub: 'npub180cvv07tjdrrgpa0j7j7tmnyl2yr6yr7l8j4s3evf6u64th6gkwsyjh6w6' },
    { author: 'Lyn Alden', handle: '@LynAldenContact', platform: 'x', initials: 'LA', content: 'The monetary premium of Bitcoin continues to grow as more institutions recognize it as a reserve asset.', time: '12m ago', likes: 892, replies: 45, url: 'https://x.com/LynAldenContact', image: 'https://pbs.twimg.com/profile_images/1573283259502530560/v9nxhzTY_200x200.jpg' },
    { author: 'Matt Odell', handle: 'odell@werunbtc.com', platform: 'nostr', initials: 'MO', content: 'Your keys, your coins. Self custody is not just about security - it\'s about sovereignty.', time: '18m ago', zaps: 15500, url: 'https://primal.net/p/04c915daefee38317fa734444acee390a8269fe5810b2241e5e6dd343dfbecc9', npub: 'npub1qny3tkh0acurzla8x3ez2djj8w9ls205j6t29s9rnluupnsjnkzspxphh9' },
    { author: 'Natalie Brunell', handle: '@natbrunell', platform: 'x', initials: 'NB', content: 'Just recorded an incredible episode about Bitcoin adoption in Latin America. The stories are inspiring.', time: '25m ago', likes: 567, replies: 32, url: 'https://x.com/natbrunell', image: 'https://pbs.twimg.com/profile_images/1721582024382857217/fZVQ0sEf_200x200.jpg' },
    { author: 'Jack Dorsey', handle: '@jack', platform: 'x', initials: 'JD', content: 'Bitcoin is hope for the unbanked and underbanked around the world.', time: '31m ago', likes: 3421, replies: 156, url: 'https://x.com/jack', image: 'https://pbs.twimg.com/profile_images/1115644092329758721/AFjOr-K8_200x200.jpg' },
    { author: 'Calle', handle: 'calle@cashu.space', platform: 'nostr', initials: 'CL', content: 'Cashu v0.16 released with improved mint discovery and better privacy guarantees.', time: '45m ago', zaps: 8900, url: 'https://primal.net/calle', npub: 'npub1txafcksq7mfzjraqyl9jddph9w3gk7trcjz57fwrdxknxxszm0rsfjsxw4' },
    { author: 'American HODL', handle: '@americanhodl8', platform: 'x', initials: 'AH', content: 'Stack sats. Stay humble. The rest is noise.', time: '52m ago', likes: 2156, replies: 78, url: 'https://x.com/americanhodl8', image: 'https://pbs.twimg.com/profile_images/1595129866685091842/GX4oQBrU_200x200.jpg' }
];

// Render voice tracker
function renderVoiceList(filter = 'all') {
    const container = document.getElementById('voiceList');
    let voices = [...ecosystemVoices];
    
    if (filter !== 'all') {
        if (['youtube', 'x', 'nostr'].includes(filter)) {
            voices = voices.filter(v => v.platform === filter);
        } else {
            voices = voices.filter(v => v.tier === filter);
        }
    }
    
    // Sort by last active
    voices.sort((a, b) => a.lastActive - b.lastActive);
    
    container.innerHTML = voices.map(voice => {
        const activityClass = voice.lastActive < 2 ? 'active' : voice.lastActive < 12 ? 'recent' : 'inactive';
        const activeNow = voice.lastActive < 2 ? 'active-now' : '';
        const timeText = voice.lastActive === 0 ? 'just now' : voice.lastActive < 60 ? `${voice.lastActive}h ago` : `${Math.floor(voice.lastActive/24)}d ago`;
        
        // Generate profile URL based on platform
        let profileUrl = '#';
        if (voice.platform === 'x') {
            const handle = voice.handle.replace('@', '');
            profileUrl = `https://x.com/${handle}`;
        } else if (voice.platform === 'youtube') {
            const handle = voice.handle.replace('@', '');
            profileUrl = `https://youtube.com/@${handle}`;
        } else if (voice.platform === 'nostr') {
            profileUrl = `https://primal.net/${voice.handle.split('@')[0]}`;
        }
        
        return `
            <div class="voice-card ${activeNow}" data-platform="${voice.platform}" data-tier="${voice.tier}" onclick="window.open('${profileUrl}', '_blank')" style="cursor: pointer;">
                <div class="voice-avatar ${voice.platform}">
                    ${voice.initials}
                    <span class="activity-dot ${activityClass}"></span>
                </div>
                <div class="voice-info">
                    <div class="voice-name">${voice.name}</div>
                    <div class="voice-handle">${voice.handle}</div>
                </div>
                <div class="voice-meta">
                    <div class="voice-last-active">${timeText}</div>
                    <div class="voice-tier">${voice.tier}</div>
                </div>
            </div>
        `;
    }).join('');
    
    document.getElementById('voiceCount').textContent = `${voices.length} voices`;
}

// Render pulse feed
function renderPulseFeed() {
    const container = document.getElementById('pulseFeed');
    
    container.innerHTML = samplePosts.map(post => {
        const isNostr = post.platform === 'nostr';
        const engagement = isNostr 
            ? `<span class="engagement-stat zaps"><i class="fas fa-bolt"></i> ${formatNumber(post.zaps)}</span>`
            : `<span class="engagement-stat likes"><i class="fas fa-heart"></i> ${formatNumber(post.likes)}</span>
               <span class="engagement-stat replies"><i class="fas fa-comment"></i> ${post.replies}</span>`;
        
        const platformIcon = post.platform === 'youtube' ? 'fab fa-youtube' 
            : post.platform === 'x' ? 'fab fa-x-twitter' 
            : 'fas fa-bolt';
        
        const avatarContent = post.image 
            ? `<img src="${post.image}" alt="${post.author}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` 
            : post.initials;
        
        const viewText = post.platform === 'nostr' ? 'View on Nostr' : 'View on X';
        
        return `
            <div class="social-post ${post.platform}" onclick="window.open('${post.url}', '_blank')" style="cursor: pointer;">
                <div class="post-header">
                    <div class="post-author">
                        <div class="post-avatar ${post.platform}">${avatarContent}</div>
                        <div class="post-author-info">
                            <h4>${post.author}</h4>
                            <div class="post-author-meta">
                                <i class="${platformIcon} platform-icon"></i>
                                <span>${post.handle}</span>
                            </div>
                        </div>
                    </div>
                    <span class="post-time">${post.time}</span>
                </div>
                <div class="post-content">${post.content}</div>
                <div class="post-footer">
                    <div class="post-engagement">${engagement}</div>
                    <a href="${post.url}" target="_blank" class="post-link" onclick="event.stopPropagation();">${viewText} <i class="fas fa-external-link-alt"></i></a>
                </div>
            </div>
        `;
    }).join('');
}

function formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
}

// Filter buttons
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderVoiceList(btn.dataset.filter);
    });
});

// Section Navigation
function showSection(section) {
    document.querySelectorAll('.hub-section').forEach(s => { s.style.display = 'none'; });
    document.querySelectorAll('.hub-tab').forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
    });
    var sectionEl = document.getElementById('section-' + section);
    if (sectionEl) sectionEl.style.display = 'block';
    var tab = (typeof event !== 'undefined' && event.target) ? event.target.closest('.hub-tab') : document.getElementById('hub-tab-' + section);
    if (tab) {
        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');
    }
    if (section === 'nostr' && !window.nostrInitialized) {
        initNostr();
    }
}

// Nostr Integration
let nostrInitialized = false;

function initNostr() {
    if (window.SovereignNostrRelay) {
        window.SovereignNostrRelay.init('nostrFeed');
        nostrInitialized = true;
    } else {
        setTimeout(initNostr, 500);
    }
}

function toggleSovereignOnly(btn) {
    btn.classList.toggle('active');
    if (window.SovereignNostrRelay) {
        window.SovereignNostrRelay.filterSovereignOnly(btn.classList.contains('active'));
    }
}

// Series Data (with episode intel: tldr, keyQuote, funFact, topics)
const seriesData = {
    'everything_21m': {
        title: 'Everything Divided by 21 Million',
        description: 'A full 12-episode cinematic exploration of Knut Svanholm\'s book.',
        episodes: [
            { id: 'FA8tvWEydcA', title: 'Time | Episode 1', tldr: 'Time is the ultimate scarce resource. Bitcoin is the first technology that allows us to store the value of our time indefinitely.', keyQuote: '"Your time is your life energy. Every hour you work, you trade a piece of your finite existence."', funFact: 'The average person will work 90,000 hours in their lifetime  Bitcoin lets you preserve that value.', topics: ['Time preference', 'Delayed gratification', 'Store of value'] },
            { id: 'VDordtHAJhg', title: 'Alchemy | Episode 2', tldr: 'Central banks are modern alchemists  creating money from nothing while Bitcoin maintains absolute scarcity.', keyQuote: '"Fiat currency is the greatest magic trick ever performed  making something from nothing."', funFact: 'The Federal Reserve has created more dollars since 2020 than in the previous 100 years combined.', topics: ['Money printing', 'Scarcity', 'Sound money'] },
            { id: 'yKbQq66AInU', title: 'Ownership | Episode 3', tldr: 'True ownership requires proof of work. Bitcoin is the first asset that cannot be confiscated by force.', keyQuote: '"If you can\'t hold it in your mind, you don\'t truly own it."', funFact: 'A 12-word seed phrase can store unlimited value in your memory  the ultimate bearer instrument.', topics: ['Self-custody', 'Property rights', 'Seizure resistance'] },
            { id: 'rkTbEpAOADI', title: 'Energy | Episode 4', tldr: 'Bitcoin mining converts stranded and wasted energy into monetary value, creating the most efficient energy market ever.', keyQuote: '"Bitcoin doesn\'t waste energy  it monetizes energy that would otherwise be wasted."', funFact: 'Over 50% of Bitcoin mining now uses renewable energy sources, making it greener than traditional banking.', topics: ['Proof of work', 'Energy markets', 'Thermodynamics'] },
            { id: 'qG2xYvTVkw0', title: 'Morality | Episode 5', tldr: 'Inflation is theft. Bitcoin restores moral accountability to money by removing the ability to silently steal.', keyQuote: '"When you can\'t print money, you can\'t fund endless wars."', funFact: 'Every 1% of inflation effectively steals 1% of purchasing power from every saver in the economy.', topics: ['Cantillon effect', 'Monetary ethics', 'Wealth redistribution'] },
            { id: 'v7xZPqcXyLk', title: 'Memetics | Episode 6', tldr: 'Ideas spread like viruses. Bitcoin is the most powerful monetary meme in human history.', keyQuote: '"The orange pill is the ultimate mind virus  once you see it, you can\'t unsee it."', funFact: 'The term "hodl" originated from a typo in a 2013 Bitcoin forum post and became a global movement.', topics: ['Viral ideas', 'Cultural evolution', 'Network effects'] },
            { id: 'RZv_1Qcqik4', title: 'Symbiosis | Episode 7', tldr: 'Bitcoin and humanity co-evolve. The network gets stronger as more humans join, and humans get freer as the network grows.', keyQuote: '"We shape Bitcoin, and then Bitcoin shapes us."', funFact: 'Bitcoin has survived over 400 "deaths" according to mainstream media  each time coming back stronger.', topics: ['Network effects', 'Antifragility', 'Co-evolution'] },
            { id: 'UlYSv9SwQGk', title: 'Violence | Episode 8', tldr: 'All fiat money ultimately relies on state violence. Bitcoin offers the first peaceful exit from coercive monetary systems.', keyQuote: '"Violence is the last refuge of the incompetent."', funFact: 'Throughout history, every fiat currency has eventually failed  usually within 40-50 years.', topics: ['State coercion', 'Peaceful revolution', 'Opt-out'] },
            { id: '_ygND311kVE', title: 'Deflation | Episode 9', tldr: 'Deflation rewards savers and punishes speculation. A deflationary currency encourages sustainable economics.', keyQuote: '"In a Bitcoin world, prices naturally fall as technology improves."', funFact: 'The price of TVs fell 99% over 50 years due to technology  that\'s natural deflation at work.', topics: ['Purchasing power', 'Savings culture', 'Economic sustainability'] },
            { id: 'Nf0LtAk4VBs', title: 'Adoption | Episode 10', tldr: 'Bitcoin adoption follows an S-curve. We are still in the early majority phase  the opportunity is now.', keyQuote: '"You\'re not late, you\'re early. Most people still don\'t understand what Bitcoin is."', funFact: 'Less than 2% of the global population currently owns Bitcoin  similar to internet adoption in 1997.', topics: ['S-curve adoption', 'Network growth', 'First-mover advantage'] },
            { id: 'Gt8ycm3-NV8', title: 'Transition | Episode 11', tldr: 'The shift from fiat to Bitcoin is a generational transition. Early adopters lead the way.', keyQuote: '"The best time to stack was yesterday. The second best is today."', funFact: 'Bitcoin\'s network has never been taken offline  99.98%+ uptime since 2009.', topics: ['Transition', 'Stacking', 'Network resilience'] }
        ]
    },
    'big_print': {
        title: 'The Big Print',
        description: 'An explosive 12-part deep dive into the Federal Reserve.',
        episodes: [
            { id: 'W09CNU_q6Yo', title: 'Why Fixing the Money is the Only Way | Episode 1', tldr: 'The monetary system is the root cause of most societal problems. Fix the money, fix the world.', keyQuote: '"Money is the operating system of civilization  and ours is corrupted."', funFact: 'Lawrence Lepard manages over $500M in assets and went all-in on sound money after 2008.', topics: ['Monetary reform', 'Systemic corruption', 'First principles'] },
            { id: 'tnthM3uaHbI', title: 'How Govt Stole 98.5% Since 1971 | Episode 2', tldr: 'Since Nixon closed the gold window in 1971, the dollar has lost over 98% of its purchasing power.', keyQuote: '"1971 was the biggest heist in human history  and nobody talks about it."', funFact: 'A house that cost $25,000 in 1971 now costs over $400,000  that\'s the silent theft in action.', topics: ['Nixon shock', 'Currency debasement', 'WTFhappenedin1971'] },
            { id: 'FRH5w_joMP0', title: 'How Inflation Steals Your Life | Episode 3', tldr: 'Inflation is a hidden tax that steals your productive hours. Every dollar printed dilutes your savings.', keyQuote: '"Inflation is taxation without legislation."', funFact: 'A minimum wage worker in 1971 could buy more goods than a worker earning $20/hour today.', topics: ['Hidden taxation', 'Purchasing power erosion', 'Working class impact'] },
            { id: 'JLjG8jAJxbw', title: 'The Path to Pure Fiat | Episode 4', tldr: 'The journey from gold-backed money to pure fiat was a deliberate process of financial enslavement.', keyQuote: '"The Fed was designed to fail the people and enrich the elite."', funFact: 'The Federal Reserve was created on Jekyll Island in 1910 by six men representing 25% of world wealth.', topics: ['Fed history', 'Gold standard abandonment', 'Financial elite'] },
            { id: 'tq_ZYhpW4Vw', title: 'How Powell & Yellen Broke It | Episode 5', tldr: 'Recent Fed policies have accelerated the destruction of the dollar at an unprecedented rate.', keyQuote: '"The Fed printed more money in 2020 than in the previous 200 years of US history."', funFact: 'The Fed\'s balance sheet grew from $4T to $9T in just two years during COVID.', topics: ['Quantitative easing', 'Monetary policy', 'System fragility'] },
            { id: 'Sjp-Kaic2CE', title: 'Austrian vs Keynesian | Episode 6', tldr: 'Austrian economics explains why Keynesian policies always fail  and why Bitcoin aligns with Austrian principles.', keyQuote: '"Keynes gave politicians the intellectual cover to print money."', funFact: 'Keynes himself said "In the long run we are all dead"  the ultimate short-term thinking.', topics: ['Economic schools', 'Sound money theory', 'Policy implications'] },
            { id: 'n6Bi8Kf6ar0', title: 'The Sovereign Currency Bubble | Episode 7', tldr: 'Government bonds are the largest bubble in history. When it pops, Bitcoin will be the escape valve.', keyQuote: '"The bond market is a $130 trillion house of cards."', funFact: 'Over $18 trillion in bonds traded at negative yields in 2021  paying to lend money.', topics: ['Bond markets', 'Debt crisis', 'Safe haven assets'] },
            { id: 'M3M61rLBTl0', title: 'Bitcoin is God\'s Gift | Episode 8', tldr: 'Bitcoin arrived at exactly the right moment to save humanity from financial enslavement.', keyQuote: '"Bitcoin is the peaceful revolution we\'ve been waiting for."', funFact: 'Satoshi mined the genesis block on Jan 3, 2009, embedding a newspaper headline about bank bailouts.', topics: ['Divine timing', 'Financial freedom', 'Peaceful revolution'] },
            { id: 'uzUEJZ38RV8', title: 'Bitcoin & Real Estate | Episode 9', tldr: 'Real estate became a store of value because money failed. Bitcoin returns that function to money itself.', keyQuote: '"Housing shouldn\'t be an investment  it should be a home."', funFact: 'Millennials own 5% of US wealth at age 35  Boomers owned 21% at the same age.', topics: ['Asset inflation', 'Wealth inequality', 'Generational divide'] },
            { id: 'y9snxWoEkaU', title: 'End of Centralized Power | Episode 10', tldr: 'Centralized control of money enables centralized control of everything. Bitcoin breaks this cycle.', keyQuote: '"Control the money, control the world."', funFact: 'The Federal Reserve is owned by private banks, not the US government.', topics: ['Power structures', 'Decentralization', 'Financial sovereignty'] },
            { id: 'hKa8lRDwIos', title: 'Digital Scarcity | Episode 11', tldr: 'Before Bitcoin, digital things could be infinitely copied. Satoshi solved the double-spend problem.', keyQuote: '"Bitcoin is the first truly scarce digital asset in human history."', funFact: 'There will only ever be 21 million Bitcoin  less than 0.003 BTC per person globally.', topics: ['Digital scarcity', 'Double-spend problem', 'Mathematical certainty'] },
            { id: 'FyMWELymqAM', title: 'Fix the Money, Fix the World | Episode 12', tldr: 'When money is honest, society becomes honest. Bitcoin is the foundation for a better civilization.', keyQuote: '"Hard money creates hard men. Soft money creates soft men."', funFact: 'Countries with sound money historically have lower crime, higher trust, and greater prosperity.', topics: ['Social transformation', 'Moral hazard', 'Civilizational change'] }
        ]
    },
    'daylight_robbery': {
        title: 'Daylight Robbery',
        description: 'A riveting 13-part series on taxation through history.',
        episodes: [
            { id: 'ZCc78wvwd6U', title: 'The Hidden History of Taxation | Episode 1', tldr: 'Taxation has been the primary mechanism of wealth extraction throughout human history.', keyQuote: '"Taxation is the price we pay for failing to build a civilized society."', funFact: 'The word "tax" comes from Latin "taxare" meaning to censure, charge, or assess.', topics: ['Tax origins', 'Historical perspective', 'Wealth extraction'] },
            { id: 'j_V3fjvEuS0', title: 'How Taxes Shaped Civilization | Episode 2', tldr: 'The rise and fall of empires can be traced through their tax policies.', keyQuote: '"Every empire that overtaxed its citizens collapsed."', funFact: 'The Roman Empire fell partly because tax rates exceeded 50% of income.', topics: ['Empire cycles', 'Tax burden', 'Civilizational collapse'] },
            { id: 'W_TNwftaVMk', title: 'Death, Taxes, or Islam | Episode 3', tldr: 'Medieval taxation created religious and political divides that still shape our world today.', keyQuote: '"The Jizya tax created a two-tier society that echoes through history."', funFact: 'The Islamic Golden Age had lower tax rates than Christian Europe at the same time.', topics: ['Religious taxation', 'Medieval economics', 'Social stratification'] },
            { id: '3VDVbbSZYPc', title: 'The Peasants\' Revolt | Episode 4', tldr: 'The 1381 Peasants Revolt was sparked by a poll tax  proving taxes ignite revolutions.', keyQuote: '"When Adam delved and Eve span, who was then the gentleman?"', funFact: 'The poll tax was only 4 pence per person  but it sparked the first major English uprising.', topics: ['Popular uprising', 'Tax resistance', 'Class warfare'] },
            { id: 'brho571r5rY', title: 'Tax Wars That Created Nations | Episode 5', tldr: 'Many nations were born from tax rebellions  including the United States.', keyQuote: '"No taxation without representation!"', funFact: 'The American Revolution began over a 3% tax on tea  today we accept 40%+ tax rates.', topics: ['American Revolution', 'Tax rebellion', 'National identity'] },
            { id: 'zltb_tXZiWI', title: 'How the Richest Controlled Nations | Episode 6', tldr: 'Banking families like the Rothschilds gained power by financing wars and collecting taxes.', keyQuote: '"Give me control of a nation\'s money and I care not who makes its laws."', funFact: 'The Rothschild family was worth an estimated $350 billion at their peak in the 1800s.', topics: ['Banking dynasties', 'War financing', 'Power concentration'] },
            { id: '0MDv0d-3t_k', title: 'How Tariffs Caused Civil War | Episode 7', tldr: 'The American Civil War was as much about tariffs and taxation as it was about slavery.', keyQuote: '"The tariff question was the real cause of sectional conflict."', funFact: 'The Morrill Tariff of 1861 increased import duties by 70%  devastating the Southern economy.', topics: ['Tariff wars', 'Economic conflict', 'Civil War causes'] },
            { id: 'Ym5W3t9WvB8', title: 'The Birth of Big Government | Episode 8', tldr: 'World War I created the income tax and the modern surveillance state.', keyQuote: '"War is the health of the state."', funFact: 'The US income tax was introduced in 1913 at 1%  a "temporary" war measure.', topics: ['Income tax origins', 'War expansion', 'Government growth'] },
            { id: 'YUHM88mtRxU', title: 'Hitler, Banks & Nations | Episode 9', tldr: 'World War II was fundamentally a war over economic resources and monetary control.', keyQuote: '"All wars are bankers\' wars."', funFact: 'The Nazi regime confiscated $230 million in Jewish property through special taxes.', topics: ['War economics', 'Confiscation', 'Financial warfare'] },
            { id: 'LcIT9Tgbkm8', title: 'How Govts Silently Rob You | Episode 10', tldr: 'Inflation is the hidden tax that requires no legislation and leaves no fingerprints.', keyQuote: '"The art of taxation is plucking the goose to get the most feathers with the least hissing."', funFact: 'The average person loses 2-3 months of salary annually to invisible inflation taxes.', topics: ['Inflation tax', 'Hidden extraction', 'Financial suppression'] },
            { id: 'VRSXUD4L2eA', title: 'Digital Nomads & Borderless Money | Episode 11', tldr: 'Digital technology is making geographical tax jurisdictions obsolete.', keyQuote: '"The internet routes around censorship, and Bitcoin routes around taxation."', funFact: 'Over 35 million Americans now work remotely  many from lower-tax jurisdictions.', topics: ['Remote work', 'Tax arbitrage', 'Digital freedom'] },
            { id: '1OAn6QDSsJs', title: 'How Data & AI Reshape Taxation | Episode 12', tldr: 'Governments are using AI to track and tax every transaction in real-time.', keyQuote: '"Big data is the biggest threat to financial privacy in history."', funFact: 'The IRS now uses machine learning to detect unreported income with 90%+ accuracy.', topics: ['Surveillance', 'AI taxation', 'Privacy erosion'] },
            { id: 'xPPbMsz8qso', title: 'The Perfect Tax System | Episode 13', tldr: 'What would an ideal tax system look like? Dominic Frisby presents a radical alternative.', keyQuote: '"A land value tax is the least harmful way to fund public services."', funFact: 'Singapore uses land value taxation and has one of the world\'s most efficient economies.', topics: ['Land value tax', 'Tax reform', 'Optimal policy'] }
        ]
    },
    'genesis_book': {
        title: 'The Genesis Book',
        description: 'Exploring the origins of Bitcoin with Aaron van Wirdum.',
        episodes: [
            { id: '3TslgynKeaA', title: 'Austrian Economics & Money | Episode 1', tldr: 'Austrian economics provides the theoretical foundation for understanding why Bitcoin matters.', keyQuote: '"The Austrian school predicted the failure of fiat money decades before Bitcoin."', funFact: 'Carl Menger founded Austrian economics in 1871  137 years before Bitcoin.', topics: ['Austrian economics', 'Monetary theory', 'Menger\'s origins'] },
            { id: 'PFi6no-0wSE', title: 'Neutral Money & Denationalization | Episode 2', tldr: 'Hayek proposed private competing currencies in 1976  Bitcoin fulfills his vision.', keyQuote: '"The denationalization of money is the most important reform we can make."', funFact: 'Hayek won the Nobel Prize in 1974, two years before writing "Denationalization of Money."', topics: ['Hayek', 'Private money', 'Currency competition'] },
            { id: 'PLWhV1JBfCA', title: 'Free and Open Source Software | Episode 3', tldr: 'The open-source movement created the culture and tools that made Bitcoin possible.', keyQuote: '"Free software is about liberty, not price."', funFact: 'Linux, the open-source operating system, runs 96% of the world\'s top web servers.', topics: ['Open source', 'Linux', 'Collaborative development'] },
            { id: 'J5b24c0QzCE', title: 'Cryptography & Spies | Episode 4', tldr: 'Cryptography evolved from a military secret to a tool for individual freedom.', keyQuote: '"Strong cryptography is the best defense against tyranny."', funFact: 'The NSA tried to ban public cryptography in the 1990s during the "Crypto Wars."', topics: ['Cryptography history', 'Privacy tools', 'Government opposition'] },
            { id: 'FzrKToH9AT0', title: 'eCash & Timestamps | Episode 5', tldr: 'David Chaum invented digital cash in the 1980s  Bitcoin built on his work.', keyQuote: '"DigiCash was ahead of its time  it had everything except decentralization."', funFact: 'DigiCash filed for bankruptcy in 1998, just 10 years before Bitcoin launched.', topics: ['DigiCash', 'David Chaum', 'Digital cash pioneers'] },
            { id: 'c3Nafsnts-Q', title: 'The Extropians & High Tech Hayekians | Episode 6', tldr: 'The Extropian movement envisioned a future of technological abundance and individual sovereignty.', keyQuote: '"We are the first generation that could live forever  if we choose."', funFact: 'Many early Bitcoiners were active in Extropian mailing lists in the 1990s.', topics: ['Extropianism', 'Transhumanism', 'Technological optimism'] },
            { id: 'wDUePxNsgLs', title: 'The Rise of the Cypherpunks | Episode 7', tldr: 'The Cypherpunks believed privacy was essential for freedom  and they wrote code to prove it.', keyQuote: '"Cypherpunks write code. Privacy is not something you request  you take it."', funFact: 'The Cypherpunk mailing list included Tim May, Eric Hughes, and a young Satoshi Nakamoto.', topics: ['Cypherpunks', 'Privacy activism', 'Code as protest'] },
            { id: 'WB5-IR5xrAE', title: 'Hashcash + Bit Gold | Episode 8', tldr: 'Adam Back\'s Hashcash and Nick Szabo\'s Bit Gold were the direct ancestors of Bitcoin.', keyQuote: '"Bit Gold was 90% of the way to Bitcoin  it just lacked the finishing touches."', funFact: 'Adam Back\'s Hashcash is the only prior technology directly cited in the Bitcoin whitepaper.', topics: ['Hashcash', 'Bit Gold', 'Proof of work origins'] },
            { id: 'vydVrF07QGA', title: 'B-money and RPOW | Episode 9', tldr: 'Wei Dai\'s B-money and Hal Finney\'s RPOW were the final precursors before Bitcoin.', keyQuote: '"B-money proposed almost every element of Bitcoin  except the blockchain."', funFact: 'Hal Finney received the first ever Bitcoin transaction from Satoshi Nakamoto.', topics: ['B-money', 'RPOW', 'Hal Finney'] },
            { id: 'VDdc67_HnVE', title: 'Bitcoin\'s Revolutionary Origins | Episode 10', tldr: 'Satoshi combined 30 years of cryptographic research into the first working cryptocurrency.', keyQuote: '"Bitcoin is not just a currency  it\'s a breakthrough in computer science."', funFact: 'Satoshi Nakamoto has never been identified and holds ~1 million untouched BTC.', topics: ['Bitcoin genesis', 'Satoshi mystery', 'Technical breakthrough'] }
        ]
    }
};

let currentSeries = null;

function openSeries(seriesKey) {
    currentSeries = seriesData[seriesKey];
    if (!currentSeries || !currentSeries.episodes.length) return;
    
    const firstEp = currentSeries.episodes[0];
    document.getElementById('modalVideo').src = `https://www.youtube.com/embed/${firstEp.id}?autoplay=1`;
    document.getElementById('modalTitle').textContent = firstEp.title;
    document.getElementById('modalDesc').textContent = currentSeries.description;
    
    const list = document.getElementById('episodeList');
    list.innerHTML = '<div class="episode-list-title">Episodes</div>';
    
    currentSeries.episodes.forEach((ep, i) => {
        const item = document.createElement('div');
        item.className = 'episode-item' + (i === 0 ? ' active' : '');
        item.innerHTML = `<span class="episode-num">${i + 1}</span><span class="episode-title">${ep.title}</span>`;
        item.onclick = () => switchEpisode(ep, i);
        list.appendChild(item);
    });
    
    const guidePanel = document.getElementById('episodeGuidePanel');
    guidePanel.style.display = 'block';
    fillEpisodeGuide(firstEp);
    
    document.getElementById('playerModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function fillEpisodeGuide(ep) {
    document.getElementById('guideEpTitle').textContent = ep.title;
    document.getElementById('guideTldr').textContent = ep.tldr || '';
    document.getElementById('guideQuote').textContent = ep.keyQuote || '';
    document.getElementById('guideFunFact').textContent = ep.funFact || '';
    const topicsEl = document.getElementById('guideTopics');
    if (ep.topics && ep.topics.length) {
        topicsEl.innerHTML = ep.topics.map(t => `<span class="guide-topic-tag">${t}</span>`).join('');
    } else {
        topicsEl.innerHTML = '';
    }
}

function switchEpisode(ep, index) {
    document.getElementById('modalVideo').src = `https://www.youtube.com/embed/${ep.id}?autoplay=1`;
    document.getElementById('modalTitle').textContent = ep.title;
    fillEpisodeGuide(ep);
    document.querySelectorAll('.episode-item').forEach((item, i) => {
        item.classList.toggle('active', i === index);
    });
}

function closeModal() {
    document.getElementById('modalVideo').src = '';
    document.getElementById('episodeGuidePanel').style.display = 'none';
    document.getElementById('playerModal').classList.remove('active');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// Simulate live updates
function simulateLiveUpdates() {
    // Randomly update activity times
    ecosystemVoices.forEach(voice => {
        if (Math.random() > 0.95) {
            voice.lastActive = 0;
        }
    });
    
    // Update active count
    const activeCount = ecosystemVoices.filter(v => v.lastActive < 6).length;
    document.getElementById('activeVoices').textContent = activeCount;
    
    renderVoiceList(document.querySelector('.filter-btn.active').dataset.filter);
}

// Initialize
renderVoiceList();
renderPulseFeed();

setInterval(simulateLiveUpdates, 30000);
</script>
{% endblock %}
