{% extends "base.html" %}

{% block title %}Core Analytics - Protocol Pulse{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">Core Analytics</h2>
      <p class="text-muted mb-0">Recent engagement events and top content performance.</p>
    </div>
    <a class="btn btn-outline-secondary" href="/admin/realtime-analytics">Realtime Analytics</a>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card bg-dark text-light border-secondary h-100">
        <div class="card-body">
          <div class="text-muted small">Recent Events Loaded</div>
          <div class="display-6">{{ recent_events|length }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark text-light border-secondary h-100">
        <div class="card-body">
          <div class="text-muted small">Top Performers Loaded</div>
          <div class="display-6">{{ top_performers|length }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark text-light border-secondary h-100">
        <div class="card-body">
          <div class="text-muted small">Summary Rows</div>
          <div class="display-6">{{ summary_rows|length }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="card bg-dark text-light border-secondary mb-4">
    <div class="card-header">Top Content Performance</div>
    <div class="card-body p-0">
      <div class="table-responsive mb-0">
        <table class="table table-dark table-striped table-sm mb-0">
          <thead>
            <tr>
              <th>Title</th>
              <th>Type</th>
              <th>Views</th>
              <th>Clicks</th>
              <th>Replies</th>
              <th>Likes</th>
              <th>Velocity</th>
            </tr>
          </thead>
          <tbody>
            {% for p in top_performers %}
            <tr>
              <td>{{ p.content_title or ('Content #' ~ p.content_id) }}</td>
              <td>{{ p.content_type }}</td>
              <td>{{ p.total_views or 0 }}</td>
              <td>{{ p.total_clicks or 0 }}</td>
              <td>{{ p.total_replies or 0 }}</td>
              <td>{{ p.total_likes or 0 }}</td>
              <td>{{ p.velocity_score or 0 }}</td>
            </tr>
            {% else %}
            <tr><td colspan="7" class="text-center text-muted py-3">No performance data yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card bg-dark text-light border-secondary">
    <div class="card-header">Recent Engagement Events</div>
    <div class="card-body p-0">
      <div class="table-responsive mb-0">
        <table class="table table-dark table-striped table-sm mb-0">
          <thead>
            <tr>
              <th>Time</th>
              <th>Event</th>
              <th>Content</th>
              <th>Source</th>
              <th>URL</th>
            </tr>
          </thead>
          <tbody>
            {% for e in recent_events %}
            <tr>
              <td>{{ e.created_at.strftime('%Y-%m-%d %H:%M:%S') if e.created_at else '-' }}</td>
              <td>{{ e.event_type }}</td>
              <td>{{ e.content_type or '-' }}{% if e.content_id %}:{{ e.content_id }}{% endif %}</td>
              <td>{{ e.source_platform or '-' }}</td>
              <td class="text-truncate" style="max-width: 280px;">{{ e.source_url or '-' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="5" class="text-center text-muted py-3">No engagement events yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
