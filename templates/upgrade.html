{% extends "base.html" %}
{% block title %}Upgrade Commander{% endblock %}
{% block content %}
<section class="container py-5 mt-5">
  <div class="card bg-dark text-light border-danger shadow-lg">
    <div class="card-body p-4">
      <h2 class="mb-2">Commander Tier</h2>
      <p class="text-secondary mb-4">$99/mo unlock: Deep Search Oracle + premium command lanes.</p>
      <div class="d-flex flex-wrap gap-2 mb-4">
        {% if btcpay_checkout_url %}
          <a class="btn btn-danger" href="{{ btcpay_checkout_url }}" target="_blank" rel="noopener">Pay with BTCPay</a>
        {% endif %}
        {% if stripe_checkout_url %}
          <a class="btn btn-outline-light" href="{{ stripe_checkout_url }}" target="_blank" rel="noopener">Pay with Stripe</a>
        {% endif %}
      </div>
      <button class="btn btn-success" id="confirmUpgradeBtn">I have paid â€” unlock Commander</button>
      <div id="upgradeMsg" class="mt-3 small text-info"></div>
    </div>
  </div>
</section>
<script>
document.getElementById('confirmUpgradeBtn')?.addEventListener('click', async () => {
  const csrf = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
  const r = await fetch('/api/upgrade/confirm', {
    method:'POST',
    headers:{'Content-Type':'application/json','X-CSRF-Token': csrf},
    credentials:'same-origin',
    body: JSON.stringify({provider:'manual'})
  });
  const j = await r.json();
  document.getElementById('upgradeMsg').textContent = j.ok ? 'commander unlocked. refresh /hub.' : ('unlock failed: ' + (j.error || 'unknown'));
});
</script>
{% endblock %}

