{% extends "base.html" %}
{% block title %}{{ article.title }} — Protocol Pulse{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/articles-terminal.css') }}?v=terminal3">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
  body { background: #0A0A0A !important; }
</style>
{% endblock %}

{% block content %}
<article class="article-detail-terminal">
  <!-- Header image with red/black overlay (brand cohesion) -->
  <header class="article-detail-header">
    <div class="article-detail-header-bg intel-image-overlay" style="background-image: url({{ header_image_url or article.header_image_url or 'https://images.unsplash.com/photo-1639762681485-074b7f938ba0?w=1200' }});"></div>
    <div class="article-detail-header-overlay"></div>
    <div class="article-detail-header-content">
      <h1 class="article-detail-title">{{ article.title }}</h1>
      <p class="article-detail-meta">
        {{ article.created_at.strftime('%B %d, %Y') if article.created_at else '—' }}
        {% if article.author %} · {{ article.author }}{% endif %}
        {% if article.category %} · <span class="article-detail-category">{{ article.category }}</span>{% endif %}
      </p>
    </div>
  </header>

  <!-- Key Takeaways: one summary box, red border, bullet points (no duplicate TL;DR) -->
  <div class="key-takeaways">
    <h3>Key Takeaways</h3>
    {% if key_takeaways_bullets and key_takeaways_bullets|length > 0 %}
    <ul>
      {% for point in key_takeaways_bullets %}
      <li>{{ point }}</li>
      {% endfor %}
    </ul>
    {% else %}
    <p>{{ key_takeaways_text or 'Key points from this analysis.' }}</p>
    {% endif %}
  </div>

  <!-- Body: full article (summary in Key Takeaways above). Generator uses <div class="tldr-section"> for TL;DR. -->
  <div class="article-body-serif">
    {% if body_html %}
    {{ body_html|safe }}
    {% else %}
    <p class="text-muted" style="font-size: 0.95rem;">Full analysis is summarized in Key Takeaways above.</p>
    {% endif %}
  </div>

  <!-- Share Intelligence (terminal-style buttons) -->
  <div class="mt-5 pt-4 article-detail-share">
    <p class="share-intel-label">Share Intelligence</p>
    <a href="https://twitter.com/intent/tweet?text={{ (article.title + ' ' + request.url)|urlencode }}" target="_blank" rel="noopener" class="share-intel-btn">$ share x</a>
    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url|urlencode }}" target="_blank" rel="noopener" class="share-intel-btn">$ share linkedin</a>
    <button type="button" class="share-intel-btn" onclick="navigator.clipboard.writeText('{{ request.url }}'); this.textContent='$ copied'; setTimeout(() => { this.textContent='$ copy link'; }, 1500);">$ copy link</button>
  </div>

  <div class="mt-4">
    <a href="{{ url_for('articles') }}" class="share-intel-btn" style="text-decoration: none;">← Back to Terminal</a>
  </div>
</article>
{% endblock %}
