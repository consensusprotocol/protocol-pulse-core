{% extends "base.html" %}

{% block title %}Operator Costs | Protocol Pulse{% endblock %}

{% block extra_css %}
<style>
:root {
    --calc-glass: rgba(255, 255, 255, 0.03);
    --calc-border: rgba(255, 255, 255, 0.08);
    --calc-success: #22c55e;
    --calc-danger: #ef4444;
    --calc-warning: #f59e0b;
}

.calc-page {
    min-height: 100vh;
    background: linear-gradient(180deg, #000 0%, #0a0a0a 100%);
    padding: 60px 20px;
}

.calc-container {
    max-width: 800px;
    margin: 0 auto;
}

.calc-header {
    text-align: center;
    margin-bottom: 50px;
}

.calc-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.4);
    letter-spacing: 0.2em;
    text-transform: uppercase;
    margin-bottom: 10px;
}

.calc-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.25);
}

.glass-panel {
    background: var(--calc-glass);
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border: 1px solid var(--calc-border);
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 25px;
}

.input-section {
    margin-bottom: 30px;
}

.input-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.4);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 12px;
    display: block;
}

.slider-container {
    position: relative;
    padding: 20px 0;
}

.volume-slider {
    width: 100%;
    height: 6px;
    -webkit-appearance: none;
    appearance: none;
    background: linear-gradient(to right, rgba(220, 38, 38, 0.3) 0%, rgba(220, 38, 38, 0.6) 100%);
    border-radius: 3px;
    outline: none;
}

.volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 24px;
    height: 24px;
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
    transition: transform 0.2s ease;
}

.volume-slider::-webkit-slider-thumb:hover {
    transform: scale(1.1);
}

.volume-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    border-radius: 50%;
    cursor: pointer;
    border: none;
    box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
}

.slider-value {
    text-align: center;
    margin-top: 15px;
}

.volume-display {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2.5rem;
    font-weight: 600;
    color: #fff;
}

.volume-unit {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.4);
    margin-left: 8px;
}

.comparison-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
}

.fee-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 25px;
    text-align: center;
}

.fee-card.retail {
    border-color: rgba(239, 68, 68, 0.3);
}

.fee-card.operative {
    border-color: rgba(34, 197, 94, 0.3);
}

.fee-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.4);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 15px;
}

.fee-rate {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    margin-bottom: 10px;
}

.fee-cost {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.8rem;
    font-weight: 600;
}

.fee-card.retail .fee-cost {
    color: var(--calc-danger);
}

.fee-card.operative .fee-cost {
    color: var(--calc-success);
}

.fee-btc {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.4);
    margin-top: 8px;
}

.leakage-section {
    text-align: center;
    margin-top: 40px;
    padding-top: 30px;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
}

.leakage-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.4);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 15px;
}

.leakage-bar-container {
    height: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    overflow: hidden;
    margin: 20px 0;
}

.leakage-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--calc-danger) 0%, #f97316 100%);
    border-radius: 6px;
    transition: width 0.5s ease;
}

.leakage-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2rem;
    font-weight: 600;
    color: var(--calc-danger);
}

.leakage-period {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.4);
}

.alex-note {
    background: rgba(220, 38, 38, 0.08);
    border-left: 3px solid var(--pp-red, #dc2626);
    padding: 20px;
    margin: 30px 0;
    border-radius: 0 12px 12px 0;
    text-align: left;
}

.alex-note .note-author {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--pp-red, #dc2626);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 8px;
}

.alex-note .note-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    font-style: italic;
    line-height: 1.6;
}

.cta-section {
    text-align: center;
    margin-top: 35px;
}

.cta-btn {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);
    border: 1px solid rgba(34, 197, 94, 0.4);
    border-radius: 12px;
    padding: 18px 35px;
    color: var(--calc-success);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
}

.cta-btn:hover {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(34, 197, 94, 0.2) 100%);
    border-color: var(--calc-success);
    transform: translateY(-2px);
    color: var(--calc-success);
}

.venue-options {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 20px;
}

.venue-link {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 14px 22px;
    color: rgba(255, 255, 255, 0.7);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.venue-link:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(255, 255, 255, 0.2);
    color: #fff;
}

.nav-back {
    position: fixed;
    top: 20px;
    left: 20px;
    color: rgba(255, 255, 255, 0.4);
    text-decoration: none;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: color 0.3s ease;
    z-index: 100;
}

.nav-back:hover {
    color: rgba(255, 255, 255, 0.8);
}

@media (max-width: 640px) {
    .comparison-grid {
        grid-template-columns: 1fr;
    }
    .glass-panel {
        padding: 25px 20px;
    }
    .volume-display {
        font-size: 2rem;
    }
}
</style>
{% endblock %}

{% block content %}
<a href="/" class="nav-back">
    <i class="fas fa-arrow-left"></i>
    <span>Protocol Pulse</span>
</a>

<div class="calc-page">
    <div class="calc-container">
        <div class="calc-header">
            <h1 class="calc-title">Operator Costs</h1>
            <p class="calc-subtitle">Fee Leakage Analysis</p>
        </div>
        
        <div class="glass-panel">
            <div class="input-section">
                <label class="input-label">Monthly Trading Volume (USD)</label>
                <div class="slider-container">
                    <input type="range" class="volume-slider" id="volume-slider" 
                           min="1000" max="1000000" step="1000" value="50000">
                    <div class="slider-value">
                        <span class="volume-display" id="volume-display">$50,000</span>
                        <span class="volume-unit">/month</span>
                    </div>
                </div>
            </div>
            
            <div class="comparison-grid">
                <div class="fee-card retail">
                    <div class="fee-label">Retail Rate</div>
                    <div class="fee-rate">Coinbase Standard: 0.60%</div>
                    <div class="fee-cost" id="retail-cost">$300</div>
                    <div class="fee-btc" id="retail-btc">≈ 0.003 BTC</div>
                </div>
                
                <div class="fee-card operative">
                    <div class="fee-label">Operative Rate</div>
                    <div class="fee-rate">MEXC/Bybit Rebate: 0.02%</div>
                    <div class="fee-cost" id="operative-cost">$10</div>
                    <div class="fee-btc" id="operative-btc">≈ 0.0001 BTC</div>
                </div>
            </div>
            
            <div class="leakage-section">
                <div class="leakage-label">Annual Fee Leakage</div>
                <div class="leakage-bar-container">
                    <div class="leakage-bar" id="leakage-bar" style="width: 60%;"></div>
                </div>
                <div class="leakage-value" id="leakage-value">$3,480</div>
                <div class="leakage-period">lost to inefficient rails per year</div>
            </div>
            
            <div class="alex-note" id="alex-note">
                <div class="note-author">Alex (Quant) Note</div>
                <div class="note-text">"Operators at this volume are currently overpaying by <span id="alex-btc">0.035 BTC</span>/year. That's compounding returns you're surrendering to market makers."</div>
            </div>
            
            <div class="cta-section">
                <a href="/go/mexc" class="cta-btn">
                    <i class="fas fa-bolt"></i>
                    Plug the Leak: Access Operative Rebates
                </a>
                
                <div class="venue-options">
                    <a href="/go/mexc" class="venue-link">
                        <i class="fas fa-exchange-alt"></i>
                        MEXC
                    </a>
                    <a href="/go/bybit" class="venue-link">
                        <i class="fas fa-exchange-alt"></i>
                        Bybit
                    </a>
                    <a href="/logistics" class="venue-link">
                        <i class="fas fa-folder-open"></i>
                        View All Partners
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const BTC_PRICE = 100000;
const RETAIL_RATE = 0.006;
const OPERATIVE_RATE = 0.0002;

const slider = document.getElementById('volume-slider');
const volumeDisplay = document.getElementById('volume-display');
const retailCost = document.getElementById('retail-cost');
const retailBtc = document.getElementById('retail-btc');
const operativeCost = document.getElementById('operative-cost');
const operativeBtc = document.getElementById('operative-btc');
const leakageBar = document.getElementById('leakage-bar');
const leakageValue = document.getElementById('leakage-value');
const alexBtc = document.getElementById('alex-btc');

function formatCurrency(num) {
    return '$' + num.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
}

function formatBtc(num) {
    if (num < 0.001) return num.toFixed(4);
    if (num < 0.01) return num.toFixed(3);
    return num.toFixed(2);
}

function calculate() {
    const monthlyVolume = parseInt(slider.value);
    const yearlyVolume = monthlyVolume * 12;
    
    const monthlyRetail = monthlyVolume * RETAIL_RATE;
    const monthlyOperative = monthlyVolume * OPERATIVE_RATE;
    
    const yearlyRetail = yearlyVolume * RETAIL_RATE;
    const yearlyOperative = yearlyVolume * OPERATIVE_RATE;
    const yearlyLeakage = yearlyRetail - yearlyOperative;
    
    const retailBtcValue = monthlyRetail / BTC_PRICE;
    const operativeBtcValue = monthlyOperative / BTC_PRICE;
    const leakageBtcValue = yearlyLeakage / BTC_PRICE;
    
    volumeDisplay.textContent = formatCurrency(monthlyVolume);
    retailCost.textContent = formatCurrency(monthlyRetail);
    retailBtc.textContent = `≈ ${formatBtc(retailBtcValue)} BTC`;
    operativeCost.textContent = formatCurrency(monthlyOperative);
    operativeBtc.textContent = `≈ ${formatBtc(operativeBtcValue)} BTC`;
    
    leakageValue.textContent = formatCurrency(yearlyLeakage);
    alexBtc.textContent = formatBtc(leakageBtcValue) + ' BTC';
    
    const maxLeakage = 1000000 * 12 * (RETAIL_RATE - OPERATIVE_RATE);
    const barWidth = Math.min(100, (yearlyLeakage / maxLeakage) * 100);
    leakageBar.style.width = barWidth + '%';
}

slider.addEventListener('input', calculate);
calculate();
</script>
{% endblock %}
